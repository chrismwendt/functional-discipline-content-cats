\chapter{Von Neumann Algebras}
\begin{parsec}{410}%
\begin{point}{10}%
We have arrived at the main subject of this thesis,
the special class of $C^*$-algebras
called von Neumann algebras (see definition~\sref{vna} below)
that are characterised by the existence
of certain directed suprema 
and an abundance  of functionals that preserve
these suprema.
While all $C^*$-algebras
and the cpsu-maps
between them
may perhaps serve as models for
quantum data types and processes, respectively,
we focus
for the purposes of this thesis
 our attention on
the subcategory~$\W{cpsu}$ of von Neumann algebras
and the cpsu-maps between them that preserve these suprema
(called \emph{normal} maps, see~\sref{p-uwcont}),
because 
\begin{enumerate}
\item
$\W{cpsu}$
is a model of the quantum lambda calculus
(in a way that~$\Cstar{cpsu}$ is not,
see~\sref{cstar-no-model}), and
\item
we were able to axiomatise
the sequential product ($b\mapsto \sqrt{a}b\sqrt{a}$)
in~$\W{cpsu}$ 
(but not in~$\Cstar{cpsu}$)
see~\sref{uniqueness-sequential-product}.
\end{enumerate}
Both these are reserved for the next chapter;
in this chapter we'll (re)develop the theory
we needed to prove them.

The archetypal von Neumann algebra
is the $C^*$-algebra~$\scrB(\scrH)$
of bounded operators on a Hilbert space~$\scrH$.
In fact,
the
original~\cite{vn1930,mvn1936}
and common~\cite{kr,conway2000} 
definition of a von Neumann algebra
is a $C^*$-subalgebra~$\scrA$
of a~$\scrB(\scrH)$
that is closed in a ``suitable topology''
such as the strong or weak operator topology
(see~\sref{swot}).
Most authors make the distinction
between such rings of operators
(called von Neumann algebras)
and the $C^*$-algebras
miu-isomorphic to them
(called \emph{$W^*$-algebras}),
but we won't bother and call them all von Neumann algebras.
Partly because it seems difficult
to explain 
to someone
picturing a quantum data type
the meaning of the weak operator topology
and the Hilbert space~$\scrH$,
we'll use Kadison's characterisation~\cite{kadison1956}
of von Neumann algebras
as $C^*$-algebras
with a certain dcpo-structure (c.f.~\sref{hilb-suprema})
and sufficiently many Scott-continuous functionals (c.f.~\sref{bh-normal})
as our definition instead, see~\sref{vna}.

But we also use Kadison's definition
just to see
to what extent the representation
of von Neumann algebras
as rings of operators (see~\sref{ngns}) can be avoided
when erecting the basic theory.
Instead we'll put the directed suprema and normal 
positive functionals
on centre stage.
All the while
our treatment doesn't stray too far
from the beaten path,
and borrows
many arguments
from
the standard texts~\cite{sakai,kr};
but  most of them had to be tweaked in places, and
some demanded a complete overhaul.

The material on von Neumann algebras
is less tightly knit as the theory of $C^*$-algebras,
and so after the basics
we deal with four topics
more or less in linear order
(instead of intertwined.)

The great abundance of projections
(elements~$p$ with $p^*p=p$)
in von Neumann algebras---a definite advantage
over $C^*$-algebras---is
the first topic.
We'll see for example that
the existence of norm bounded directed suprema
in a von Neumann algebra~$\scrA$
allows us to show
that
there is a least projection~$\ceil{a}$
above any effect~$a$ from~$\scrA$
given by~$\ceil{a}=\bigvee_n a^{\nicefrac{1}{2}^n}$
(see~\sref{vna-ceil});
and also that any element of a von Neumann algebra
can be written as a norm limit
of linear combinations of projections (in~\sref{projections-norm-dense}).
Many a result about von Neumann algebras
can be proven by an appeal to projections.

The second topic concerns
two topologies that are instrumental
for the more delicate results and constructions:
the \emph{ultraweak topology}
induced by the normal positive functionals~$\omega\colon\scrA\to\C$,
and the \emph{ultrastrong topology}
induced by the associated seminorms~$\|\,\cdot\,\|_\omega$
(see~\sref{vna}).
We'll show among other things that a von Neumann algebra
is complete with respect to the ultrastrong topology
and \emph{bounded} complete with respect to the ultraweak topology
(see~\sref{vn-complete}).

This completeness allows us to
define,
for example,
for any pair~$a$, $b$ of elements
from a von Neumann algebra~$\scrA$
with~$a^*a\leq b^*b$
an element $a/b$
with~$a=(a/b) \, b $
(see~\sref{division})---this is the third topic.
Taking~$b=\sqrt{a^*a}$ we
obtain
the famous
polar decomposition~$a = (a/\sqrt{a^*a}) \, \sqrt{a^*a}$
(see~\sref{polar-decomposition},
which is usually proven 
for a bounded operator on a Hilbert space first).

The fourth, and final topic,
is ultraweakly continuous functionals
on a von Neumann algebra:
we'll show
in~\sref{vn-center-separating-fundamental}
that any centre separating collection (\sref{separating})
of normal positive functionals~$\Omega$
on a von Neumann algebra completely
determines the normal positive functionals,
which will be important for the definition of the tensor
product of von Neumann algebras in the next chapter,
see~\sref{tensor}.
\end{point}
\end{parsec}
\section{The Basics}
\subsection{Definition and Counterexamples}
\begin{parsec}{420}[vna]%
\begin{point}{10}{Definition (Kadison~\cite{kadison1956})}%
A $C^*$-algebra~$\scrA$
is a \Define{von Neumann algebra}%
\index{von Neumann algebra}
when
\begin{enumerate}
\item
every bounded directed subset~$D$
of self-adjoint elements of~$\scrA$ (so $D\subseteq \sa{\scrA}$) 
    has a supremum \Define{$\bigvee D$}%
\index{*infsup@$\bigvee D$, supremum of~$D$!in a von Neumann algebra}
    in $\sa{\scrA}$, and
\item
if $a$ is a positive element of~$\scrA$
with $\omega(a)=0$ for every \emph{normal} (see below) positive 
linear map $\omega\colon \scrA\to \C$,
then~$a=0$.\footnote{In other words,
the collection of normal positive functionals should be faithful
(see~\sref{separating}).
Interestingly,
it's already enough for the normal positive 
functionals to be centre separating,
but since we have encountered no example
of a von Neumann algebra
where it wasn't already clear that the normal positive 
functionals are faithful
instead of just centre separating
we did not use this weaker albeit more complex condition.}
\end{enumerate}
\spacingfix%
\begin{point}{20}[def-np-functional]%
A positive linear map $\omega\colon \scrA\to \C$
is called \Define{\textbf{n}ormal}%
\index{normal!functional}
if $\omega(\bigvee D) = \bigvee_{d\in D} \omega(d)$
for every bounded directed subset of self-adjoint elements of~$D$
which has a supremum $\bigvee D$ in $\sa{\scrA}$.
\begin{point}{21}
Recall that we use the letter ``n'' as abbreviation
for ``normal'', see~\sref{bh-normal-abbreviation}.
\end{point}
\end{point}%
\begin{point}{30}%
The \Define{ultraweak topology}
on $\scrA$
is the least topology
that makes all normal positive linear maps $\omega\colon \scrA\to \C$
continuous; the ultraweakly open subsets of~$\scrA$
are exactly the unions
of finite intersections of
sets of the form $\omega^{-1}(U)$, where
$\omega\colon \scrA\to\C$ is an np-map, 
and $U$ is an open subset of~$\C$.
One can verify that a net $(b_\alpha)_\alpha$
in~$\scrA$ converges ultraweakly to some~$b$ in~$\scrA$
    iff $\omega(b_\alpha)\to b$ for all
    np-maps $\omega\colon \scrA\to\C$.
The \Define{ultrastrong topology}%
\index{ultraweak and ultrastrong}
	on~$\scrA$
is the topology
induced by the seminorms
$\|\,\cdot\,\|_\omega$
associated to the np-maps $\omega\colon \scrA\to\C$
    (given by
$\|a\|_\omega \equiv \omega(a^*a)^{\nicefrac{1}{2}}$,
    see~\sref{omega-norm-basic});
a subset of~$\scrA$ is ultrastrongly open
iff it is the union of a finite intersections
of sets of the form
$\{\,a\in\scrA\colon\, \|a-b\|_\omega \leq \varepsilon\,\}$,
where~$b\in \scrA$, $\omega\colon \scrA\to\C$ is an np-map,
and~$\varepsilon>0$.
One can prove that a net~$(b_\alpha)_\alpha$
in~$\scrA$
converges ultrastrongly to an element~$b$ of~$\scrA$
    iff~$\|b_\alpha-b\|_\omega\to 0$ for all np-maps 
    $\omega\colon \scrA\to\C$.
\end{point}
\end{point}
\begin{point}{40}{Remark}%
We work with the ultraweak and ultrastrong topology in tandem,
because neither is ideal, and they tend to be complementary:
for example, $a\mapsto a^*$ is ultraweakly continuous
but not ultrastrongly (see~\sref{vn-counterexamples},
point~\ref{vn-counterexamples-4}), 
while $a\mapsto \left|a\right|$
is ultrastrongly continuous (see~\sref{abs-us-cont})
but not ultraweakly (\sref{vn-counterexamples}, 
point~\ref{vn-counterexamples-6}).
This doesn't prevent 
the ultraweak topology 
from being weaker than the ultrastrong topology:
a net that converges ultrastrongly converges ultraweakly as well,
see~\sref{uwweaker}.
\end{point}
\begin{point}{50}[von-neumann-examples]{Examples}%
\begin{enumerate}
\item
\index{C@$\C$, the complex numbers!as a von Neumann algebra}%
$\C$ and~$\{0\}$ are clearly von Neumann algebras.
\item
\index{BH@$\scrB(\scrH)$!as a von Neumann algebra}
The $C^*$-algebra $\scrB(\scrH)$
of bounded operators on a Hilbert space~$\scrH$
is a von Neumann algebra:
$\scrB(\scrH)$ has bounded directed suprema
of self-adjoint elements
by~\sref{hilb-suprema},
and the vector states
(and thus all normal functionals)
are order separating
(and thus faithful)
by~\sref{hilb-vector-states-order-separating}.
\item%
\index{direct sum!of von Neumann algebras}%
\index{$\bigoplus$, direct sum!$\bigoplus_i \scrA_i$, of von Neumann algebras}
The direct sum $\bigoplus_i \scrA_i$
(see~\sref{cstar-product})
of a family $(\scrA_i)_i$
of von Neumann algebras
is itself a von Neumann algebra.

(While we're not quite ready to define morphisms
between von Neumann algebras,
we can already spoil that the direct sum
gives the categorical product of von Neumann algebras
once we do,
see~\sref{vn-products}.)
\item
A $C^*$-subalgebra~$\scrB$
of a von Neumann algebra~$\scrA$
is called a \Define{von Neumann subalgebra}%
\index{von Neumann subalgebra}
(and is itself a von Neumann algebra)
if for every bounded directed subset~$D$
of self-adjoint elements from~$\scrB$
we have $\bigvee D\in\scrB$
(where the supremum is taken in~$\sa{\scrA}$).

\item[4a.]
Let~$S$ be a subset of a von Neumann algebra~$\scrA$.
Since the intersection of an arbitrary collection of von Neumann subalgebras
of~$\scrA$ is a von Neumann subalgebra of~$\scrA$ as well,
there is
        a least von Neumann subalgebra, $\Define{W^*(S)}$,%
\index{$W^*(S)$, von Neumann subalgebra generated by~$S$}
that contains~$S$.

\item
We'll see in~\sref{commutant-basic}
that given a subset~$S$ of a von Neumann algebra~$\scrA$
the set~$S^\square = \{\,a\in\scrA\colon\, \forall s\in S\,[\ as=sa\ ]\,\}$
called the \emph{commutant} of~$S$
is a von Neumann subalgebra of~$\scrA$
when~$S$ is closed under involution.
\item
We'll see in~\sref{mn-vna}
that the $N\times N$-matrices over a von Neumann algebra~$\scrA$
form a von Neumann algebra.
\item
We'll see in~\sref{Linfty-vn}
that the bounded measurable functions
on a finite complete measure space~$X$ 
(modulo the negligible ones)
form
a commutative von Neumann algebra~$L^\infty(X)$.

(Recall that a measure space~$X$ is called finite
when $\mu(X)<\infty$.)
\end{enumerate}
\spacingfix%
\end{point}%
\end{parsec}%
\begin{parsec}{430}%
\begin{point}{10}[uwweaker]{Exercise}%
Let~$\scrA$ be a von Neumann algebra.
\begin{enumerate}
\item
Show that 
$\left|\omega(a)\right|\leq \|a\|_\omega \|\omega\|^{\nicefrac{1}{2}}$
for every np-map $\omega\colon \scrA\to\C$
and~$a\in\scrA$.
\item
Show that when a net $(a_\alpha)_\alpha$
in~$\scrA$ converges ultrastrongly to~$a\in \scrA$
it does so ultraweakly, too.
\item
Show that an ultraweakly closed subset~$C$ of~$\scrA$
is also ultrastrongly closed.
\end{enumerate}%
\spacingfix%
\end{point}%
\begin{point}{11}[infima-in-vna]{Exercise}%
Note that given a von Neumann algebra~$\scrA$
the map $a\mapsto -a\colon \scrA\to\scrA$ 
is an order reversing isomorphism.

Deduce from this that any bounded filtered\footnote{`Filtered' is the
order dual of `directed':
    $F$ is
filtered when
for all~$a,b\in F$ there is~$c\in F$ with $c\leq a$ and~$c\leq b$.}
subset~$F$
of self-adjoint elements of~$\scrA$
has as infimum $\Define{\bigwedge F} := -\bigvee\{\,-d\colon \,d\in F\,\}$.%
\index{*inf@$\bigwedge F$, infimum of~$F$!in a von Neumann algebra}
\end{point}
\begin{point}{20}[vn-counterexamples]{Exercise}%
We give some counterexamples in $\scrB(\ell^2)$
to plausible propositions
to sharpen your understanding of the ultrastrong and ultraweak topologies,
and so that you may better appreciate
the strange manoeuvres we'll need to pull off later on.
\begin{enumerate}
\item
First some notation: given~$n,m\in \N$,
we denote by $\Define{\ketbra{n}{m}}$%
\index{*ketbranm@$\ketbra{n}{m}$, with $n,m\in\N$}
the bounded operator on~$\ell^2$
given by $(\ketbra{n}{m})(f)(n)=f(m)$
and~$(\ketbra{n}{m})(f)(k)=0$ for $k\neq n$
and $f\in \ell^2$.

Verify the following computation rules,
where $k,\ell,m,n\in \N$.
\begin{equation*}
(\ketbra{n}{m})^*\ =\ \ketbra{m}{n},
\qquad
\ketbra{n}{m}\ketbra{\ell}{k}\ =\ 
\begin{cases}
\ \ \ketbra{n}{k} & \text{if $m=\ell$} \\
\ \ 0 & \text{otherwise}
\end{cases}
\end{equation*}
\item
Show that $\bigvee_N \sum_{n=0}^N \ketbra{n}{n}=1$.

Conclude that~$(\,\ketbra{n}{n}\,)_n$
converges ultrastrongly (and ultraweakly) to~$0$.

Thus ultrastrong (and ultraweak) convergence does not imply norm convergence,
which isn't unexpected.
But we also see that if a sequence~$(b_n)_n$ converges ultrastrongly
(or ultraweakly) to some~$b$,
then $(\|b_n\|)_n$ doesn't even have to converge to~$\|b\|$.

(Note that~$(\ketbra{n}{n})_n$ resembles a `moving bump'.)
\item
Note that when a net $(a_\alpha)_\alpha$
converges ultrastrongly to~$a$,
then $(\,a_\alpha^*a_\alpha\,)_\alpha$
is norm-bounded and
converges ultraweakly to~$a^*a$.

The converse does not hold:
show that (already in~$\C$)
$e^{in}$
does not converge ultraweakly 
(nor ultrastrongly) as $n\to \infty$,
while $1\equiv e^{-in} e^{in}$
is norm-bounded and
converges ultraweakly to~$1$ as~$n\to\infty$.
\item
\label{vn-counterexamples-4}
Show that~$(\,\ketbra{0}{n}\,)_n$ converges ultrastrongly 
(and ultraweakly) to~$0$.

Deduce that $(\,\ketbra{n}{0}\,)_n$ converges ultraweakly to~$0$,
but doesn't converge ultrastrongly at all.

Conclude that~$a\mapsto a^*$ is not ultrastrongly continuous 
on~$\scrB(\ell^2)$.

(This has the annoying side-effect
that it is not immediately clear that the ultrastrong
closure of a $C^*$-subalgebra of a von Neumann algebra 
is a von Neumann subalgebra; we'll deal with this
by showing that the ultrastrong closure coincides
with the ultraweak closure in~\sref{ultraclosed}.)
\item
Show that the unit ball~$(\,\scrB(\ell^2)\,)_1$
of~$\scrB(\ell^2)$ is not ultrastrongly compact
by proving that $(\,\ketbra{0}{n}\,)_n$
has no ultrastrongly convergent subnet.

(But we'll see in~\sref{vn-ball-compact} that
the unit ball of a von Neumann algebra
is ultraweakly compact.)

\item
\label{vn-counterexamples-6}
Show that $\ketbra{n}{0}+\ketbra{0}{n}$
converges ultraweakly to~$0$ as $n\to \infty$,
while $(\ketbra{n}{0}+\ketbra{0}{n})^2\equiv \ketbra{0}{0}+\ketbra{n}{n}$
converges ultraweakly to~$\ketbra{0}{0}$.

Conclude that~$a\mapsto a^2$ is not ultraweakly continuous on~$\scrB(\ell^2)$.

Conclude that $a,b\mapsto ab$ is not jointly ultraweakly continuous
on~$\scrB(\ell^2)$.

Prove that~$\left|\, \ketbra{n}{0}+\ketbra{0}{n}\,\right|
= \ketbra{0}{0}+\ketbra{n}{n}$.

Conclude that~$a\mapsto \left|a\right|$
is not ultraweakly continuous on~$\sa{(\scrB(\ell^2))}$.

(We'll see in~\sref{proto-kaplansky} that $a\mapsto \left|a\right|$
is ultrastrongly continuous on self-adjoint elements.)

\item
Let us consider the two extensions of~$\left|\,\cdot\,\right|$
to arbitrary elements, namely
$a\mapsto \sqrt{a^*a}=:\Define{\left|a\right|_s}$ and 
$a\mapsto \sqrt{aa^*}=:\Define{\left|a\right|_r}$
(for \textbf{s}upport and \textbf{r}ange,
c.f.~\sref{hilb-ceil}).

Prove that $\ketbra{0}{0} + \ketbra{0}{n}$
converges ultrastrongly to~$\ketbra{0}{0}$ as $n\to \infty$.

Show that $\left|\,\ketbra{0}{0}+\ketbra{0}{n}\,\right|_s
= \ketbra{0}{0}
+\ketbra{0}{n}
+\ketbra{n}{0}
+\ketbra{n}{n}$
converges ultraweakly to~$\left|\,\ketbra{0}{0}\,\right|_s
\equiv \ketbra{0}{0}$
as $n\to \infty$,
but not ultrastrongly.

Show that $\left|\,\ketbra{0}{0}+\ketbra{0}{n}\,\right|_r
= \sqrt{2} \ketbra{0}{0}$.

Conclude that $\left|\,\cdot\,\right|_s$
and $\left|\,\cdot\,\right|_r$
are not ultrastrongly continuous on~$\scrB(\ell^2)$.

\item
Show that $1+\ketbra{n}{0}+\ketbra{0}{n}$
is positive,
and 
converges ultraweakly to~$1$ as~$n\to\infty$,
while the squares
$1+\ketbra{n}{n}+\ketbra{0}{0}+2\ketbra{n}{0}+2\ketbra{0}{n}$
converge ultraweakly to $1+\ketbra{0}{0}$
(as $n\to\infty$).

Hence~$a\mapsto a^2$
and $a\mapsto \sqrt{a}$
are not ultraweakly continuous on $\pos{\scrB(\ell^2)}$.

\item
\label{vn-counterexamples-9}
For the next counterexample,
we need a growing moving bump,
which still converges ultraweakly.
Sequences won't work here:

Show that $n\ketbra{n}{n}$ does not converge ultraweakly as~$n\to\infty$.

Show that $n \ketbra{f(n)}{f(n)}$ does not converge ultraweakly
as $n\to\infty$
for every strictly monotone (increasing) map~$f\colon \N\to\N$.

So we'll resort to a net.
Let~$D$ be the directed set which consists of pairs $(n,f)$,
where $n\in \N\backslash\{0\}$ and $f\colon \N\to\N$
is monotone, ordered by $(n,f)\leq (m,g)$ iff $n\leq m$ and $f\leq g$.

Show that the net $(\, n\ketbra{f(n)}{f(n)}\,)_{n,f\in D}$
converges ultrastrongly to~$0$.

So a net which converges ultrastrongly need not be bounded!
(The cure for this pathology is Kaplansky's density theorem, 
see~\sref{kaplansky}.)

Show that $\frac{1}{n} \ketbra{f(n)}{0}$
converges ultrastrongly to~$0$ as $D\ni(n,f)\to \infty$.

Show that the product
$\ketbra{f(n)}{0} = (\,n\ketbra{f(n)}{f(n)}\,)\,(\,\frac{1}{n}
\ketbra{f(n)}{0}\,)$
does not converge ultrastrongly 
as $D\ni(n,f)\to\infty$.

Conclude that multiplication $a,b\mapsto ab$
is not jointly ultrastrongly continuous on~$\scrB(\ell^2)$,
even when~$b$ is restricted to a bounded set.

(Nevertheless we'll see that multiplication is ultrastrongly continuous
when~$a$ is restricted to a bounded set in~\sref{mult-jus-cont}.)

\item
Show that
$a_{n,f} = \frac{1}{n}(\ketbra{f(n)}{0}+\ketbra{0}{f(n)})
\,+\, n\ketbra{f(n)}{f(n)}$
converges ultrastrongly to~$0$
as $D\ni(n,f)\to\infty$,
while $a_{n,f}^2$ does not.

Hence~$a\mapsto a^2$ is not ultrastrongly continuous on~$\sa{\scrB(\ell^2)}$.

\item
Let us show that~$\scrB(\ell^2)$
is not ultraweakly complete.

Show that there is an unbounded linear map~$f\colon \ell^2\to\C$
(perhaps using the fact that every vector space
has a basis by the axiom of choice),
and that for each finite dimensional linear subspace~$S$ of~$\ell^2$
there is a unique vector~$x_S\in S$ 
with
$f(x)=\left<x_S,y\right>$ for all~$y\in S$
(using~\sref{riesz-representation-theorem}).

Consider the net~$(\,\ketbra{e}{x_S}\,)_S$
where~$S$ ranges over the finite dimensional subspaces of~$\ell^2$
ordered by inclusion,
and~$e$ is some fixed vector in~$\ell^2$ with~$\|e\|=1$.

Let~$\omega\colon \scrB(\ell^2)\to\C$
be an np-map,
so $\omega\equiv \sum_n \left<y_n,(\,\cdot\,)y_n\right>$
for $y_1,y_2,\dotsc \in \ell^2$ with $\sum_n \|y_n\|^2 <\infty$,
see~\sref{bh-np}.

Show that $\omega(\,\ketbra{e}{x_S}-\ketbra{e}{x_T}\,)
= \left<\,x_S-x_T,\,\sum_n y_n\left<y_n,e\right>\,\right> = 0$
when $S$ and~$T$ are finite dimensional linear subspaces of~$\ell_2$
which contain the vector $\sum_n y_n\left<y_n,e\right>$.

Conclude that~$(\,\ketbra{e}{x_S}\,)_S$
is ultraweakly Cauchy.

Show that if~$(\,\ketbra{e}{x_S}\,)_S$
converges ultraweakly to some~$A$ in~$\scrB(\ell^2)$,
then we have~$\left<e,Ay\right>=f(y)$
for all~$y\in\ell^2$.

Conclude that~$(\,\ketbra{e}{x_S}\,)_S$
does not converge ultraweakly,
and that~$\scrB(\ell^2)$ is not ultraweakly complete.

(Nevertheless, we'll see that every von Neumann algebra
is ultrastrongly complete, and that
every norm-bounded ultraweakly Cauchy net
in a von Neumann converges, in~\sref{vn-complete}.)
\end{enumerate}
\spacingfix%
\end{point}%
\end{parsec}%
\subsection{Elementary Theory}
%
% multiplication turns suprema into ultraweak limits
%
\begin{parsec}{440}%
\begin{point}{10}%
The basic facts concerning von Neumann algebras
we'll deal with first mostly involve the
relationship
between
multiplication
and the order structure.
For example,
while it is clear that translation and scaling
on a von Neumann algebra
are ultraweakly (and ultrastrongly) continuous,
the fact
that multiplication is ultraweakly (and ultrastrongly)
continuous in each coordinate is
less obvious (see~\sref{mult-uws-cont}).
Quite surprisingly,
this problem reduces to the ultraweak continuity
of $b\mapsto a^*ba$ by the following identity.
\end{point}
\begin{point}{20}[mult-polarization]{Exercise}%
\index{polarisation identity!in a von Neumann algebra}
Show that for elements~$a,b,c$ of a $C^*$-algebra,
\begin{equation*}
\textstyle
a^*\,c\,b\ =\ \frac{1}{4}\,\sum_{k=0}^3\ i^k\  (i^ka+b)^*\,c\,(i^ka+b).
\end{equation*}
(Note that this identity is a variation on the polarisation
identity for inner products,
see~\sref{inner-product-basic}.)
\end{point}
\begin{point}{30}[vanishing-effects]{Lemma}%
Let~$(x_\alpha)_{\alpha\in D}$ be 
a net of effects of a von Neumann algebra~$\scrA$,
which converges ultraweakly to~$0$.
Let~$(b_\alpha)_{\alpha\in D}$ be a 
net of elements with~$\|b_\alpha\| \leq 1$ for all~$\alpha$.
Then $(x_\alpha b_\alpha)_\alpha$ converges ultraweakly
to~$0$.
\begin{point}{40}{Proof}%
Let~$\omega\colon \scrA\to \C$ be an np-map.
We have, for each~$\alpha$,
\begin{alignat*}{3}
\left|\,\omega(x_\alpha b_\alpha)\,\right|^2
\ &=\ 
\left|\, \omega(\,\sqrt{x_\alpha}\,\sqrt{x_\alpha}\,b_\alpha\,)\, \right|^2
\qquad&&\text{since $x_\alpha\geq 0$}\\
\ &\leq\ 
\omega(x_\alpha)\  \omega(\,b_\alpha^* x_\alpha b_\alpha\,) 
\qquad&&\text{by Kadison's inequality, \sref{omega-norm-basic}}\\
\ &\leq\ 
\omega(x_\alpha)\ \omega(b_\alpha^* b_\alpha)
\qquad&&\text{since $x_\alpha\leq 1$}\\
\ &\leq\ 
\omega(x_\alpha)\ \omega(1)
\qquad&&\text{since $b_\alpha^*b_\alpha\leq 1$}.
\end{alignat*}
Thus,
since $(\omega(x_\alpha))_\alpha$
converges to~$0$,
we see that $(\omega(x_\alpha b_\alpha))_\alpha$
converges to~$0$,
and so $(x_\alpha b_\alpha)_\alpha$ converges ultraweakly to~$0$.\qed
\end{point}
\end{point}
\begin{point}{50}{Exercise}%
Let~$D$ be a bounded directed set of self-adjoint
elements of a von Neumann algebra~$\scrA$,
and let~$a\in \scrA$.
\begin{point}{60}[vna-supremum-uwlimit]%
Show that the net~$(d)_{d\in D}$ converges ultraweakly to~$\bigvee D$.
\end{point}
\begin{point}{70}[vna-supremum-mult]%
Use~\sref{vanishing-effects}
to show that $(da)_d$ converges ultraweakly to~$(\bigvee D)a$,
and that~$(a^*d)_d$ converges ultraweakly to~$a^* (\bigvee D)$.
\end{point}
\end{point}
%
%  ad is normal
%
\begin{point}{80}[ad-normal]{Proposition}%
Let~$a$ be an element of a von Neumann algebra~$\scrA$.
Then
\begin{equation*}
	\textstyle
	\bigvee_{d\in D} a^*\,d\,a \ =\  a^*\,(\bigvee D)\, a
\end{equation*}
for every bounded directed subset~$D$ of self-adjoint
elements of~$\scrA$.
\begin{point}{90}[ad-normal-1]{Proof}%
If~$a$ is invertible,
then the (by~\sref{astara-pos-basic-consequences}) order preserving map $b\mapsto a^*ba$
has an order preserving inverse (namely $b\mapsto (a^{-1})^* b a^{-1}$),
and therefore preserves all suprema.
\begin{point}{100}%
The general case reduces to the case that~$a$ 
is invertible
in the following way.
There is (by~\sref{spectrum-bounded})
 $\lambda>0$ such that $\lambda+a$ is invertible.
Then as $d$ increases 
\begin{equation*}
a^*\,d\,a \ \equiv\  (\lambda+a)^*\,d\,(\lambda+a) \,-\,
 \lambda^2d \,-\, \lambda a^*d \,-\, \lambda da
\end{equation*}
converges ultraweakly
to~$a^* \,(\bigvee D)\,a$,
because $(\ (\lambda+a)^*\,d\,(\lambda+a)\ )_d$
converges ultraweakly to $(\lambda+a)^*\,(\bigvee D)\,(\lambda+a)$
by~\sref{ad-normal-1} and~\sref{vna-supremum-uwlimit},
and $(a^*d+da)_d$ converges ultraweakly to $a^*(\bigvee D)+(\bigvee D)a$
by~\sref{vna-supremum-mult}.
Since~$(a^*da)_d$ converges to~$\bigvee_{d\in D} a^*d a$ too,
we could conclude that
$\bigvee_{d\in D} a^* \,d\, a = a^*\,(\bigvee D)\,a$
if we would already know that the ultraweak topology is Hausdorff.
At the moment, however,
we must content ourselves with
the conclusion that
	$\omega(\,a^*(\bigvee D) a\,-\, \bigvee_{d\in D} a^* d a\,)=0$
for every np-functional~$\omega$ on~$\scrA$.
But since
	$a^*(\bigvee D) a - 
\bigvee_{d\in D} a^* da$
happens to be positive,
we conclude that
	$a^*(\bigvee D) a  
- \bigvee_{d\in D} a^* d a =0$
nonetheless.\qed
\end{point}
\end{point}
\end{point}
\begin{point}{110}[vn-positive-basic]{Exercise}%
Show that the set of np-functionals
on a von Neumann algebra~$\scrA$
is not only faithful 
but also order separating
using~\sref{proto-gelfand-naimark}.
Deduce
\begin{enumerate}%
\item%
\index{ultraweak and ultrastrong!topologies are Hausdorff}%
that the ultraweak and ultrastrong topologies
are Hausdorff,
\item
that~$\scrA_+$, 
$\sa{\scrA}$ and~$[0,1]_\scrA$  are ultraweakly 
(and ultrastrongly) closed, 
\item
and that the unit ball
$(\scrA)_1$
is ultrastrongly closed.

(We'll see only later on, in~\sref{ultraclosed},
that~$(\scrA)_1$
is ultraweakly closed as well.)
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{120}{Exercise}%
Let~$D$ be a directed subset of self-adjoint elements
of a von Neumann algebra~$\scrA$,
and let~$a\in\scrA$.
\begin{point}{130}[vna-supremum-commutes]%
Show that if~$ad=da$ for all~$d\in D$,
then $a(\bigvee D) = (\bigvee D)a $.
\end{point}
\begin{point}{140}[vna-supremum-uslimit]%
Use~\sref{vanishing-effects}
to show that $(\bigvee D-d)^2$ converges ultraweakly to~$0$
as $D\ni d\to\infty$.

Conclude that~$(d)_{d\in D}$ converges ultrastrongly to~$\bigvee D$.
\end{point}
\end{point}
\begin{point}{150}[p-uwcont]{Exercise}%
Show that for a positive linear map $f\colon \scrA\to\scrB$
between von Neumann algebras,
the following are equivalent.
\begin{enumerate}
\item
$f$ is ultraweakly continuous;
\item
$f$ is ultraweakly continuous on~$[0,1]_\scrA$;
\item
$f(\bigvee D)=\bigvee_{d\in D}f(d)$ for each bounded 
directed~$D\subseteq\sa{\scrA}$;
\item 
$\omega\circ f\colon \scrA\to\C$ is normal 
for each np-map $\omega\colon \scrB\to\C$.
\end{enumerate}
In that case we say that~$f$ is \Define{\textbf{n}ormal}.%
\index{normal!positive map between von Neumann algebras}
(Note that this definition of ``normal'' extends the one
for positive functionals
from~\sref{def-np-functional}.)

Conclude that $b\mapsto a^*ba,\,\scrA\to\scrA$%
\index{$a^*(\,\cdot\,)a\colon \scrA\to\scrA$!is normal}
is ultraweakly
continuous for every element~$a$ of a von Neumann 
algebra~$\scrA$.
\end{point}
\end{parsec}
\begin{parsec}{450}%
\begin{point}{10}{Exercise}%
Show that if a positive linear map $f\colon \scrA\to\scrB$
between von Neumann algebras 
is ultrastrongly continuous (on~$[0,1]_\scrA$), 
then~$f$ is normal.
(Hint: use that a bounded directed set 
$D\subseteq \sa{\scrA}$ converges ultrastrongly to~$\bigvee D$.)

The converse does not hold: give an example of a map~$f$ 
which is normal, but 
not ultrastrongly continuous. (Hint: transpose.)
\end{point}
\begin{point}{20}[cp-uscont]{Proposition}%
An ncp-map $f\colon \scrA\to\scrB$
between von Neumann algebras is 
ultrastrongly continuous.
\begin{point}{30}{Proof}%
Note that $f$ is ultrastrongly continuous at~$a\in\scrA$
iff $f((\,\cdot\,)+a)\equiv f + f(a)$ is ultrastrongly continuous at~$0$.
Thus to show that~$f$
is ultrastrongly continuous
it suffices to show that~$f$ is ultrastrongly continuous at~$0$.
So let~$(b_\alpha)_\alpha$ be a net in~$\scrA$
which converges ultrastrongly to~$0$;
we must show that $(f(b_\alpha))_\alpha$
converges ultrastrongly to~$0$, viz.~that
$(\,f(b_\alpha)^*f(b_\alpha)\,)_\alpha$ converges ultraweakly to~$0$.
Since
$f(b_\alpha)^*f(b_\alpha) \leq f(b_\alpha^*b_\alpha) \|f(1)\|$
by~\sref{cp-cs}, 
it suffices to show that~$(\,f(b_\alpha^*b_\alpha)\,)_\alpha$
converges ultraweakly to~$0$,
but this follows from the
facts that~$f$ is ultraweakly continuous
and~$(b_\alpha^*b_\alpha)_\alpha$
converges ultraweakly to~$0$
(since~$(b_\alpha)_\alpha$ converges ultrastrongly to~$0$).\qed
\end{point}
\end{point}
\begin{point}{40}[mult-uws-cont]{Exercise}%
Let~$\scrA$ be a von Neumann algebra.
Conclude (using~\sref{cp-uscont} and~\sref{ad-cp})
that the map $a\mapsto b^*ab,\,\scrA\to\scrA$
is ultrastrongly continuous for every
 element~$b\in\scrA$.

Use this,
and~\sref{mult-polarization},
to
show that $b\mapsto ab,\,ba\colon\ \scrA\to\scrA$
are ultraweakly and ultrastrongly continuous
for every element~$a$ of a von Neumann algebra~$\scrA$.
\end{point}
\begin{point}{50}%
We saw in~\sref{vn-counterexamples}
that the multiplication on a von Neumann algebra 
is not jointly ultraweakly continuous,
even on a bounded set.
Neither is $a,b\mapsto ab$ jointly ultrastrongly continuous,
even when~$b$ is restricted to a bounded set;
but it \emph{is} jointly 
ultrastrongly continuous when~$a$ is restricted to a bounded set:
\end{point}
\begin{point}{60}[mult-jus-cont]{Proposition}%
Let $(a_\alpha)_\alpha$
and~$(b_\alpha)_\alpha$
be nets
in a von Neumann algebra~$\scrA$
with the same index set
that converge ultrastrongly to~$a,b\in\scrA$, respectively.
Then the net~$(a_\alpha b_\alpha)_\alpha$
converges ultrastrongly to~$ab$
provided that~$(a_\alpha)_\alpha$
is bounded.
\begin{point}{70}{Proof}%
Let $\omega\colon \scrA\to\C$
be an np-functional.
Since
\begin{alignat*}{3}
\|ab-a_\alpha b_\alpha\|_\omega
\ &\leq\ 
	\|(a -a_\alpha)b\|_\omega
	\,+\, 
	\|a_\alpha(b-b_\alpha)\|_\omega
	\\
\ &\leq\ 
	\|a -a_\alpha\|_{\omega(b^*(\,\cdot\,)b)}
	\,+\, 
	\|a_\alpha\|\|b-b_\alpha\|_\omega
\end{alignat*}
vanishes as~$\alpha\to\infty$,
	we see that~$(a_\alpha b_\alpha)_\alpha$
converges ultrastrongly to~$ab$.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{460}%
\begin{point}{10}%
We can now prove a bit more 
about the ultrastrong and ultraweak topologies.
\end{point}
\begin{point}{20}[usconv]{Exercise}%
Show that a net $(b_\alpha)_\alpha$ 
in a von Neumann algebra~$\scrA$
converges ultrastrongly to an element~$b$
of~$\scrA$
if and only if
both $b_\alpha^*b_\alpha\longrightarrow b^*b$
and~$b_\alpha\longrightarrow b$
ultraweakly as~$\alpha\to\infty$.
\end{point}
\begin{point}{30}[npuws]{Exercise}%
\index{normal!positive functional}%
Show that for a positive linear map $\omega \colon \scrA\to\C$
on a von Neumann algebra~$\scrA$
the following are equivalent
\begin{enumerate}
\item
	$\omega$ is normal;
\item
	$\omega$ is ultraweakly continuous;
\item
	$\omega$ is ultrastrongly continuous.
\end{enumerate}
(Hint: combine~\sref{p-uwcont} and \sref{cp-uscont}.)
\end{point}
\end{parsec}
\begin{parsec}{470}%
\begin{point}{10}%
Enter the eponymous hero(s) of this thesis.
\end{point}
\begin{point}{20}{Definition}%
We denote 
the category of
\emph{normal} cpsu-maps
by~$\Define{\W{cpsu}}$,
and its subcategory of nmiu-maps
by~$\Define{\W{miu}}$.
\index{Wmiu@$\W{miu}$, $\W{cpsu}$, \dots}%
(We omit the ``N'' for the sake of brevity.)
\begin{point}{30}%
Though arguably~$\W{miu}$
is a good candidate
for being called \emph{the} category of von Neumann algebra,
the title of this thesis refers to~$\W{cpsu}$.%
\index{category of von Neumann algebras}%
\index{von Neumann algebra!category of}
Indeed, it's the ncpsu-maps between von Neumann algebras
that stand to model the arbitrary quantum processes,
and it's the category of these quantum processes
we want to mine for abstract structure.
This is mostly a task for the next chapter,
though.
For now we'll just establish that~$\W{cpsu}$
has all products, \sref{vn-products}, certain equalisers,
\sref{vn-equalisers},
and that $\op{(\W{cpsu})}$ is an \emph{effectus}, see~\sref{vn-effectus}.
\end{point}
\end{point}
\begin{point}{40}[vn-products]{Exercise}%
\index{product!in $\W{miu}$ and $\W{cpsu}$}
Show that
given a family $(\scrA_i)_i$
of von Neumann algebras
the direct sum
$\bigoplus_i \scrA_i$
from~\sref{cstar-product}
is a von Neumann algebra
and  the projections
$\pi_j \colon \bigoplus_i \scrA_i\to\scrA_j$
are normal.
Moreover, show
that this makes~$\bigoplus_i \scrA_i$
into the  product of the~$\scrA_i$
in the categories~$\W{miu}$ and~$\W{cpsu}$
(see~\sref{cstar-product-2} and~\sref{cstar-product-4}).
\end{point}
\begin{point}{50}[vn-equalisers]{Exercise}%
\index{equaliser!in $\W{miu}$ and $\W{cpsu}$}
Show that given nmiu-maps $f,g\colon \scrA\to\scrB$
between von Neumann algebras
the set~$\scrE:=\{\,a\in\scrA\colon\, f(a)=g(a)\,\}$
is a von Neumann subalgebra of~$\scrA$,
and the inclusion~$e\colon \scrE\to\scrA$
is the equaliser of~$f$ and~$g$ in the 
categories~$\W{miu}$ and~$\W{cpsu}$
(see~\sref{cstar-equaliser-1} and~\sref{cstar-product-4}).
\end{point}
\begin{point}{60}[vn-effectus]
Let us briefly indicate what makes~$\op{(\W{cpsu})}$ an effectus;
for a precise formulation and proof of this fact
we refer to~\cite{effintro,kentapartial}
(or~\sref{effectus-vn}, 
\sref{effectus-in-partial-form}, and \sref{cho-thm} ahead).
Note that the sum $f+g$ of two ncpsu-maps
$f,g\colon \scrA\to\scrB$ between von Neumann algebras
is again an ncpsu-map
iff~$f(1)+g(1)\leq 1$.
The partial addition on ncpsu-maps
thereby defined
has, aside from some fairly obvious properties
(summarised by the
fact that the category~$\W{cpsu}$
    is $\Cat{PCM}$-enriched, see~\cite{kentapartial}),
the following special trait:
given ncpsu-maps $f\colon \scrA\to\scrD$
and $g\colon \scrB\to\scrD$
with $f(1)+g(1)\leq 1$
we may form an ncpsu-map $[f,g]\colon \scrA\times \scrB\to \scrD$
by $[f,g](a,b)=f(a)+g(b)$,
and, moreover,
every ncpsu-map $\scrA\times\scrB\to\scrD$ is of this form.
This observation, which gives the product of~$\W{cpsu}$ a coproduct-like quality
without forcing it to be a biproduct (which it's not),
	makes $\op{(\W{cpsu})}$ a \emph{FinPAC}\index{FinPAC} 
	(see~\sref{effectus-in-partial-form}).

	For~$\op{(\W{cpsu})}$ to be an effectus,\index{effectus}
we need a second ingredient:
 the complex numbers,~$\C$.
Since the ncpsu-maps $p\colon \C\to \scrA$
are all of the form $\lambda \mapsto \lambda a$
for some effect $a\in [0,1]_\scrA$,
the ncpsu-maps $p\colon \C\to\scrA$
(called \emph{predicates} in this context)
are not only endowed with a partial addition,
but even form an \emph{effect algebra}.
This,
combined with the observation that
an ncpsu-map $f\colon \scrA\to\scrB$
is constant zero iff~$f(1)=0$,
makes~$\op{(\W{cpsu})}$
an \emph{effectus in partial form} (see~\sref{effectus-in-partial-form}).

As you can see, there's nothing deep underlying~$\op{(\W{cpsu})}$
being an effectus.
In that respect effectus theory resembles topology:
just as a topology 
provides a basis for  
notions such as compactness, connectedness, meagerness, and homotopy,
so does an
effectus provide a framework to study
 aspects of  computation
such as side effects (\sref{sefp}) and purity
(\sref{pure-effectus}).
\end{point}
\end{parsec}
\begin{parsec}{480}%
\begin{point}{10}%
Let us quickly prove that every von Neumann algebra
is isomorphic to a von Neumann algebra of operators on a 
Hilbert space (see~\sref{ngns}).
\end{point}
\begin{point}{20}[normal-faithful]{Exercise}%
\index{normal!positive map between von Neumann algebras}
Let~$\Omega$ be a collection of np-functionals
on a von Neumann algebra~$\scrB$
that is faithful (see~\sref{separating}).
Show that a positive linear map $f\colon \scrA\to\scrB$
is normal iff~$\omega\circ f$
is normal for all~$\omega\in\Omega$.
\end{point}
\begin{point}{30}{Proposition}%
\index{rhoomega@$\varrho_\omega$!is normal}
Given an np-map~$\omega\colon \scrA \to \C$
on a von Neumann algebra~$\scrA$,
the map $\varrho_\omega\colon \scrA\to\scrB(\scrH_\omega)$
from~\sref{gns} is normal.
\begin{point}{40}{Proof}%
Since by definition of~$\scrH_\omega$
the vectors of the form~$\eta_\omega(a)$
where~$a\in\scrA$
are dense in~$\scrH_\omega$,
the vector functionals
$\left<\eta_\omega(a),(\,\cdot\,)\eta_\omega(a)\right>$
form a faithful collection
of np-functionals on~$\scrB(\scrH_\omega)$.
Thus by~\sref{normal-faithful}
it suffices to show given~$a\in\scrA$
that $\left<\eta_\omega(a),\varrho_\omega(\,\cdot\,)
\eta_\omega(a)\right>\equiv \omega(a^*(\,\cdot\,)a)$ is normal,
which it is, by~\sref{ad-normal}.\qed
\end{point}
\end{point}
\begin{point}{50}[varrho-Omega-normal]{Exercise}%
\index{rhoOmega@$\varrho_\Omega$!is normal}
Show that the map $\varrho_\Omega$ 
from~\sref{gelfand-naimark-representation}
is normal for every collection~$\Omega$ of np-maps $\scrA\to\C$
on a von Neumann algebra $\scrA$.
\end{point}
\begin{point}{60}[injective-nmiu-iso-on-image]{Lemma}%
Let~$f\colon \scrA\to\scrB$ be an injective nmiu-map
between von Neumann algebras.
Then the image~$f(\scrA)$ is a von Neumann subalgebra of~$\scrB$,
and~$f$ restricts to an nmiu-isomorphism from~$\scrA$
to~$f(\scrA)$.
\begin{point}{70}{Proof}%
We already know by~\sref{injective-miu-iso-on-image}
that~$f(\scrA)$ is a $C^*$-subalgebra of~$\scrA$,
and that~$f$ restricts to an miu-isomorphism~$f'\colon \scrA\to f(\scrA)$.
The only thing left to show is that~$f(\scrA)$
is a von Neumann subalgebra of~$\scrB$,
because an miu-isomorphism between von Neumann algebras
(being an order isomorphism)
will automatically be an nmiu-isomorphism.
Let~$D$ be a bounded directed subset of~$f(\scrA)$.
Note that~$S:=(f')^{-1}(D)$ is a bounded
directed subset of~$\scrA$,
and so~$\bigvee D\equiv  \bigvee f(\,S\,)
= f(\bigvee S)$, because~$f$ is normal.
Thus~$\bigvee f(D)\in f(\scrA)$,
and so $f(\scrA)$ is a von Neumann subalgebra of~$\scrB$.\qed
\end{point}
\end{point}
\begin{point}{80}[ngns]{Theorem (normal Gelfand--Naimark)}%
\index{Gelfand--Naimark's Theorem!for von Neumann algebras}%
Every von Neumann algebra~$\scrA$ is nmiu-isomorphic
to von Neumann algebra of operators on a Hilbert space.
\begin{point}{90}[ngns-proof]{Proof}%
Recall that an element $a\in \scrA$ is zero iff $\omega(a)=0$
for all np-maps $\omega\colon \scrA\to\C$.
It follows that the collection~$\Omega$
of all np-maps $\scrA\to\C$
obeys the condition of~\sref{proto-gelfand-naimark},
and so the miu-map $\varrho_\Omega\colon \scrA\to\scrB(\scrH_\Omega)$
(from~\sref{gelfand-naimark-representation})
is injective.
Since~$\varrho_\Omega$
is also normal by~\sref{varrho-Omega-normal},
we see by~\sref{injective-nmiu-iso-on-image} that~$\varrho_\Omega$
restricts to an nmiu-isomorphism
from~$\scrA$ to the von Neumann subalgebra~$\varrho_\Omega(\scrA)$
of~$\scrB(\scrH_\Omega)$.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Examples}
\subsubsection{Matrices over von Neumann algebras} 
\begin{parsec}{490}%
\begin{point}{10}%
We'll show that the $C^*$-algebra
of $N\times N$-matrices~$M_N(\scrA)$
over a von Neumann algebra~$\scrA$
is itself a von Neumann algebra,
and to this end,
we prove something a bit more more general.
\end{point}
\begin{point}{20}[bah-vn]{Theorem}%
Given a von Neumann algebra~$\scrA$,
the~$C^*$-algebra $\scrB^a(X)$ (\sref{bax-cstar})%
\index{BaX@$\scrB^a(X)$!as a von Neumann algebra}
of bounded adjointable module maps on
a self-dual (\sref{self-dual}) Hilbert $\scrA$-module~$X$
is a  von Neumann algebra,
and
$\left<x,(\,\cdot\,)x\right>\colon \scrB^a(X)\to\scrA$
is normal for every~$x\in X$.%
\index{vector functional!is normal}
\begin{point}{30}{Proof}%
We'll first show that
a  bounded directed subset~$\scrD$ of~$\Real{\scrB^a(X)}$
has a supremum (in~$\Real{\scrB^a(X)}$).
To obtain a candidate for this supremum,
we first define
a bounded form~$[\,\cdot\,,\,\cdot\,]\colon X\times X\to\scrA$
in the sense of~\sref{chilb-form}
and apply~\sref{chilb-form-representation}.
To this end note that given~$x\in X$
the subset~$\{\,\left<x,Tx\right>\colon \, T\in\scrD\,\}$
of~$\Real{\scrA}$
is bounded and directed,
and so 
(since~$\scrA$ is a von Neumann algebra)
has a supremum.
Since the 
net $(\,\left<x,Tx\right>\,)_{T\in \scrD}$
converges ultraweakly to this supremum
by~\sref{vna-supremum-uwlimit},
we see that
$\left<y,Tz\right>\,= \,\frac{1}{4}
\sum_{k=0}^3
i^k\left<y+i^kz,\smash{T(y+i^kz)}\right>$
converges ultraweakly to 
some element~$[y,z]$ of~$\scrA$
as~$T\to\infty$ for all~$y,z\in X$,
giving us a form~$[\,\cdot\,,\,\cdot\,]$ on~$X$.
Since~$\left\|\left<y,T z \right>\right\|
\leq \sup_{T'\in \scrD} \|T'\| \|y\|\|z\|$
for all~$T\in\scrD$
by~\sref{chilb-form-bounded},
and thus~$\|[y,z]\|\leq \sup_{T'\in\scrD} \|T'\|\|y\|\|z\|$
for all~$y,z\in X$,
we see that the form~$[\,\cdot\,,\,\cdot\,]$
is bounded.
Since~$X$ is self dual,
there is
by~\sref{chilb-form-representation}
$S\in \scrB^a(X)$
with
$[y,z]=\left<y,Sz\right>$
for all~$y,z\in X$;
we'll show that~$S$ is the supremum of~$\scrD$.

To begin,
given~$T\in\scrD$
we have~$\left<x,Tx\right>\leq\bigvee_{T'\in\scrD} \left<x,T'x\right>
=[x,x]=\left<x,Sx\right>$
for all~$x\in X$,
and so~$T\leq S$
by~\sref{chilb-vector-states-order-separating},
that is, $S$ is an upper bound for~$\scrD$.
Given another upper bound~$S'\in\Real{\scrB^a(X)}$
of~$\scrD$
(so  $T\leq S'$ for all~$T\in\scrD$)
we have~$\left<x,Tx\right>\leq \left<x,S'x\right>$
and so~$\left<x,Sx\right>
=[x,x]=\bigvee_{T\in \scrD}\left<x,Tx\right>\leq \left<x,S'x\right>$
for all~$x\in X$
implying that~$S\leq S'$.
Hence~$S$ is the supremum of~$\scrD$
in $\Real{\scrB^a(X)}$.
Note that since~$\left<x,Sx\right>=\bigvee_{T\in\scrD} \left<x,Tx\right>$
we immediately see
that $\left<x,(\,\cdot\,)x\right>\colon \scrB^a(X)\to\scrA$
preserves bounded directed suprema
for every~$x\in X$.

It remains to be shown that
there are sufficiently many np-functionals on $\scrB^a(X)$
in the sense that~$T\in(\scrB^a(X))_+$ is zero
when~$\omega(T)=0$ for every np-functional $\omega\colon \scrB^a(X)\to\C$.
This is indeed
the case for such an operator~$T$,
because~$\xi(\left<x,(\,\cdot\,)x\right>)$
is an np-functional on~$\scrB^a(X)$
for every~$x\in X$
and an np-functional $\xi\colon \scrA\to\C$,
implying that~$\xi(\left<x,Tx\right>)=0$,
and~$\left<x,Tx\right>=0$,
and so~$T=0$.\qed
\end{point}
\end{point}
\begin{point}{40}[mn-vna]{Exercise}%
\index{$M_n\scrA$, the $n\times n$-matrices over~$\scrA$!as a von Neumann algebra}%
Let~$\scrA$ be a von Neumann algebra,
and let~$N$ be a natural number.
\begin{enumerate}
\item
Show 
that the $C^*$-algebra
$M_N(\scrA)$ of $N\times N$-matrices over~$\scrA$ (see~\sref{cstar-matrices})
is a von Neumann algebra.
\item
Show that
the map $A\mapsto \sum_{ij} a_i^* A_{ij} a_j\colon\, M_N\scrA\to \scrA$
is normal and completely positive,
and that
the map $A\mapsto \sum_{ij} a_i^* A_{ij} b_j\colon\, M_N\scrA\to\scrA$
is ultrastrongly and ultraweakly continuous
for all~$a_1,\dotsc,a_N,b_1,\dotsc,b_N\in\scrA$.

In particular, $A\mapsto A_{ij}\colon\,M_N\scrA\to\scrA$
is ultraweakly and ultrastrongly continuous
for all~$i,j$.

Show that a net~$(A_\alpha)_\alpha$
in~$M_N\scrA$
converges ultraweakly (ultrastrongly)
to $B\in M_N\scrA$
iff $(A_\alpha)_{ij}$ converges ultraweakly (ultrastrongly)
to~$B_{ij}$ as~$\alpha\to\infty$ for all~$i,j$.
\item
Given an ncp-map $f\colon \scrA\to\scrB$
between von Neumann algebras,
show that the cp-map $M_N f\colon M_N\scrA\to M_N\scrB$
from~\sref{mnf} is normal.%
\index{$M_nf$!is normal}
\end{enumerate}
\spacingfix%
\end{point}%
\end{parsec}%
\subsubsection{Commutative von Neumann algebras}
\begin{parsec}{500}%
\begin{point}{10}[linfty-example]%
Another important source of examples of von 
Neumann algebras is measure theory:
we'll show that the bounded measurable
functions on a 
finite complete
measure space~$X$
form a commutative von Neumann algebra~$L^\infty(X)$
when functions that are equal almost everywhere are identified
(see~\sref{Linfty-vn}).
In fact, 
we'll see in~\sref{cvn}
that
every commutative von Neumann algebra is nmiu-isomorphic
to a direct sum of~$L^\infty(X)$s.
This is not only interesting in its own right,
but will also
be used in the next chapter
to show that the only von Neumann algebras
that can be endowed with a `duplicator'
are of the form~$\ell^\infty(X)$
for some set~$X$ (see~\sref{duplicable}).

We should probably mention that~$L^\infty(X)$
can be defined for any measure space~$X$,
and is a von Neumann algebra
precisely when~$X$ is \emph{localisable},
see~\cite{segal1951}.
This has the advantage that any commutative von Neumann algebra
is nmiu-isomorphic
to a single~$L^\infty(X)$
for some localisable measure space~$X$,
but since it has no other advantages relevant
to this text
we restrict ourselves to complete finite measure spaces.

We'll assume the reader is reasonably familiar with 
the basics of measure theory,
and we'll only show a selection of results
that we deemed important.
For the other details,
we refer to volumes~1 and~2 of~\cite{fremlin}.
Nevertheless,
we'll  recall
some basic definitions
to fix terminology,
which is sometimes simpler than in~\cite{fremlin}
(because we're dealing with finite complete measure spaces),
and sometimes modified to the complex-valued case
(c.f.~133C of~\cite{fremlin}).
A motivated reader will have no problem adapting
the results from~\cite{fremlin} 
to our setting.
\end{point}
\end{parsec}%
\begin{parsec}{510}[measure-theory-recap]%
\begin{point}{10}%
Let~$X$ be a finite and complete measure space.
We'll denote the $\sigma$-algebra
of measurable subsets of~$X$ by~$\Define{\Sigma_X}$,%
\index{SigmaX@$\Sigma_X$, measurable subsets}
and the measure by~$\Define{\mu_X}\colon \Sigma_X\to[0,\infty)$ (or~$\mu$%
\index{muX@$\mu_X$, measure}
when no confusion is expected).
That~$X$ is \Define{finite}%
\index{measure!finite}
means that~$\mu(X)<\infty$
(which doesn't mean that the set~$X$ is finite),
and that~$X$ is \Define{complete}%
\index{measure!complete}
means that every subset~$A$
of a negligible subset~$B$ of~$X$
is itself negligible.
(Recall that~$N\subseteq X$
is \Define{negligible}%
\index{negligible, subset of a measure space}
when~$N\in \Sigma_X$ and~$\mu(N)=0$.)
A function $f\colon X\to\C$ is \Define{measurable}%
\index{measurable function}
when the inverse image~$f^{-1}(U)$
of any open subset~$U$ of~$\C$
is measurable
(which happens precisely
when both~$x\mapsto \Real{f(x)},\,x\mapsto\Imag{f(x)}\colon\,
X\to\R$
are measurable in the sense of~121C of~\cite{fremlin}).
An important example of a measurable function on~$X$
is the indicator function~$\mathbf{1}_A$
of a measurable subset~$A$ of~$X$
(which is equal to~$1$ on~$A$ and~$0$ elsewhere.)
\end{point}
\begin{point}{20}%
The bounded measurable functions $f\colon X\to\C$
form a $C^*$-subalgebra of~$\C^X$ 
that we'll denote by~$\Define{\mathcal{L}^\infty(X)}$.%
\index{LcalinftyX@$\mathcal{L}^\infty(X)$}
The space $\mathcal{L}^\infty(X)$
is not only closed with respect to the (supremum) norm
on~$\C^X$,
but also with respect to coordinatewise limits
of bounded \emph{sequences}
(c.f.~121F of~\cite{fremlin}).
As a result,
the coordinatewise
(countable)
supremum~$\bigvee_n f_n$
of a bounded ascending sequence $f_1\leq f_2\leq \dotsb$
in~$\Real{\mathcal{L}^\infty(X)}$
is again in~$\mathcal{L}^\infty(X)$,
and is fact the supremum of~$(f_n)_n$ in~$\mathcal{L}^\infty(X)$.
However $\mathcal{L}^\infty(X)$
might still not be a von Neumann algebra
because not every bounded directed subset of~$\Real{\mathcal{L}^\infty(X)}$
might have a supremum
as we'll show presently; 
this is why we'll move from~$\mathcal{L}^\infty(X)$
to~$L^\infty(X)$ in a moment.
\end{point}
\begin{point}{30}%
For a counterexample
to~$\mathcal{L}^\infty(X)$ being always
a von Neumann algebra
we take~$X$ to be the unit interval~$[0,1]$
with the Lebesgue measure.
Let~$A$ be a non-measurable
subset of~$[0,1]$ (see 134B of~\cite{fremlin}).
The indicator functions~$\mathbf{1}_F$
where~$F$ is a finite subset of~$A$
form a bounded directed subset~$D$ of~$\Real{\mathcal{L}^\infty([0,1])}$
that---so we claim---has no supremum.
Indeed, note that
since $f\in \Real{\mathcal{L}^\infty([0,1])}$
is an upper bound for~$D$ iff~$\mathbf{1}_A\leq f$,
the least upper bound~$h$ for~$D$
would be the least bounded measurable function above~$\mathbf{1}_A$.
Surely, $h\neq \mathbf{1}_A$
for such~$h$
(because otherwise~$A$ would be measurable),
so~$h(x)>\mathbf{1}_A(x)$ for some~$x\in [0,1]$.
But then $h - (h(x)-\mathbf{1}_A(x))\mathbf{1}_{\{x\}}<h$
is an upper bound for~$D$ too
contradicting the minimality of~$h$.
Whence~$\mathcal{L}^\infty([0,1])$
is not a von Neumann algebra.
\end{point}
\begin{point}{40}%
To deal with~$L^\infty(X)$
we need to know a bit more about~$\mathcal{L}^\infty(X)$,
namely that the measure on~$X$ can be extended to a
an integral $\int\colon \mathcal{L}^\infty(X)\to \C$
(see~122M of~\cite{fremlin})%
\footnote{Note that every element of~$\mathcal{L}^\infty(X)$
being bounded is integrable by~122P of~\cite{fremlin}.}
with the following properties.
\begin{enumerate}
\item
$\int(\mathbf{1}_A) = \mu(A)$
for every measurable subset~$A$ of~$X$.
\item
$\int\colon \mathcal{L}^\infty(X)\to \C$
is a positive linear map
(see 122O of~\cite{fremlin}).
\item
$\int \bigvee_n f_n = \bigvee_n \int f_n$
for every bounded sequence
$f_1\leq f_2\leq \dotsb$
in~$\Real{\mathcal{L}^\infty(X)}$.
(This is a special case
of Levi's theorem, see 123A of~\cite{fremlin}.)
\end{enumerate}
Unsurprisingly, the integral
interacts poorly
with the uncountable directed suprema
that do exist in~$\mathcal{L}^\infty(X)$:
for example, the set~$D:=\{\,f\in [0,1]_{\mathcal{L}^\infty(X)}\colon \,
\int f = 0\,\}$
is directed, bounded, and has supremum~$1$,
but~$\bigvee_{f\in D} \int f=0 < 1=\int \bigvee D$.
What \emph{is} surprising
is that the lifting of~$\int$
to~$L^\infty(X)$ will be normal.
\end{point}
\begin{point}{50}%
But let us first define~$L^\infty(X)$.
We say that $f,g\in \mathcal{L}^\infty(X)$
are \Define{equal almost everywhere}
and write $\Define{f\approx g}$%
\index{((approx@$\approx$! $f\approx g$, for measurable functions}
when~$f(x)=g(x)$ for almost all~$x\in X$
(that is, $\{\,x\in X\colon\, f(x)\neq g(x)\,\}$
is negligible).
It is easily seen that~$\approx$ is an equivalence relation;
we denote the equivalence class
of a function~$f\in \mathcal{L}^\infty(X)$
by $\Define{f^\circ}$,%
\index{*supcirc@$f^\circ$, equivalence class of~$f$}
and
the set of equivalence classes by~$\Define{L^\infty(X)}
:= \{\, f^\circ\colon\, f\in \mathcal{L}^\infty(X)\,\}$,
	\index{LinftyX@$L^\infty(X)$}
which
becomes a commutative $C^*$-algebra
when
endowed with the same operations
as~$\mathcal{L}^\infty(X)$, but with
a slightly modified norm given by,
for~$\mathfrak{f}\equiv f^\circ \in L^\infty(X)$,
\begin{alignat*}{3}
	\|\mathfrak{f}\| \ &= \ 
\min\{\, \|g\|\colon \, g\in\mathcal{L}^\infty(X)\text{ and }
g^\circ = \mathfrak{f}\,\} \\
&=\ \min\{\ \lambda\geq 0\colon\,
		\left|f(x)\right|\,\leq\,\lambda
	\text{ for almost all~$x\in X$}\ \}.
\end{alignat*}
This is called the \Define{essential supremum norm}.%
\index{essential supremum norm}
To see that~$L^\infty(X)$ is complete
one can use the fact that~$\mathcal{L}^\infty(X)$
is complete in a slightly more general sense than discussed before:
when a bounded sequence $f_1,f_2,\dotsc$
in~$\mathcal{L}^\infty(X)$
converges coordinatewise for almost all~$x\in X$
to some bounded function~$f\colon X\to\C$,
this function~$f$ is itself measurable (and so~$f\in\mathcal{L}^\infty(X)$,
c.f.~121F of~\cite{fremlin}).

Another consequence of this
is that a bounded ascending sequence
$f_1^\circ \leq f_2^\circ \leq \dotsb$
in~$L^\infty(X)$
(so~$f_1,f_2,\dotsc\in\mathcal{L}^\infty(X)$,
and $f_1(x)\leq f_2(x)\leq\dotsb$ for almost all~$x\in X$)
has a supremum~$\bigvee_n f_n^\circ$ in~$\mathcal{L}^\infty(X)$.
Indeed, we'll have
$\bigvee_n f_n^\circ = g^\circ$
for any bounded map~$g\colon X\to\C$
with $g(x)=\bigvee_n f_n(x)$
for almost all~$x\in X$.
\end{point}%
\begin{point}{60}%
Now, let us return to the integral.
Since~$\int f = \int g$
for all~$f,g\in \mathcal{L}^\infty(X)$
with $f\approx g$
we get a map
$\int \colon L^\infty(X)\to \C$
given
by~$\int  f^\circ = \int f$.
Clearly, $\int$ is positive and linear,
and by (a slightly less special case
of) Levi's theorem (123A of~\cite{fremlin})
we see that $\int \bigvee_n \mathfrak{f}_n
= \bigvee_n \int \mathfrak{f}_n$
for any bounded ascending sequence
$\mathfrak{f}_1\leq \mathfrak{f}_2\leq\dotsb$
in~$\Real{L^\infty(X)}$.
Note that~$\int\colon L^\infty(X)\to\C$
is also faithful,
because if~$\int f^\circ=\int f = 0$
for some $f\in \mathcal{L}^\infty(X)_+$,
then~$f(x)=0$ for almost all~$x\in X$,
and so~$f^\circ=0$.
Now,
the fact that~$L^\infty(X)$
is a von Neumann algebra follows from
the following general and rather surprising observation.
\end{point}
\begin{point}{70}{Proposition}%
\index{von Neumann algebra!with a faithful np-functional}
Let~$\scrA$ be a $C^*$-algebra,
and let~$\tau\colon \scrA\to\C$
be a faithful positive map.
If every bounded ascending sequence~$a_1\leq a_2\leq \dotsb$
of self-adjoint elements from~$\scrA$ has a supremum~$\bigvee_n a_n$
(in~$\Real{\scrA}$)
and
$\tau(\bigvee_n a_n)=\bigvee_n \tau (a_n)$,
then~$\scrA$ is a von Neumann algebra,
and~$\tau$ is normal.
\begin{point}{80}{Proof}%
Our first task is to show that a bounded
directed subset~$D$ of self-adjoint elements of~$\scrA$
has a supremum~$\bigvee D$ in~$\Real{\scrA}$.
Since~$\bigvee_{d\in D} \tau(d)$
is a supremum in~$\R$
we can find~$a_1\leq a_2\leq \dotsb$ in~$D$
with~$\bigvee_n \tau(a_n) = \bigvee_{d\in D} \tau(d)$.
We'll show that~$\bigvee_n a_n$
is the supremum of~$D$.
Surely, any upper bound of~$D$ being also an upper bound 
for~$a_1\leq a_2\leq\dotsb$
is above~$\bigvee_n a_n$,
so the only thing that we need to show is that
$\bigvee_n a_n$ is an upper bound of~$D$.
So let~$b\in D$ be given.
The trick is to pick a sequence
$b_1\leq b_2\leq \dotsb$ in~$D$
with $b\leq b_1$ and~$a_n\leq b_n$ for all~$n$
(which exists on account of~$D$'s directedness).
Then~$\bigvee_n a_n \leq \bigvee_n b_n$,
and~$\bigvee_{d\in D} \tau(d) =\bigvee_n \tau(a_n)
=\tau(\,\bigvee_n a_n\,)
\leq \tau(\,\bigvee_n b_n\,)
= \bigvee_n \tau(b_n) \leq \bigvee_{d\in D} \tau(d)$,
so~$\tau(\,\bigvee_n a_n\,) = \tau(\,\bigvee_n b_n\,)$,
which implies that~$\bigvee_n a_n = \bigvee_n b_n$
as~$\tau$ is faithful.
Since then $b\leq b_1\leq \bigvee_n b_n = \bigvee_n a_n$
we see that~$\bigvee_n a_n$ is an upper bound
(and thus the supremum) of~$D$.
Moreover,
since
$\bigvee_{d\in D} \tau(d) \leq
\tau(\bigvee D)
=\tau(\bigvee_n a_n)
=\bigvee_n\tau(a_n)
\leq \bigvee_{d\in D} \tau(d)$,
we see that~$\bigvee_{d\in D} \tau(d)
= \tau(\bigvee D)$,
and so~$\tau$ is normal.
Since~$\tau$ is faithful
and normal, $\scrA$ is a von Neumann algebra.\qed
\end{point}
\end{point}
\begin{point}{90}[Linfty-vn]{Corollary}%
Given a finite complete measure space~$X$ 
the $C^*$-algebra $L^\infty(X)$
is a commutative von Neumann algebra,
and the assignment $f\mapsto \int f$
gives a faithful normal positive
map~$\int\colon L^\infty(X)\to\C$.
\end{point}
\end{parsec}
\begin{parsec}{520}[classification-cvn]%
\begin{point}{10}%
We'll show that any commutative von Neumann algebra~$\scrA$
that admits a faithful np-functional $\omega\colon \scrA\to \C$
is nmiu-isomorphic  to~$L^\infty(X)$
for some finite complete measure space~$X$.
It makes sense to regard this result
as a von Neumann algebra analogue
of Gelfand's theorem for commutative $C^*$-algebras,
(see~\sref{gelfand}---that any commutative $C^*$-algebra
is miu-isomorphic to~$C(Y)$ for some compact Hausdorff space~$Y$.)
But one should not take the
comparison too far too lightly:
while Gelfand's theorem readily
yields a clean equivalence 
between commutative $C^*$-algebras
and compact Hausdorff spaces
(see~\sref{gelfand-equivalence}),
the fact that  $L^\infty(X_1)\cong L^\infty(X_2)$
for finite complete measure spaces~$X_1$
and~$X_2$ does not even imply that~$X_1$ and~$X_2$ have
	the same cardinality.\footnote{Indeed, one may take
	$X_1$ to be a measure space consisting of a
	single non-negligible point~$*$ (so $X_1=\{*\}$
	and $\mu(X_1)\neq 0$),
	while letting $X_2$ be a measure space
	on an uncountable set
	formed by taking for the measurable subsets
	of~$X_2$ the countable subsets
	and their complements,
	by making the countable subsets negligible,
	and by giving all cocountable subsets
	the same non-zero measure.
	Then all measurable functions
	on~$X_1$ and on~$X_2$
	are constant almost everywhere,
	(because in $X_1$ and $X_2$ there are no 
	two non-negligible disjoint measurable subsets,)
	so that~$L^\infty(X_1)\cong \C\cong L^\infty(X_2)$.}
Obtaining an equivalence between commutative von Neumann algebras
and measure spaces is nonetheless
possible after a suitable non-trivial modification
to the category of measure spaces
(as is shown by Robert Furber 
in as of yet unpublished work.)

We obtain our finite complete measure space~$X$
from the commutative von Neumann algebra~$\scrA$
by taking for~$X$ the compact Hausdorff space~$\spec(\scrA)$
of all miu-functionals on~$\scrA$,
and declaring that a subset~$A$ of~$X\equiv \spec(\scrA)$ 
is measurable when~$A$ is clopen up to
a \emph{meagre}
subset
(defined below,~\sref{meagre}).
It takes some effort to show
that this yields a $\sigma$-algebra
in~$\spec(\scrA)$,
and that the faithful np-functional $\omega\colon\scrA\to \C$
gives a finite complete measure on~$\spec(\scrA)$,
but once this is achieved
it's easily seen that
$\scrA\cong C(\spec(\scrA))\cong L^\infty(\spec(\scrA))$.
\end{point}
\begin{point}{20}[meagre]{Definition}%
Let~$X$ be a topological space.
\begin{enumerate}
\item
A subset~$A$ of~$X$
is called \Define{meagre}%
\index{meagre}
when~$A\subseteq \bigcup_n B_n$
for some closed subsets $B_1\subseteq B_2\subseteq \dotsb$
of~$X$ with empty interior (so  $B_n^\circ=\varnothing$
for all~$n$.)
\item
Given $A,B\subseteq X$ 
we write $\Define{A\approx B}$
\index{((approx@$\approx$!$A\approx B$, for subsets of a topological space} when
$A\cup B\,\backslash\,A\cap B$
is meagre.
\item
We say that~$A\subseteq B$
is \Define{almost clopen}%
\index{almost clopen}
when~$A\approx C$
for some clopen~$C\subseteq X$.
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{30}[meagre-basic]{Exercise}%
Given a topological space~$X$,
verify the following facts.
\begin{enumerate}
\item
A countable union~$\bigcup_n A_n$
of meagre subsets $A_1,A_2,\dotsc\subseteq X $ is meagre.
\item
A subset of a meagre set is meagre.
\item
$\overline{U}\approx U$
for every open subset~$U$ of~$X$.

(Hint: show that $\overline{U}\backslash U$
is closed with empty interior.)
\item
$\bigcup_n A_n\approx \bigcup_n B_n$
for all~$A_1,A_2,\dotsc, B_1,B_2,\dotsc\subseteq X$
with $A_n\approx B_n$.
\item
$A\backslash B \approx A'\backslash B'$
for all $A,A',B,B'\subseteq X$
with~$A\approx A'$ and~$B\approx B'$.
\item
If~$A,B\subseteq X$ are almost clopen,
then~$A\cup B$ and~$A\backslash B$ 
are almost clopen.
\end{enumerate}
\spacingfix
\end{point}%
\begin{point}{31}%
Meagerness can be thought of as a topological analogue of negligibility.
In fact, with respect to the measure we'll put on $\spec(\scrA)$
in~\sref{cvn-faithful},
    meagerness and negligibility actually coincide.
In general, however, 
the notions are disparate,
as is demonstrated rather dramatically by the following example.
\end{point}
\begin{point}{32}{Example}
of a meagre subset~$A$ of~$[0,1]$
with Lebesgue measure~$1$.
Given an enumeration~$q_1,q_2,\dotsc$
    of the rational numbers in~$[0,1]$,
the set
\begin{equation*}
    \textstyle
    B_m \ :=\  \bigcup_n 
    \bigl(\,q_n-\frac{1}{2m}2^{-n},\,q_n+\frac{1}{2m}2^{-n}\,\bigr)
    \cap[0,1]
\end{equation*}
is open and dense in~$[0,1]$, with a Lebesgue measure 
of at most~$\nicefrac{1}{m}$.
So the intersection~$B:=\bigcap_m B_m$ is Lebesgue negligible.
On the other hand, $[0,1]\backslash B_m$
is closed and has empty interior,
so that $A:=[0,1]\backslash B\equiv \bigcup_m B_m$
is meagre with Lebesgue measure~$1$.
\end{point}
\end{parsec}
\begin{parsec}{530}%
\begin{point}{10}%
The fact that the almost clopen subsets
of the spectrum~$\spec(\scrA)$
of a commutative von Neumann algebra~$\scrA$
are closed under countable unions
(and thus form a $\sigma$-algebra)
relies on a special topological property of~$\spec(\scrA)$
that is described in~\sref{vn-spectrum-extremally-disconnected} below.
\end{point}
\begin{point}{20}[ngelfand]{Exercise}%
\index{Gelfand's Representation Theorem!for von Neumann algebras}
Let~$\scrA$ be a commutative von Neumann algebra.
Using the fact that
the Gelfand representation~$\gamma_\scrA\colon \scrA\to C(\spec(\scrA))$
from~\sref{gelfand-representation}
is an miu-isomorphism 
by~\sref{gelfand}
and thus an order isomorphism,
show that~$C(\spec(\scrA))$
is a commutative von Neumann algebra
that is nmiu-isomorphic
to~$\scrA$ via~$\gamma_\scrA$.
\end{point}
\begin{point}{30}[vn-spectrum-extremally-disconnected]{Proposition}%
	\index{sp@$\spec$, spectrum!$\spec(\scrA)$, of a $C^*$-algebra!is extremally disconnected for a von Neumann algebra}
The spectrum~$\spec(\scrA)$
of a commutative von Neumann algebra~$\scrA$
is \Define{extremally disconnected}:%
\index{extremal disconnectedness} 
the closure~$\overline{U}$
of an open subset~$U$ of~$\spec(\scrA)$
is open.
\begin{point}{40}{Proof}%
(Based on \S6.1 of~\cite{riesz}.)

Let~$U$ be an open subset of~$\spec(\scrA)$,
and let~$\mathbf{1}_U$ be the indicator function
of~$U$.
The set $D=\{\,f\in C(\spec(\scrA))\colon\, f\leq \mathbf{1}_U\,\}$
is directed and bounded 
and so has a supremum~$\bigvee D$
in~$C(\spec(\scrA))$
since~$C(\spec(\scrA))$ is a von Neumann algebra by~\sref{ngelfand}.
Note that~$0\leq \bigvee D\leq 1$.
We'll prove that~$\bigvee D = \mathbf{1}_{\overline{U}}$,
because this entails
that~$\mathbf{1}_{\overline{U}}$
is continuous,  so that~$\overline{U}$ is both open and closed.

Let~$x\in U$ be given.
By Urysohn's lemma (see~15.6 of~\cite{willard},
using here that~$\spec(\scrA)$ being a compact Hausdorff
space, \sref{spectrum-calg-compact-hausdorff}, 
is normal by~17.10 of~\cite{willard})
there is $f\in [0,1]_{C(\spec(\scrA))}$
with~$f(x)=1$ and~$f(y)=0$ for all~$y\in \spec(X)\backslash U$.
It follows that~$f\in D$,
and~$f\leq \bigvee D\leq 1$,
so that $1=f(x)\leq (\bigvee D)(x)\leq 1$,
and~$(\bigvee D)(x)=1$.
By continuity of~$\bigvee D$,
we get $(\bigvee D)(x)=1$ for all~$x\in \overline{U}$.

Let~$y\in \spec(\scrA)\backslash U$ be given.
Again by Urysohn's lemma
there is $f\in [0,1]_{C(\spec(\scrA))}$
with~$f(y)=0$ and~$f(x)=1$ for all~$x\in \overline{U}$.
Since $g\leq \mathbf{1}_U \leq f$
for every~$g\in D$,
we get $\bigvee D\leq f$,
and so~$0\leq (\bigvee D)(y)\leq f(y) =0$,
which implies that~$(\bigvee D)(y)=0$.
Hence~$(\bigvee D)(y)=0$ for all~$y\in \spec(\scrA)\backslash U$.

All in all we have $\bigvee D = \mathbf{1}_{\overline{U}}$,
and so~$\overline{U}$ is open.\qed
\end{point}
\end{point}
\begin{point}{50}{Corollary}%
The almost clopen subsets
of an extremally disconnected topological
space~$X$ form a $\sigma$-algebra.
\begin{point}{60}[almost-clopen-sigma-algebra-proof]{Proof}%
In light of~\sref{meagre-basic}
it remains only to be shown that
the union~$\bigcup_n A_n$
of almost clopen subsets~$A_1,A_2,\dotsc$
is almost clopen.
Let~$C_1,C_2,\dotsc\subseteq X$
be clopen with $A_n\approx C_n$ for each~$n$.
Then $\bigcup_n A_n \approx \bigcup_n C_n$,
and~$C:=\bigcup_n C_n$ is open
(but not necessarily closed).
Since~$C\approx \overline{C}$
(by~\sref{meagre-basic}),
and~$\overline{C}$ is clopen (as $X$ is extremally disconnected)
we get~$\bigcup_n A_n \approx \overline{C}$,
so~$\bigcup_n A_n$ is almost clopen.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{540}%
\begin{point}{10}%
The final ingredient
we need to prove the main result, \sref{cvn-faithful},
of this section
is the observation
that an almost clopen subset of a compact Hausdorff space
is equivalent to precisely one clopen,
which follows from the following famous theorem.
\end{point}
\begin{point}{20}[baire-category-theorem]{Baire category theorem}%
\index{Baire's Category Theorem}
A meagre subset of a compact Hausdorff space
has empty interior.
\begin{point}{30}{Proof}%
Let~$A$ be a meagre subset of a compact Hausdorff space~$X$.
So there are closed $B_1\subseteq B_2\subseteq \dotsc$
with~$A\subseteq \bigcup_n B_n$
and~$B_n^\circ=\varnothing$ for all~$n$.
Then~$U_n:= X\backslash B_n$
is an open dense subset of~$X$
for each~$n$.
Since~$A^\circ \subseteq (\bigcup_n B_n)^\circ  =
X\backslash (\,\smash{\overline{\bigcap_n U_n}}\,)$
it suffices to show that
$\bigcap_n U_n$ is dense in~$X$.
That is, given a non-empty open subset~$V$
of~$X$ we must show that~$V\cap\bigcap_n U_n\neq \varnothing$.

Write~$V_1:=V$.
Since~$U_1$ is open and dense, and~$V_1$ is open and not empty,
we have $U_1\cap V_1\neq \varnothing$.
	Since~$X$ is regular (see e.g.~\cite{willard})
we can find an open and non-empty subset $V_2$ of~$X$
with~$\overline{V}_2\subseteq U_1\cap V_1$.
Continuing this process
we obtain non-empty open subsets $V\equiv V_1 \supseteq V_2\supseteq \dotsb$
	of~$X$ with $\overline{V}_{n+1} \subseteq U_n\cap V_n$
for all~$n$,
and so~$
\overline{V}_1 \supseteq V_1 
\supseteq \overline{V}_2 \supseteq V_2 
\supseteq \dotsb$.
Since~$X$ is compact,
$\bigcap_n \overline{V}_n$
can not be empty,
and neither will be~$V\cap \bigcap_n U_n
\supseteq \bigcap_n \overline{V}_n$.\qed
\end{point}
\end{point}
\begin{point}{40}[approx-closure]{Lemma}%
For open subsets~$U$ and~$V$ of a compact Hausdorff
space~$X$,
\begin{equation*}
U\approx V\quad\iff\quad
\overline{U}\approx \overline{V}
\quad\iff\quad
\overline{U}=\overline{V}.
\end{equation*}
\spacingfix%
\begin{point}{50}{Proof}%
As~$U\approx \overline{U}$ by~\sref{meagre-basic}
the only thing that is not obvious
is that~$\overline{U}\approx \overline{V} \implies \overline{U}=\overline{V}$.
So suppose that~$\overline{U}\approx \overline{V}$.
Then~$U\backslash \overline{V}$
is empty, because it is an open subset of the
meagre set~$\overline{U}\cup\overline{V}\,\backslash\,
\overline{U}\cap\overline{V}$
(which has empty interior by~\sref{baire-category-theorem}.) In other words,
we have~$U\subseteq \overline{V}$, 
and thus~$\overline{U}\subseteq \overline{V}$.
Similarly, $\overline{V}\subseteq\overline{U}$,
and so~$\overline{V}=\overline{U}$.\qed
\end{point}
\end{point}
\begin{point}{60}{Corollary}%
Given an almost clopen subset~$A$ of a compact Hausdorff
space~$X$ there is precisely one clopen~$C$ with~$A\approx C$.
\begin{point}{70}[almost-meagre-fundamental]{Proof}%
When~$C\approx A \approx C'$
for clopen subsets~$C,C'\subseteq X$,
we have~$C\approx C'$,
and so~$C=C'$ by~\sref{approx-closure}.\qed
\end{point}
\end{point}
\begin{point}{80}%
Interestingly,
a compact Hausdorff space is extremally disconnected
iff each of its open subsets is ``measurable''
in the sense of being almost clopen:
\end{point}
\begin{point}{90}[open-almost-clopen]{Proposition}%
A compact Hausdorff space~$X$
is extremally disconnected
iff every open subset of~$X$
is almost clopen.
\begin{point}{100}{Proof}%
If~$X$ is extremally disconnected,
and~$U$ is open subset of~$X$,
then~$\overline{U}$ is clopen,
and~$\overline{U}\approx U$ by~\sref{meagre-basic}
giving us that~$U$ is almost clopen.

Conversely,
suppose that each open subset of~$X$ is almost clopen.
To show that~$X$ is extremally disconnected
we must show that~$\overline{U}$ is open given
an open subset~$U$ of~$X$.
Pick a clopen~$C$ with~$U\approx C$.
Then~$\overline{U}\approx U\approx C$
(by~\sref{meagre-basic}),
and so~$\overline{U}=C$ by~\sref{approx-closure}.\qed
\end{point}
\end{point}
\begin{point}{110}[cvn-faithful]{Theorem}%
Let~$\scrA$ be a commutative von Neumann algebra~$\scrA$.
Recall that
the Gelfand representation $\gamma_\scrA\colon 
\scrA\to C(\spec(\scrA))$
is an nmiu-isomorphism (by~\sref{ngelfand}),
$C(\spec(\scrA))$ is a von Neumann algebra,
and that the almost clopen subsets (see~\sref{meagre}) of~$\spec(\scrA)$
form a $\sigma$-algebra.

Given a faithful np-functional $\omega\colon \scrA\to\C$
there is a (unique) measure
$\mu$ on the almost clopen subsets of~$\spec(\scrA)$
such that~$\mu(A)=0$ iff $A$ is meagre,
and~$\mu(C)=\omega(\gamma_\scrA^{-1} (\mathbf{1}_{C}))$
for every clopen subset~$C$ of~$\spec(\scrA)$;
and this turns~$\spec(\scrA)$
into a finite complete measure space.

With respect to this measure space a
bounded function $f\colon \spec(\scrA)\to\C$
is measurable iff~$f$ is continuous almost everywhere.
Moreover, 
$f\mapsto f^\circ\colon C(\spec(\scrA))\to L^\infty(\spec(\scrA))$
is an nmiu-isomorphism,
and~$\int f^\circ = \omega(\gamma_\scrA^{-1}(f))$ for all~$f\in C(X)$.
All in all,
we get the following commuting diagram.
\begin{equation*}
\xymatrix@C=3em@R=3em{
\scrA
\ar[r]^-{\gamma_\scrA}_-\cong
\ar[rd]_\omega
&
C(\spec(\scrA))
\ar[r]^-{f\mapsto f^\circ}_-\cong
&
L^\infty(\spec(\scrA))
\ar[ld]^\int
\\
&
\C
}
\end{equation*}
\begin{point}{120}{Proof}%
By~\sref{almost-meagre-fundamental}
we know that given an almost clopen subset~$A$
of~$\spec(\scrA)$
there is a unique clopen~$C_A$
with~$A\approx C_A$,
and 
so we may define
$\mu(A):=\omega(\gamma_\scrA^{-1}(\mathbf{1}_{C_A}))$.
It is easily seen that~$\mu$
is finitely additive.
Further $\mu(A)=0$ for every meagre~$A\subseteq X$,
and so $\mu(A)=\mu(B)$ when~$A\approx B$.
Conversely, 
an almost clopen subset~$A$
of~$\scrA$
with~$\mu(A)=0$
is meagre,
because for the unique clopen~$C$ with~$A\approx C$,
we have~$\omega(\gamma_\scrA^{-1}(\mathbf{1}_C))=\mu(A)=0$,
so that~$\mathbf{1}_C=0$ and thus~$C=\varnothing$---using here
that~$\omega$ is faithful.

To show that~$\mu$
is a measure,
it suffices to prove
that~$\bigwedge_n \mu(A_n)=0$
given~$A_1\supseteq A_2\supseteq \dotsb$
with~$\bigcap_n A_n=\varnothing$.
To do this, pick clopen subsets~$C_1,C_2,\dotsc$
of~$\spec(\scrA)$
with~$A_n\approx C_n$ for all~$n$.
Then~$\bigwedge_n \mu(A_n)
=\bigwedge_n \mu(C_n)
= \omega(\gamma_\scrA^{-1}(\bigwedge_n \mathbf{1}_{C_n}))$---using 
here that~$\omega$ is normal.
So to prove that~$\bigwedge_n \mu(A_n)=0$
it suffices to show that~$\bigwedge_n \mathbf{1}_{C_n}=0$,
that is,
given a lower bound~$f$ of the~$\mathbf{1}_{C_n}$
in~$\Real{C(\spec(\scrA))}$
we must show that~$f\leq 0$.
Note that for such~$f$
we have~$f(x)\leq 0$
for all~$x\in X\backslash\bigcap_n C_n$.
Then~$f(x)\leq 0$ for all~$x\in X$
if we can show that~$X\backslash \bigcap_n C_n$ is dense in~$X$.
But this indeed the case
since~$\bigcap_n C_n\approx \bigcap_n A_n=\varnothing$
is meagre, and therefore has empty interior
(by~\sref{baire-category-theorem}).
Whence~$\mu$ is a measure.
Note that~$\mu$ is finite,
because~$\mu(\spec(\scrA))
= \omega(1)<\infty$,
and complete,
because a subset of a meagre set is meagre.

Let~$h\colon \spec(\scrA)\to\C$ be a bounded function.
We'll show that~$h$ is continuous almost everywhere
iff~$h$ is measurable.
Surely,
if~$h$ is continuous (everywhere),
then~$h$ is measurable
(since every open subset~$U$ of~$\spec(\scrA)$
is almost clopen, \sref{open-almost-clopen}).
So if~$h$ is continuous almost everywhere,
then~$h$ is measurable too.
For the converse,
it suffices to show
that $\varrho \colon h\mapsto h^\circ\colon C(\spec(\scrA))\to
L^\infty(\spec(\scrA))$ is surjective.
To this end, note first that~$\varrho$ is injective,
because a continuous function on~$\spec(\scrA)$
that is zero almost everywhere,
is non-zero on a meagre set,
and by~\sref{baire-category-theorem} zero on a dense
subset, and so is zero everywhere.
Since the image of the injective miu-map $\varrho$ is norm closed
in order to show that~$\varrho$ is surjective
it suffices to show that image of~$\varrho$ is 
norm dense in~$L^\infty(X)$.
This is indeed the case
since the elements of~$L^\infty(\spec(\scrA))$
of the form~$\sum_{n} \lambda_n \mathbf{1}_{A_n}^\circ$
where~$\lambda_1,\dotsc,\lambda_N\in\C$
and~$A_1,\dotsc,A_N$ are measurable (i.e.~almost clopen)
subsets of~$\spec(\scrA)$
are easily seen to be norm dense in~$L^\infty(\spec(\scrA))$
(c.f.~243I of~\cite{fremlin}),
and are in the range of~$\varrho$,
because given an almost clopen~$A\subseteq \spec(\scrA)$
and a clopen~$C$ with $A\approx C$
we have~$\mathbf{1}_A^\circ = \mathbf{1}_C^\circ$
and~$\mathbf{1}_{C}\in C(\spec(\scrA))$.
Hence~$\varrho$ is surjective.

It remains to be show that
$\int f^\circ = \omega(\gamma_\scrA^{-1}(f))$
for all~$f\in C(\spec(\scrA))$,
that is, $\int = \omega\circ \gamma_\scrA^{-1}\circ \varrho^{-1}$.
By the previous discussion the linear span
of the elements of~$L^\infty(\spec(\scrA))$
of the form~$\mathbf{1}_C^\circ$,
where~$C$ is (not just measurable but) clopen,
is norm dense in $L^\infty(\spec(\scrA))$.
Since~$\int \mathbf{1}_C
= \mu(C)=\omega(\gamma_\scrA^{-1} (\varrho^{-1}(\mathbf{1}_C^\circ ))$
for all clopen~$C$,
and both~$\int$ and~$\omega\circ\gamma_\scrA^{-1}\circ \varrho^{-1}$
are linear and bounded,
we conclude that~$\int = \omega\circ \gamma_\scrA^{-1} \circ \varrho^{-1}$,
and so we are done.\qed
\end{point}
\begin{point}{130}%
To deduce from this that all commutative von Neumann algebras
(and not just the ones admitting a faithful np-functional)
are nmiu-isomorphic
to direct sums of the form  $\bigoplus_i L^\infty(X_i)$
where the~$X_i$ are finite complete measure spaces
we first need some basic facts concerning the
\emph{projections} of a commutative von Neumann algebra.
\end{point}
\end{point}
\end{parsec}%
\section{Projections}
\begin{parsec}{550}%
\begin{point}{10}%
One pertinent feature
of von Neumann algebras
is an abundance of projections:
above each effect~$a$ 
there is a least projection~$\ceil{a}$
we call the ceiling of~$a$ (\sref{vna-ceil});
for every np-map $\omega\colon \scrA\to \scrB$
between von Neumann algebras
there is a least projection~$p$ with~$\omega(p^\perp)=0$
called the carrier of~$\omega$ (see~\sref{carrier});
the directed supremum of projections is again a projection;
the partial order of projections is complete
(see~\sref{ceil-floor-basic});
and each element of a von Neumann algebra is the norm limit
of linear combinations of projections
(see~\sref{projections-norm-dense}).
We'll prove all this and more in this section.
\end{point}
\begin{point}{20}{Definition}%
An element~$p$ of a $C^*$-algebra
is a \Define{projection}%
\index{projection!in a $C^*$-algebra}
when~$p^*p=p$.
\end{point}
\begin{point}{30}{Examples}%
\begin{enumerate}
\item
The only projections in~$\C$ are~$0$ and~$1$.
\item
Given a measurable
subset~$A$ of a finite complete measure space~$X$
the indicator function~$\mathbf{1}_A$
is a projection in~$L^\infty(X)$,
and every projection in~$L^\infty(X)$
is of this form.
\item
Given a closed linear subspace~$C$ of a Hilbert space~$\scrH$
the inclusion $E\colon C\to \scrH$
is a bounded linear map,
and  $\Define{P_C}:=EE^*\colon \scrH\to\scrH$
is a projection in~$\scrB(\scrH)$,
and
every projection in~$\scrB(\scrH)$ is of this form.
\end{enumerate}
\spacingfix%
\end{point}
\begin{point}{40}[projection-basic]{Exercise}%
Show that in a $C^*$-algebra:
\begin{enumerate}
\item
$0$ and~$1$ are projections.
\item
A projection~$p$ is an effect,
that is, $p^*=p$
and $0\leq p\leq 1$.
\item
    The orthocomplement $\Define{p^\perp} \equiv 1-p$ of a projection~$p$
    \index{$(\,\cdot\,)^\perp$!$p^\perp$, orthocomplement of a projection}
is a projection.
\item
An effect~$a$ is a projection iff $aa^\perp=0$.
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{50}[ad-contraposed]{Lemma}%
Let~$a$ be an element of a $C^*$-algebra~$\scrA$
with $\|a\|\leq 1$,
and let~$p$ and~$q$ be projections on~$\scrA$.
Then 
$a^* p a \leq q^\perp$
iff $paq=0$
iff  $aqa^*\leq p^\perp$.
\begin{point}{60}{Proof}%
Suppose that~$a^*pa\leq q^\perp$.
Then we have $q a^*pa q \leq qq^\perp q = 0$
(see \sref{astara-pos-basic-consequences})
and so $paq=0$,
because $\|paq\|^2=\|(paq)^*paq\|=0$
by the $C^*$-identity.
Applying $(\,\cdot\,)^*$,
we get $qa^*p=0$, and so both $qa^* = qa^*p^\perp$
and $aq = p^\perp aq$, giving
us $aqa^* = p^\perp a q a^* p^\perp 
\leq p^\perp$,
where we used that $aqa^*\leq aa^*\leq \|aa^*\|=\|a\|^2\leq 1$.
By a similar reasoning,
we get $aqa^*\leq p^\perp \implies paq=0\implies a^*pa\leq q^\perp$.\qed
\end{point}
\end{point}
\begin{point}{70}{Exercise}%
Let~$a$ be an effect of a $C^*$-algebra~$\scrA$,
and~$p$ be a projection from~$\scrA$.
\begin{point}{80}[projection-above-effect]%
Show that $a\leq p$
iff $p\sqrt{a} = \sqrt{a}$
iff $\sqrt{a}p = \sqrt{a}$
iff $p^\perp\sqrt{a} = 0$
iff $\sqrt{a}p^\perp = 0$
iff $a^2\leq p$
iff $p a  = a$
iff $ a p = a $
iff $p^\perp a  = 0$
iff $ap^\perp = 0$
iff $\sqrt{a}\leq p$.
\end{point}
\begin{point}{90}[projection-below-effect]%
Show that $p\leq a$
iff $p \sqrt{a} = p$
iff $\sqrt{a} p = p$
iff $ p\sqrt{a}^\perp = 0$
iff $\sqrt{a}^\perp p = 0$
iff $p\leq a^2$
iff $ap=p$
iff $pa = p$
iff $pa^\perp =0$
iff $a^\perp p =0$
iff $p\leq \sqrt{a}$.
\end{point}
\end{point}
\begin{point}{100}[projection-order-sharp]{Lemma}%
An effect~$a$ of a $C^*$-algebra~$\scrA$
is a projection iff the only effect
below~$a$ and~$a^\perp$ is~$0$.
\begin{point}{110}{Proof}%
On the one hand,
if~$a$ is a projection,
and~$b$ is an effect with~$b\leq a$
and~$b\leq a^\perp$,
then~$a^\perp b=0$ and~$ab=0$ by~\sref{projection-above-effect},
and so~$b=ab+a^\perp b = 0$.
On the other hand,
if~$0$ is the only effect below both~$a$ and~$a^\perp$,
then~$aa^\perp\equiv \sqrt{a}a^\perp \sqrt{a}$
being an effect below~$a$, and below~$a^\perp$,
is zero, and so~$a$ is projection, by~\sref{projection-basic}.\qed
\end{point}
\end{point}
\begin{point}{120}{Definition}%
We say that projections~$p$ and~$q$
from a $C^*$-algebra~$\scrA$ are \Define{orthogonal}%
\index{orthogonal projections}
when~$pq=0$,
and we say that a subset of projections
from~$\scrA$ is \Define{orthogonal}
(and its elements are \Define{pairwise orthogonal})
when all~$p$ and~$q$ from~$E$
are either equal or orthogonal.
\end{point}
\begin{point}{130}[orthogonal-tuple-of-projections]{Exercise}%
Let~$\scrA$ be a $C^*$-algebra.
\begin{enumerate}
\item
Show that projections~$p$ and~$q$ from~$\scrA$
are orthogonal iff $pq=0$ iff $qp=0$ iff $pqp=0$
iff $p+q\leq 1$ iff $p\leq q^\perp$
iff $p+q$ is a projection.
\item
Show that a finite set of  projections $p_1,\dotsc,p_n$
from~$\scrA$ is orthogonal
iff~$\sum_i p_i \leq 1$
iff $\sum_i p_i$ is a projection.

Show that, in that case, $\sum_i p_i$ is the least projection
above~$p_1,\dotsc,p_n$.
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{140}[projection-below-projection]{Exercise}%
Let~$p$ and~$q$ be projections from a $C^*$-algebra
with~$p\leq q$.\\
Show that~$q-p$ is a projection
(either directly, or using~\sref{orthogonal-tuple-of-projections}).
\end{point}
\end{parsec}
\subsection{Ceiling and Floor}
\begin{parsec}{560}%
\begin{point}{10}[vna-ceil]{Proposition}%
Above every effect~$b$ of a von Neumann algebra~$\scrA$,
there is a smallest projection, \Define{$\ceil{b}$},%
\index{*ceil@$\ceil{\,\cdot\,}$!$\ceil{a}$, ceiling}
which we call the \Define{ceiling}%
\index{ceiling}
of~$b$,
 given by $\ceil{b}=\bigvee_{n=0}^\infty b^{\nicefrac{1}{2^n}}$.\\
Moreover, if $a\in \scrA$ commutes with $b$,
then~$a$ commutes with~$\ceil{b}$.
\begin{point}{20}{Proof}
Since~$0\leq b\leq b^{\nicefrac{1}{2}}\leq
b^{\nicefrac{1}{4}}\leq\dotsb\leq 1$,
    we may define~$p:=\bigvee_n b^{\nicefrac{1}{2^n}}$.
\begin{point}{30}[vna-ceil-point-1]%
To begin,
note that if~$a\in \scrA$
commutes with~$b$,
then~$a$ commutes with~$p$.
Indeed, for such~$a$ we have~$a\sqrt{b}=\sqrt{b}a$
by~\sref{sqrt},
and so $a b^{\nicefrac{1}{2^n}} = b^{\nicefrac{1}{2^n}} a$
for each~$n$
by induction.
Thus~$ap=pa$ by~\sref{vna-supremum-commutes}.
\end{point}
\begin{point}{40}%
Let us prove that~$p$ is a projection, i.e.~$p^2=p$. 
Since~$p\leq 1$, we already have $p^2\equiv \sqrt{p}p\sqrt{p}\leq p$
by~\sref{astara-pos-basic-consequences},
and so we only need to show that $p\leq p^2$. We have:
\begin{alignat*}{3}
 p^2 \ &=\  \textstyle \bigvee_m \sqrt{p} \,b^{\nicefrac{1}{2^m}} \,\sqrt{p}
\qquad&&\text{by \sref{ad-normal}} \\
&=\ \textstyle\bigvee_m b^{\nicefrac{1}{2^{m+1}}}\, p\,
b^{\nicefrac{1}{2^{m+1}}} 
\qquad&&\text{by \sref{vna-ceil-point-1} and \sref{sqrt}} \\
&=\ \textstyle \bigvee_m \bigvee_n \, 
b^{\nicefrac{1}{2^{m+1}}}\, b^{\nicefrac{1}{2^n}}\,
b^{\nicefrac{1}{2^{m+1}}} \qquad && \text{by \sref{ad-normal}}
\end{alignat*}
Thus $p^2 \geq b^{\nicefrac{1}{2^k}}$
for each~$k$ (taking $n=m=k+1$,)
and so~$p^2 \geq p$.
\end{point}
\begin{point}{50}%
It remains to be shown that~$p$ is the \emph{least} projection
above~$b$.
Let~$q$ be a projection in~$\scrA$ with $b\leq q$;
we must show that~$q\leq p$.
We have $b^{\nicefrac{1}{2}}\leq q$
by~\sref{projection-above-effect},
and so $b^{\nicefrac{1}{2^n}}\leq q$ for each~$n$ by induction.
Hence $p\leq q$.\qed
\end{point}
\end{point}
\end{point}
\begin{point}{60}[vna-floor]{Proposition}%
Below every effect~$b$ of a von Neumann algebra~$\scrA$,
there is greatest projection, \Define{$\floor{b}$},%
\index{*floor@$\floor{\,\cdot\,}$!$\floor{a}$, of an effect}
	we call the \Define{floor}%
\index{floor!of an effect}
of~$b$,
given by~$\floor{b} = \bigwedge_{n=0}^\infty b^{2^{n}}$.\\
Moreover, if~$a\in \scrA$ commutes with~$b$,
then~$b$ commutes with~$\floor{b}$.
\begin{point}{70}{Proof}%
Note that $1\geq b\geq b^2 \geq b^4 \geq  \dotsb \geq 0$,
    and define $p:=\bigwedge_n b^{2^n}$
    (see~\sref{infima-in-vna}.)
\begin{point}{80}[vna-floor-point-1]%
If~$a\in \scrA$ commutes with~$b$,
then~$a$ commutes with~$p$.
Indeed, such~$a$ commutes with~$b^2$ (because
$ab^2 = bab = b^2a$,)
and so~$a$ commutes with~$b^{2^n}$ for each~$n$ by induction.
Thus~$a$ commutes with~$p\equiv\bigwedge_n b^{2^n}$ 
(by a variation on~\sref{vna-supremum-commutes}.)
\end{point}
\begin{point}{90}%
To see that~$p$ is a projection, i.e.~$p^2=p$,
we only need to show that~$p\leq p^2$,
because we get $p^2\equiv \sqrt{p}\,p\,\sqrt{p}\leq p$
from $p\leq 1$ (using~\sref{astara-pos-basic-consequences}.)
Now, since
\begin{alignat*}{3}
p^2 \ &=\ \textstyle \bigwedge_m\  \sqrt{p}\, b^{2^m} \sqrt{p}\qquad
&&\text{by a variation on~\sref{ad-normal}}\\
&=\ \textstyle \bigwedge_m \ b^{2^{m-1}} p\, b^{2^{m-1}}\qquad
&&\text{by~\sref{vna-floor-point-1} and~\sref{sqrt}}\\
&=\ \textstyle \bigwedge_m \bigwedge_n \ 
b^{2^{m-1}}\, b^{2^n}\, b^{2^{m-1}}\qquad
&&\text{by~\sref{ad-normal},}
\end{alignat*}
and $p\leq b^{2^{m-1}}\, b^{2^n}\,b^{2^{m-1}}$
for all~$n,m$, we get~$p\leq p^2$.
\end{point}
\begin{point}{100}%
It remains to be shown that~$p$ is the greatest projection below~$b$.
Let~$q$ be a projection in~$\scrA$ with~$q\leq b$.
We must show that~$q\leq p$.
Since~$q\leq b$,
we have~$q\leq b^2$ (by~\sref{projection-below-effect}),
and so~$q\leq b^{2^n}$ for each~$n$ by induction.
Thus~$q\leq p\equiv\bigwedge_n b^{2^n}$.\qed
\end{point}
\end{point}
\end{point}
\begin{point}{110}[ceil-floor-second-property]{Exercise}%
Show that given an effect~$a$ and a projection~$p$
in a von Neumann algebra~$\scrA$ we have
\begin{enumerate}
\item
$pa=a$ iff $ap=a$ iff $\ceil{a}\leq p$, and
\item
$pa=p$ iff $ap=p$ iff $p\leq \floor{a}$.
\end{enumerate}
Conclude that~$\ceil{a}$
is the least projection~$p$ with $a=a p$
(or, equivalently, $a=pa$),
and that $\floor{a}$
is the greatest projection~$p$ with $p=a p$
(or, equivalently, $p=pa$.)

In particular,
$a=a\ceil{a}=\ceil{a}a$
and $\floor{a}=a\floor{a}=\floor{a}a$.
\end{point}
\begin{point}{120}{Example}%
Given a finite complete measure space~$X$
we have
\begin{equation*}
\ceil{f^\circ}
	\,=\,\mathbf{1}_{\{x\in X\colon f(x)>0\}}^\circ
	\qquad
	\text{and}\qquad
	\floor{f^\circ}
	\,=\, \mathbf{1}_{\{x\in X\colon  f(x)=1\}}^\circ
\end{equation*}
for every~$f\in\mathcal{L}^\infty(X)$
with~$0\leq f^\circ \leq 1$.
\end{point}
\begin{point}{130}[ceil-floor-basic]{Exercise}%
Let~$a,b$ be effects of a von Neumann algebra~$\scrA$,
and let~$\lambda\in [0,1]$.
\begin{enumerate}
\item
Show that $\ceil{a}^\perp = \floor{a^\perp}$
and $\floor{a}^\perp = \ceil{a^\perp}$.
\item
Show that~$\ceil{\lambda a} = \ceil{a}$
when~$\lambda\neq 0$.

Use this to prove that~$\ceil{\lambda a+\lambda^\perp b}$
is the supremum of~$\ceil{a}$ and~$\ceil{b}$
in the poset of projections of~$\scrA$
when~$\lambda\neq 0$ and~$\lambda\neq 1$.
\item
Show that $\floor{a}=\floor{a^2}$
and $\ceil{a}=\ceil{a^2}$.
\end{enumerate}%
\spacingfix%
\end{point}%
\begin{point}{140}[vna-directed-supremum-projections]{Lemma}%
The supremum of a directed set~$D$ of projections
from a von Neumann algebra~$\scrA$ is a projection.
\begin{point}{150}{Proof}%
Writing $p=\bigvee D$,
we must show that $p^2=p$.
Note that $dp=d$ for all~$d\in D$
(by~\sref{projection-below-effect} because~$d\leq p$.)
Now, on the one hand, $(d)_{d\in D}$
converges ultraweakly to~$p$.
On the other hand,
$(dp)_{d\in D}$
converges ultraweakly to~$p^2$ by~\sref{vna-supremum-mult}.
Hence~$p=p^2$ by uniqueness of ultraweak limits.
\end{point}
\end{point}
\begin{point}{160}{Exercise}%
Deduce from this result
 that every set~$A$ of projections from~$\scrA$
has a supremum $\Define{\bigcup A}$%
\index{*bigcupA@$\bigcup A$, supremum of projections}
and an infimum $\Define{\bigcap A}$%
\index{*bigcapA@$\bigcap A$, infimum of projections}
\emph{in the poset of projections from~$\scrA$}.\\
(Hint: use~\sref{ceil-floor-basic},
and the fact that $p\mapsto p^\perp$ 
is an order anti-isomorphism on the poset of projections on~$\scrA$.)
\end{point}
\begin{point}{170}[ceil-supremum]{Exercise}
Let~$\scrA$ be a von Neumann algebra.
\begin{enumerate}
\item
Show that $\ceil{\bigvee D}=\bigcup_{d\in D} \ceil{d}$
for every directed set~$D$ of effects from~$\scrA$.
\item
Show that $\floor{\bigwedge D} = \bigcap_{d\in D} \floor{d}$
for every filtered set~$D$ of effects from~$\scrA$.
\item
Show that $\ceil{\,\cdot\,}$
does not preserve filtered infima,
and~$\floor{\,\cdot\,}$
does not preserve directed suprema.
(Hint: $1,\frac{1}{2},\frac{1}{3},\dotsc$.)

Conclude that $\ceil{\,\cdot\,}$
and $\floor{\,\cdot\,}$
are neither ultraweakly, ultrastrongly nor norm  continuous
as maps from $[0,1]_\scrA$ to~$[0,1]_\scrA$.
\end{enumerate}
\spacingfix
\end{point}%
\begin{point}{180}[sum-of-orthogonal-projections]{Exercise}%
Show that for a family~$(p_i)_{i\in I}$ 
of pairwise orthogonal projections
(with~$I$ potentially uncountable)
the series $\sum_i p_i$
converges ultrastrongly to~$\bigcup_i p_i$.

(Hint: 
use the fact that $\sum_{i\in F} p_i = \bigcup_{i \in F} p_i$
for finite subsets~$F$ of~$I$ by~\sref{orthogonal-tuple-of-projections}.)
\end{point}
\end{parsec}
\begin{parsec}{570}[floor-sequential-product]%
\begin{point}{10}{Lemma}%
Let~$a,b$ be effects of a von Neumann algebra~$\scrA$.
Then~$\floor{\sqrt{a}b\sqrt{a}}$ is the greatest projection
below~$a$ and~$b$, that is, 
$\floor{\sqrt{a}b\sqrt{a}}=\floor{a}\cap \floor{b}$.
\begin{point}{20}{Proof}%
Surely, $\floor{\sqrt{a}b\sqrt{a}}\leq \sqrt{a}b\sqrt{a} \leq a$.
Let us prove that~$\floor{\sqrt{a}b\sqrt{a}}\leq b$.
To this end,
recall
that (by~\sref{projection-below-effect})
a projection~$e$ is below an effect~$c$
iff $ec=e$ iff $e\sqrt{c}=e$.
In particular,
since~$\floor{\sqrt{a}b\sqrt{a}}\leq \sqrt{a}b\sqrt{a}$ and 
$\floor{\sqrt{a}b\sqrt{a}}\leq a$,
we get
\begin{equation*}
\floor{\sqrt{a}b\sqrt{a}}
\ =\ \floor{\sqrt{a}b\sqrt{a}}\sqrt{a}b\sqrt{a}\floor{\sqrt{a}b\sqrt{a}} \ =\ 
\floor{\sqrt{a}b\sqrt{a}}b\floor{\sqrt{a}b\sqrt{a}},
\end{equation*}
and so $\floor{\sqrt{a}b\sqrt{a}}b^\perp\floor{\sqrt{a}b\sqrt{a}}=0$,
which implies that
$\floor{\sqrt{a}b\sqrt{a}}\leq b$ by~\sref{ad-contraposed}.
\begin{point}{30}%
Now,
let~$e$ be a projection below~$a$ and~$b$,
that is, $e\sqrt{a}=e$ and~$eb=e$.
We must show that~$e\leq \floor{\sqrt{a}b\sqrt{a}}$,
or equivalently, $e\leq \sqrt{a}b\sqrt{a}$,
or put yet differently, $e\sqrt{a}b\sqrt{a}=e$.
But this is obvious: $e=e\sqrt{a}=eb\sqrt{a}=e\sqrt{a}b\sqrt{a}$.\qed
\end{point}
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{580}%
\begin{point}{10}%
Having seen that~$\floor{\sqrt{a}b\sqrt{a}} = \floor{a}\cap\floor{b}$
in~\sref{floor-sequential-product}
one might wonder whether
there is a similar expression for $\ceil{\sqrt{a}b\sqrt{a}}$,
but this doesn't seem to exist.
However,
for projections
$p$ and~$q$
we have
$\ceil{pqp}= p\cap (p^\perp \cup q)$
as we'll show below.
\end{point}
\begin{point}{20}[floor-difference]{Lemma}%
Let~$p$ be a projection,
and let~$a$ be an effect of a von Neumann algebra
with $a\leq p$.
We have $p-\ceil{a}=\floor{p-a}$.
\begin{point}{30}{Proof}%
We must show that $p-\ceil{a}$ is the greatest projection below $p-a$.
To begin, $p-\ceil{a}\leq p-a$,
because $a\leq \ceil{a}$.
Further, since~$a\leq p$, we have $\ceil{a}\leq p$,
and so~$p-\ceil{a}$ is a projection
(by~\sref{projection-below-projection}).

Let~$q$ be a projection below~$p-a$.
We must show that~$q\leq p-\ceil{a}$.
The trick is to note that~$a\leq p-q$.
Since~$p-q$ is a projection (by~\sref{projection-below-projection}
because $q\leq p-a\leq p$),
we have $\ceil{a}\leq p-q$,
and so $q\leq p-\ceil{a}$.\qed
\end{point}
\end{point}
\begin{point}{40}[ceil-sequential-product]{Proposition}%
We have $\ceil{pqp}=p\cap (p^\perp \cup q)$
for all projections~$p$ and~$q$ from a von Neumann algebra.
\begin{point}{50}[ceil-sequential-product-1]{Proof}%
Observe that $(\ p\cap (p^\perp \cup q)\ )^\perp 
= p^\perp \cup(p\cap q^\perp)$.
Since~$p^\perp$ and $p\cap q^\perp$ are disjoint,
we have $p^\perp \cup (p\cap q^\perp) = p^\perp + p\cap q^\perp$,
and so $p\cap (p^\perp \cup q) = p-p\cap q^\perp$.

By point~\sref{ceil-sequential-product-1}, 
it suffices to show that~$\ceil{pqp}=p- p\cap q^\perp$,
that is, $p-\ceil{pqp}=p\cap q^\perp$.
Since $p-\ceil{pqp} = \floor{p-pqp}$
by~\sref{floor-difference} and $\floor{pq^\perp p}=p\cap q^\perp$
by~\sref{floor-sequential-product} we are done.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Range and Support}
\begin{parsec}{590}%
\begin{point}{10}[ceill]{Notation}%
Let~$\scrA$ be a von Neumann algebra.
Because it will be very convenient
we extend the definition of~$\ceil{b}$
to all positive~$b$ from~$\scrA$
by 
$\Define{\ceil{b}}:=\ceil{\|b\|^{-1} b}$%
\index{ceiling}%
\index{*ceil@$\ceil{\,\cdot\,}$!$\ceil{a}$, ceiling}
when~$b\nleq 1$.
    Note that---contrary to what the notation suggests---we
    do \emph{not} have  $b\leq \ceil{b}$, 
    for those~$b\nleq 1$.

Now, given an arbitrary element~$b$ of~$\scrA$,
we'll call $\Define{\ceill{b}}:=\ceil{b^*b}$
the \Define{support (projection)} of~$b$,%
\index{*ceill@$\ceill{a}$, support}
	and~$\Define{\ceilr{b}}:=\ceil{bb^*}$%
\index{*ceilr@$\ceilr{a}$, range}
the \Define{range (projection)} of~$b$.
\end{point}
\begin{point}{20}{Remark}%
Some explanation is in order here.
We did not just introduce
the range
and support notation for its own sake,
but will use it extensively in~\S\ref{S:division}
thanks to calculation  rules
such as $ab=0\iff \ceill{a}\ceilr{b}=0$
(see~\sref{mult-cancellation}).
The notation was chosen such 
that $\ceilr{b} b=b= b\ceill{b}$
(see~\sref{ceill-basic}).
Good examples are 
\begin{equation*}
	\ceill{\,\ketbra{x}{y}\,}
\,= \,\ketbra{y}{y}
\qquad\text{and}\qquad
\ceilr{\,\ketbra{x}{y}\,}
\,=\, \ketbra{x}{x}
\end{equation*}
for unit vectors~$x$ and~$y$ from a Hilbert space~$\scrH$.
\end{point}
\begin{point}{30}[ceil-basic]{Exercise}%
Let~$a$ and~$b$ be positive elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Given a projection~$p$ in~$\scrA$
show that $pa=a$ iff $ap=a$ iff $\ceil{a}\leq p$.

(In particular, $\ceil{a}$ is the least projection~$p$ of~$\scrA$
with $a p=a$.)

\item
Show that $\ceil{a}a=a\ceil{a}$,
and if fact, if $b\in\scrA$ commutes with~$a$
then~$b$ commutes with~$\ceil{a}$.

\item
Show that~$a=0$ iff $\ceil{a}=0$.

\item
Show that $\ceil{a}=\ceil{\lambda a}$
for every~$\lambda>0$.

Show that $\ceil{a+b}=\ceil{a}\cup\ceil{b}$.
\item
Show that $\ceil{a^2}=\ceil{a}$.
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{40}[ceil-pos-part]{Exercise}%
Let~$a$ be a self-adjoint element of a von Neumann algebra.
\begin{enumerate}
\item
Show that~$\ceil{a_+}\ceil{a_-}= 0$.
(Hint: recall from~\sref{cstar-pos-neg-part} that~$a_+a_-=0$.)
\item
	Show that~$\ceil{a_+}a = a\ceil{a_+} = a_+$
	and~$\ceil{a_-}a=a\ceil{a_-} = -a_-$.
\end{enumerate}
\spacingfix%
\end{point}
\begin{point}{50}[ceil-suprema]{Exercise}%
Show that $\ceil{\bigvee D} = \bigcup_{d\in D}\ceil{d}$
for every bounded directed set of \emph{positive}
elements of a von Neumann algebra~$\scrA$.
\end{point}
\begin{point}{60}[ceill-basic]{Exercise}%
Let~$a$ and~$b$  be elements of a von Neumann algebra.
\begin{enumerate}
\item
Show that $\ceill{a}\equiv \ceil{a^*a}$
is the least projection~$p$ of~$\scrA$
with $ap =a$.

\item
Show that $\ceilr{a}\equiv \ceil{aa^*}$
is the least projection~$p$ of~$\scrA$
with $pa=a$.

\item
Show that $\ceill{a^*}=\ceilr{a}$
and $\ceilr{a^*}=\ceill{a}$.

\item
Show that~$\ceill{ab}\leq\ceill{b}$
and~$\ceilr{ab}\leq\ceilr{a}$.
\end{enumerate}
\spacingfix%
\end{point}
\begin{point}{70}[hilb-ceil]{Exercise}%
Let~$T$ be a bounded operator on a Hilbert space~$\scrH$.
\begin{enumerate}
\item
Show that $\ceilr{T}$
is the projection onto the closure
$\overline{\Ran(T)}$ of the range of~$T$.
\item
Show that $\ceill{T}$
is the projection onto the \emph{support}
of~$T$, i.e.~the orthocomplement
$\Ker(T)^\perp$ of the kernel of~$T$.
\item
Show that $\floor{T}$ is the projection
on $\{\,x\in\scrH\colon\, Tx=x\,\}$
when~$T$ is an effect.
\end{enumerate}
\spacingfix%
\end{point}%
\end{parsec}%
\begin{parsec}{600}%
\begin{point}{10}[ceil-functionals-lemma]{Lemma}%
Given a positive element~$a$
of a von Neumann algebra~$\scrA$ and an
np-functional~$\omega\colon \scrA\to\C$
we have~$\omega(a)=0$ iff~$\omega(\ceil{a})=0$.
\begin{point}{20}{Proof}%
Note that if~$a=0$,
the stated result is clearly correct,
and the other case, when~$\|a\| \neq 0$,
the problem reduces to the case
that $0\leq a\leq 1$
by replacing $a$ by~$\frac{a}{\|a\|}$.
So let us just assume that~$a\in [0,1]_\scrA$
to begin with.
For similar reasons, we may assume that $\omega (1)\leq 1$.

Now, since~$0\leq a\leq \ceil{a}$
we have $0\leq \omega(a)\leq \omega(\ceil{a})$,
so~$\omega(\ceil{a})=0\implies \omega(a)=0$
is obvious.
It remains to be shown that $\omega(\ceil{a})=0$
given~$\omega(a)=0$.
Since  $\ceil{a}=\bigvee_n a^{\nicefrac{1}{2^n}}$ 
(by~\sref{vna-ceil})
and~$\omega$ is normal,
we have $\omega(\ceil{a})=\bigvee_n \omega(a^{\nicefrac{1}{2^n}})$,
and so it suffices to show that~$\omega(a^{\nicefrac{1}{2^n}})=0$
for each~$n$.
As a result of Kadison's inequality
(see~\sref{omega-norm-basic})
we have~$\omega(\sqrt{a})^2\leq \omega(a)=0$,
and so~$\omega(\sqrt{a})=0$.
Since then~$\omega(\smash{\sqrt{\sqrt{a}}})=0$
by the same token, and so on,
we get $\omega(a^{\nicefrac{1}{2^n}})=0$
for all~$n$ by induction.\qed
\end{point}
\end{point}
\begin{point}{30}[ceil-functionals]{Proposition}%
For positive elements~$a$ and~$b$ of a von Neumann algebra~$\scrA$,
\begin{equation*}
\ceil{a}\leq \ceil{b}
\qquad\iff\qquad
\forall \omega\,[\quad\omega(b)=0\  \implies  \ \omega(a)=0\quad ],
\end{equation*}
where~$\omega$ ranges over all np-functionals~$\scrA\to\C$.
\begin{point}{40}{Proof}%
When~$\ceil{a}\leq\ceil{b}$
and~$\omega$ is an np-functional on~$\scrA$
with~$\omega(b)=0$,
then~$0\leq \omega(\ceil{a})\leq \omega(\ceil{b})=0$
(by~\sref{ceil-functionals-lemma}),
and so~$\omega(\ceil{a})=0$,
so that~$\omega(a)=0$
(again
by~\sref{ceil-functionals-lemma}).

For the other direction,
assume that~$\omega(b)=0\implies \omega(a)=0$
for every np-functional~$\omega$ on~$\scrA$;
we must show that~$\ceil{a}\leq \ceil{b}$,
or in other words, $\smash{\ceil{b}}^\perp \ceil{a}\smash{\ceil{b}}^\perp =0$.
Let~$\omega\colon \scrA\to\C$ be an arbitrary np-functional;
it suffices to show that 
$\omega(\,\smash{\ceil{b}}^\perp \ceil{a}\smash{\ceil{b}}^\perp \,)=0$.
Since~$\smash{\ceil{b}}^\perp b \smash{\ceil{b}}^\perp =0$
we have~$\omega(\smash{\ceil{b}}^\perp b\smash{\ceil{b}}^\perp)=0$
and so~$\omega(\smash{\ceil{b}}^\perp a \smash{\ceil{b}}^\perp)=0$
(by assumption, because
$\omega(\smash{\ceil{b}}^\perp(\,\cdot\,)\smash{\ceil{b}}^\perp)$
is an np-functional on~$\scrA$ as well),
which implies that
$\omega(\smash{\ceil{b}}^\perp\ceil{a}\smash{\ceil{b}}^\perp)=0$
by~\sref{ceil-functionals-lemma}.\qed
\end{point}
\end{point}
\begin{point}{50}[ncp-ceil]{Proposition}%
Let $f\colon \scrA\to\scrB$ be an np-map
between von Neumann algebras.
Then $\ceil{f(a)}=\ceil{f(\ceil{a})}$
for every $a\in\scrA_+$.
\begin{point}{60}{Proof}%
By~\sref{ceil-functionals}
it suffices to show that
$\omega(f(a))=0$ iff $\omega(f(\ceil{a}))=0$
for every np-functional $\omega\colon \scrB\to\C$,
and this is indeed the case by~\sref{ceil-functionals-lemma}.\qed
\end{point}
\end{point}
\begin{point}{70}[ceil-fundamental]{Exercise}%
Let~$a$ and~$b$ be elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Deduce from~\sref{ncp-ceil}
that
$\ceil{a^*ba} = \ceil{a^*\ceil{b}a}$
when~$b\geq 0$.
\item
Conclude that~$\ceill{ab}=\ceill{\ceill{a}b}$
and~$\ceilr{ab}=\ceilr{a\ceilr{b}}$
(see~\sref{ceill}).
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{80}[mult-cancellation]{Exercise}%
Let~$a$ and~$b$ be elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that $cb=0$ iff $\ceill{c}\ceilr{b}=0$
iff $\ceill{c}\leq \ceilr{b}^\perp$
for~$c\in\scrA$.

(Hint: if $cb=0$,
then $\ceil{b^*c^*cb}\equiv \ceil{b^*\ceil{c^*c}b}=0$
by~\sref{ceil-fundamental}.)
\item
Show that~$c_1b=c_2b \implies c_1=c_2$
for all~$c_1,c_2\in\scrA$
with~$\ceill{c_i}\leq \ceilr{b}$.
\item
Show that $b^*c_1b=b^*c_2b\implies c_1=c_2$
for all~$c_1,c_2\in\ceilr{b}\scrA\ceilr{b}$
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{90}[ncp-union]{Exercise}%
Let~$f\colon \scrA\to\scrB$ be an np-map
between von Neumann algebras.
\begin{enumerate}
\item
Show that
$\ceil{f(p\cup q)}
= \ceil{f(p)}\cup\ceil{f(q)}$
for all projections $p$ and~$q$ in~$\scrA$.

(Hint: recall from~\sref{ceil-floor-basic} 
that $p\cup q = \ceil{\frac{1}{2}p+\frac{1}{2}q}$.)

\item
Deduce from this and~\sref{ncp-ceil} that $\ceil{f(\bigcup A)}=\bigcup_{a\in A}\ceil{f(a)}$
for every set of projections~$A$ from~$\scrA$.

\item
Show that there is a greatest projection~$e$
in~$\scrA$ with~$f(e)=0$.
\end{enumerate}
\spacingfix%
\end{point}%
\end{parsec}%
\begin{parsec}{610}%
\begin{point}{10}%
Given the rule $\ceil{f(\ceil{a})}=\ceil{f(a)}$
for an np-map~$f$ and self-adjoint~$a$
one might surmise that
the equation $\ceil{f(\ceill{a})}=\ceill{f(a)}$
holds 
for arbitrary~$a$;
but
one would be mistaken to do so.
We can, however,
recover an inequality
by assuming that~$f$ is completely positive, see~\sref{ncp-ceill}.
One of its corollaries is
that ncpsu-isomorphisms
are in fact nmiu-isomorphisms (see~\sref{iso}).
\end{point}
\begin{point}{20}[ncp-ceill]{Proposition}%
Given an ncp-map $f\colon \scrA\to\scrB$
between von Neumann algebras
we have,
for all
$a\in\scrA$,
\begin{equation*}
	\ceil{f(\,\ceill{a}\,)}\,\leq\, \ceill{f(a)\,}
	\qquad\text{and}\qquad
	\ceil{f(\,\ceilr{a}\,)}\,\leq\, \ceilr{\,f(a)}.
\end{equation*}
\spacingfix%
\begin{point}{30}{Proof}%
Since~$f(a)^*f(a)\leq \|f(1)\|^2\,f(a^*a)$
 by~\sref{cp-cs},
we get~$\ceill{f(a)\,}\equiv \ceil{f(a)^*f(a)}
	\leq \ceil{\,\smash{\|f(1)\|^2f(a^*a)}\,}
	\leq \ceil{f(a^*a)}
	=\ceil{f(\ceil{a^*a})}
	\equiv \ceil{f(\ceill{a})}$.

One obtains $\ceil{f(\,\ceilr{a}\,)}\leq \ceilr{\,f(a)}$
along similar lines.\qed
\end{point}
\end{point}
\end{parsec}%
\begin{parsec}{620}%
\begin{point}{10}{Proposition}%
Let~$f\colon \scrA\to\scrB$ be a ncpsu-map
between von Neumann algebras.
Then~$\floor{f(a)}=\floor{f(\floor{a})}$
for every effect~$a$ from~$\scrA$.
\begin{point}{20}{Proof}%
Since~$\floor{a}\leq a$,
we have~$\floor{f(\floor{a})}\leq \floor{f(a)}$.
Thus we only need to show that~$\floor{f(a)}\leq \floor{f(\floor{a})}$,
or equivalently, $\floor{f(a)}\leq f(\floor{a})$.
We have
\begin{equation*}
\floor{f(a)}
\ \overset{\sref{ceil-floor-basic}}{=\joinrel=\joinrel=}\ 
\floor{f(a)^2}
\ \stackrel{\sref{inner-product-basic}}{\leq}\  
\floor{f(a^2)} \ \leq\ \floor{f(a)},
\end{equation*}
and so~$\floor{f(a)}=\floor{f(a^2)}$.
By induction,
and similar reasoning,
we get~$\floor{f(a)}=\floor{f(a^{2^n})}\leq f(a^{2^n})$
for every~$n$,
and so
$\floor{f(a)}\leq \bigwedge_n f(a^{2^n})
= f(\bigwedge_n a^{2^n})=f(\floor{a})$,
where we used that~$f$ is normal,
and~$\floor{a}=\bigwedge_n a^{2^n}$ (see~\sref{vna-floor}).\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Carrier and Commutant}
\begin{parsec}{630}%
\begin{point}{10}[carrier]{Definition}%
The \Define{carrier}%
\index{carrier}
of an np-map $f\colon \scrA\to\scrB$
between von Neumann algebras
(written $\Define{\ceil{f}}$)%
\index{*ceil@$\ceil{\,\cdot\,}$!$\ceil{f}$, carrier of an np-map}
is the least projection~$p$
with~$f(p^\perp)=0$
(which exists by~\sref{ncp-union}.)
\end{point}
\begin{point}{20}[carrier-basic]{Exercise}%
Let~$f,g\colon \scrA\to\scrB$
be np-maps between von Neumann algebras.
\begin{enumerate}
\item
Show that $\ceil{\lambda f}=\ceil{f}$
for all~$\lambda>0$.
\item
Show that~$\ceil{f+g}=\ceil{f}\cup\ceil{g}$.
\item
Show that~$\ceil{f}=1$ iff~$f$ is faithful.
\item
Assuming~$f$ is multiplicative
show that~$\ceil{f}=1$ iff~$f$ is injective.

(There is more to be said about
the carrier of an nmiu-map, see~\sref{carrier-miu}.)
\end{enumerate}
\spacingfix%
\end{point}
\begin{point}{30}{Exercise}%
\begin{enumerate}
\item
Given an element~$a$ of a von Neumann algebra~$\scrA$
show that 
\begin{equation*}
\ceil{a^*(\,\cdot\,)a}\ =\ \ceil{aa^*}\equiv \ceilr{a}
\end{equation*}
where~$a^*(\,\cdot\,)a$
is interpreted as an np-map~$\scrA\to\scrA$.
\item
Given a bounded operator~$T\colon \scrH\to\scrK$
between Hilbert spaces
show that~$\ceil{T^*(\,\cdot\,)T}$
is the projection onto~$\overline{\Ran(T)}$
when~$T^*(\,\cdot\,)T$
is interpreted 
as a map
$\scrB(\scrK)\to\scrB(\scrH)$.
\item
Show that~$\ceil{\left<x,(\,\cdot\,)x\right>}=\ketbra{x}{x}$
for any unit vector~$x$ from a Hilbert space~$\scrH$
when~$\left<x,(\,\cdot\,)x\right>$
is interpreted as a map~$\scrB(\scrH)\to\C$.

(But be warned: when~$\scrA$ is a von Neumann subalgebra of~$\scrB(\scrH)$
the carrier of the restriction 
$\left<x,(\,\cdot\,)x\right>\colon \scrA\to\C$
might differ from~$\ketbra{x}{x}$ because the former is in~$\scrA$,
while the latter may not be, see~\sref{carrier-vector-state}.)
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{40}[cp-comprehension]{Lemma}%
Let~$f\colon \scrA\to\scrB$ be a p-map between
$C^*$-algebras,
and let~$p$ be an effect of~$\scrA$ with~$f(p^\perp)=0$.
Then $f(a)=f(pa)=f(ap)=f(pap)$
for all~$a\in\scrA$.
\begin{point}{50}{Proof}%
Assume~$\scrB=\C$ for now.
Since~$p^\perp \leq 1$,
we have $(p^\perp)^2=\sqrt{p^\perp}p^\perp \sqrt{p^\perp}
\leq p^\perp$,
and so~$0\leq f(\,(p^\perp)^2\,) \leq f(p^\perp) = 0$,
giving us $f(\,(p^\perp)^2\,)=0$.
Since
$\left|\smash{f(p^\perp a)}\right|^2
\leq f(\,(p^\perp)^2\,)\  f(a^*a)\,=\, 0$
by Kadison's inequality, \sref{omega-norm-basic}, 
we get~$f(p^\perp a)=0$, and so~$f(pa)=f(a)$ for all~$a\in\scrA$.
In particular,
$f(ap)=f(pa^*)^*=f(a^*)^*=f(a)$
for all~$a\in\scrA$,
and so~$f(pap)=f(pa)=f(a)$
for all~$a\in \scrA$.

Letting~$\scrB$ be again arbitrary,
and given~$a\in\scrA$,
note that
since the states on~$\scrB$ 
are separating (by~\sref{states-order-separating})
it suffices 
to show that $\omega(f(a))=\omega(f(ap))=\omega(f(pa))=
\omega(f(pap))$ for all
states $\omega \colon \scrB\to\C$.
But this follows from the previous paragraph
since~$\omega\circ f$
is a p-map into~$\C$.\qed
\end{point}
\end{point}
\begin{point}{60}[carrier-fundamental]{Corollary}%
Given an np-map $f\colon \scrA\to\scrB$
between von Neumann algebras
we have $f(a)=f(\ceil{f}a) = f(a\ceil{f})=f(\ceil{f}a\ceil{f})$
for all~$a\in\scrA$.
\end{point}
\end{parsec}
\begin{parsec}{640}%
\begin{point}{10}%
We turn
to the task of showing that every element
of a von Neumann
algebra is the norm limit of linear combinations
of projections in~\sref{projections-norm-dense}.
We'll deal with the  commutative case first
(see~\sref{abelian-projections-norm-dense}).
\end{point}
\begin{point}{20}[abelian-projections-norm-dense]{Proposition}%
Every element~$a$ of a commutative von Neumann algebra~$\scrA$
is the norm limit
of linear combinations of projections.
\begin{point}{30}{Proof}%
By~\sref{ngelfand}
it suffices to show that the linear span
of projections is norm dense
in~$C(\spec(\scrA))$.
For this, in turn, it suffices 
by Stone--Weierstra\ss{}' theorem
(see~\sref{stone-weierstrass})
to show that the projections in~$C(\spec(\scrA))$
separate the points of~$\spec(\scrA)$
in the sense
that given $x,y\in\spec(\scrA)$
with~$x\neq y$
there is a projection~$f$ in~$C(\spec(\scrA))$
with~$f(x)\neq f(y)$.
Since~$\spec(\scrA)$
is Hausdorff
there are for such~$x$ and~$y$
disjoint open subsets $U$ and~$V$
of~$\spec(\scrA)$
with~$x\in U$ and~$y\in V$.

Then
$f:=\mathbf{1}_{\overline{U}}$
is a projection in~$C(\spec(\scrA))$
(continuous
because~$\overline{U}$
is clopen by~\sref{vn-spectrum-extremally-disconnected})
with~$f(x)=0\neq 1=f(y)$
since $x\in \overline{U}\subseteq \spec(\scrA)\backslash V$,
and so~$y\notin \overline{U}$.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{650}%
\begin{point}{10}%
To reduce the general case
to the commutative case
we need the following tool
(that will be useful 
later on too for different reasons).
\end{point}
\begin{point}{20}[commutant]{Definition}%
Given a subset~$S$ of a von Neumann algebra~$\scrA$
	the \Define{commutant}\index{commutant} of~$S$
is the set, denoted by~$\Define{\smash{S^\square}}$,%
\index{*square@$S^\square$, commutant of~$S$}
of all~$a\in\scrA$ with $as=sa$ for all~$s\in S$.

The commutant of~$\scrA$ itself
is denoted by~$\Define{Z(\scrA)}:=\scrA^\square$%
\index{ZA@$Z(\scrA)$, centre of~$\scrA$}
and is called the \Define{centre}%
\index{centre of a von Neumann algebra} of~$\scrA$.
(Its elements, called \emph{central}, are the subjects of the next section.)
\end{point}
\begin{point}{30}[commutant-basic]{Exercise}%
Let~$S$ and~$T$ be subsets of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that $S \subseteq T^\square$ iff $T \subseteq S^\square$.

Show that $S\subseteq T$ entails $T^\square \subseteq S^\square$.

Show that $S\subseteq S^{\square\square}$,
and  $S^{\square\square\square}=S^\square$.
\item
Show that $S^\square$ is closed under addition,
(scalar) multiplication,
contains the unit of~$\scrA$,
and is ultraweakly closed.
\item
Show that the commutant $S^\square$ need not be closed under involution.\\
(Hint: compute 
$\{\bigl(\begin{smallmatrix}0&1\\0&0\end{smallmatrix}\bigr)\}^\square$
in $M_2$.)

Suppose~$S$ is closed under involution.

Show~$S^\square$ is closed under involution as well,
and conclude that in that case~$S^\square$
is a von Neumann subalgebra of~$\scrA$.

Show that~$Z(\scrA)$ is a von Neumann subalgebra of~$\scrA$.

Show that~$S^{\square\square}$
is a von Neumann subalgebra of~$\scrA$
with~$S\subseteq S^{\square\square}$.

Show that if~$S$ is commutative (i.e.~$S\subseteq S^\square$), 
then so is~$S^{\square\square}$.
\item
In particular,
if~$\scrB$ is a von Neumann subalgebra of~$\scrA$,
then~$\scrB^{\square\square}$
is a von Neumann subalgebra of~$\scrA$
with $\scrB\subseteq \scrB^{\square\square}$.

Show that~$(\,\scrA\cap \C\,)^\square=\scrA$,
and so~$(\,\scrA\cap\C\,)^{\square\square} = Z(\scrA)$.

So in general~$\scrB^{\square\square}$ needn't equal~$\scrB$.
Nevertheless,
we'll see in \sref{proto-double-commutant} that $\scrB^{\square\square}=\scrB$
when~$\scrA$ is of the form $\scrA=\scrB(\scrH)$
for some Hilbert space~$\scrH$.
\item
Given a von Neumann subalgebra~$\scrB$
of~$\scrA$
verify that $Z(\scrB)=\scrB\cap \scrB^{\square}$.
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{40}[projections-norm-dense]{Proposition}%
Every self-adjoint element~$a$ of a von Neumann algebra~$\scrA$
is the norm limit
of linear combinations
of projections from~$\smash{\{a\}}^{\square\square}$.
\begin{point}{50}{Proof}%
Since~$a$ is an element
of the by~\sref{commutant-basic}
commutative von Neumann subalgebra~$\smash{\{a\}}^{\square\square}$
of~$\scrA$,
$a$ is the norm limit of linear combinations
of projections from~$\smash{\{a\}}^{\square\square}$
by~\sref{abelian-projections-norm-dense}.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{660}%
\begin{point}{10}%
The carriers of np-functionals
play such an important role in the theory
that we decided to give them a name.
\end{point}
\begin{point}{20}{Definition}%
We call a projection~$p$ of a von Neumann algebra~$\scrA$
\Define{ultracyclic}%
\index{ultracyclic projection}
if~$p=\ceil{\omega}$
for some np-map $\omega\colon \scrA\to\C$.
\begin{point}{30}{Remark}%
Some explanation of this terminology
is in order.
A projection~$E$
in a von Neumann subalgebra~$\scrR$
of~$\scrB(\scrH)$
is usually defined to be \Define{cyclic}%
\index{cyclic projection}
when~$E$ is the projection 
onto~$\smash{\overline{\scrR^\square x}}$
for some~$x\in \scrH$
(see Definition~5.5.8~\cite{kr}).
With~\sref{carrier-vector-state} and~\sref{double-commutant}
we'll be able to see that
this amounts to requiring that~$E$
be
the carrier of the vector functional
$\left<x,(\,\cdot\,)x\right>\colon \scrR\to\C$.
So, loosely speaking,
a cyclic projection
is the carrier of a vector functional
with respect to some fixed Hilbert space,
while an ultracyclic projection
is the carrier of a vector functional
with respect to some arbitrary Hilbert space.
\end{point}
\end{point}
\begin{point}{40}[ultracyclic-basic]{Exercise}%
Let~$\scrA$ be a von Neumann algebra.
Verify the following facts.
\begin{enumerate}
\item
If~$p$ and~$q$ are ultracyclic projections in~$\scrA$,
then~$p\cup q$ is ultracyclic.
\item
If~$p \leq q$ are projections in~$\scrA$,
and~$q$ is ultracyclic,
then~$p$ is ultracyclic.
\item
Every projection~$p$ in~$\scrA$ is a directed supremum
of ultracyclic projections.
In fact, $p=\bigvee_\omega \ceil{\omega}$
where~$\omega$ ranges over the np-functionals on~$\scrA$
with $\omega(p^\perp)=0$.
(Hint: first consider~$p=1$.)
\item
Every projection~$p$ in~$\scrA$ is the 
sum of ultracyclic projections:
there are np-functionals $(\omega_i)_i$
on~$\scrA$ with $p=\sum_i \ceil{\omega_i}$.
\end{enumerate}
\spacingfix%
\end{point}%
\end{parsec}%
\subsection{Central Support and Central Carrier}
\begin{parsec}{670}%
\begin{point}{10}{Definition}%
An element~$a$ of a von Neumann algebra~$\scrA$
is called~\Define{central}%
\index{central!element of a von Neumann algebra}
when~$ab=ba$ for all~$b\in\scrA$
(that is, when~$a\in Z(\scrA)$, see~\sref{commutant-basic}).
\end{point}
\begin{point}{20}[central-examples]{Examples}%
\begin{enumerate}
\item
In a commutative von Neumann algebra
every element is central.
\item
An element~$a$ of a direct sum~$\bigoplus_i \scrA_i$
of von Neumann algebras
is central iff~$a_i$ is central for each~$i$.
\item
In~$\scrB(\scrH)$,
where~$\scrH$ is a Hilbert space,
only the scalars are central.

Indeed,
given a positive central element~$A$ 
of~$\scrB(\scrH)$,
we have $\left<x, A\|y\|^2 x\right>
        = \left<x,\,(A \ketbra{x}{y})\, y\right>
        = \left<x,\,(\ketbra{x}{y}A)\, y\right>
= \left<x,\smash{\|\sqrt{A}y\|^2 }x\right>$
for all~$x,y\in\scrH$,
and so~$A\|y\|^2= \|\sqrt{A}y\|^2$
for all~$y\in\scrH$.
Hence~$A$ is (zero or) a scalar.
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{30}{Remark}%
A von Neumann algebra
in which only the scalars are central
--- of which a~$\scrB(\scrH)$ is but the simplest example ---
	is called a \Define{factor}.\index{factor}
The classification of these factors
is an important part
of the theory of von Neumann algebras
that we did not need in this thesis.
\end{point}
\begin{point}{40}[central-projections-sums]{Exercise}%
Note that if a von Neumann algebra
$\scrA$ can be written as
a direct sum $\scrA\cong \scrB_1\oplus \scrB_2$,
then~$(1,0)\in\scrB_1\oplus\scrB_2$ gives
a central projection in~$\scrA$.
The converse also holds:
\begin{enumerate}
\item
Given a central projection~$c$ in~$\scrA$,
show that~$c\scrA \equiv \{\,ca\colon\, a\in\scrA\,\}$ 
is a von Neumann subalgebra of~$\scrA$
for all but the fact that $1$ need not be in~$c\scrA$.

Show~$c\scrA$
is a von Neumann algebra with~$c$ as unit,
and that $a\mapsto (ca,c^\perp a)$
gives an nmiu-isomorphism
$\scrA\to c\scrA\oplus c^\perp \scrA$.
\item
Given a family of central projections $(c_i)_i$ in~$\scrA$
with $\sum_i c_i=1$
show that $a\mapsto (c_ia)_i$
gives an nmiu-isomorphism $\scrA\to\bigoplus_i c_i \scrA$.
\end{enumerate}
\spacingfix%
\end{point}%
\end{parsec}%
\begin{parsec}{680}%
\begin{point}{10}[cceil-fundamental]{Proposition}%
Given a projection~$e$ of a von Neumann algebra~$\scrA$
\begin{equation*}
	\Define{\cceil{e}}\ :=\ 
	\bigcup_{a\in\scrA} \ceil{a^* e a}
\end{equation*}%
\index{*cceil@$\cceil{\,\cdot\,}$!$\cceil{a}$, central support}%
is the least central projection above~$e$.
\begin{point}{20}{Proof}%
Let us first show that~$\cceil{e}$ is central.
Given~$b\in\scrA$
we have $\ceill{\cceil{e}b}=\ceil{b^*\cceil{e}b}
=\bigcup_{a\in\scrA} \ceil{b^*\ceil{a^*ea}b}
= \bigcup_{a\in \scrA} \ceil{(ab)^* eab}
\leq \cceil{e}$
by~\sref{ncp-union},
which implies that~$\cceil{e}b\cceil{e}=\cceil{e}b$.
Since similarly (or consequently)
$\cceil{e}b\cceil{e} = b\cceil{e}$
we get~$b\cceil{e}=\cceil{e}b\cceil{e}
=\cceil{e}b$,
and so~$\cceil{e}$ is central.

Clearly~$e\leq \cceil{e}$.
It remains to be shown that~$\cceil{e}\leq c$
given a central projection~$c$ with~$e\leq c$.
For this it suffices to show that $\ceill{ea}\equiv \ceil{a^*ea}\leq c$
given~$a\in\scrA$.
Now, since~$e\leq c$
we have $ec=e$
and so~$eac=eca=ea$
which implies that~$\ceill{ea}\leq c$.
Thus~$\cceil{e}\leq c$.\qed
\end{point}
\end{point}
\begin{point}{30}[central support]{Definition}%
Let~$a$ be an element of a von Neumann algebra~$\scrA$.
Since given a central projection~$c$ of~$\scrA$
we have
$\cceil{\ceill{a}}\leq c$
iff $\ceill{a}\leq c$
iff $ac=a$ 
iff
$ca=a$ iff $\cceil{\ceilr{a}}\leq c$,
we see that~$\Define{\cceil{a}}:=
\cceil{\ceill{a}}=\cceil{\ceilr{a}}$
is the smallest central projection~$p$
with~$p a=a$,
which we'll call the
\Define{central support}%
\index{central support} 
	of~$a$.
\end{point}
\begin{point}{40}[cceil-basic]{Exercise}%
Let~$\scrA$ be a von Neumann algebra.
\begin{enumerate}
\item
Show that $\cceil{a}=\cceil{a^*}
=\cceil{a^*a}=\cceil{aa^*}$
for all~$a\in\scrA$.
\item
Show that~$\cceil{ \bigvee D } = \bigcup_{d\in D} \cceil{d}$
for any bounded directed subset of~$\scrA$.

Show that~$\cceil{\bigcup E} = \bigcup_{e\in E} \cceil{e}$
for any collection of projections from~$\scrA$.

Show that~$\cceil{a+b}=\cceil{\ceil{a}\cup \ceil{b}}
=\cceil{a}\cup\cceil{b}$
for all~$a,b\in \scrA$.
\item
Given~$a\in\scrA$
and a central projection~$c$ of~$\scrA$
show that~$\cceil{a}c=\cceil{ac}$.

Conclude that~$\cceil{a}\cceil{b}=\cceil{a\cceil{b}}
= \cceil{\cceil{a}b}
=\cceil{a}\cap\cceil{b}$
for all~$a,b\in\scrA$.
\end{enumerate}
\spacingfix%
\end{point}%
\end{parsec}%
\begin{parsec}{690}%
\begin{point}{10}[cceil-map-def]{Definition}%
Let $f\colon \scrA\to\scrB$
be an np-map
between von Neumann algebras.
Show that given a central effect~$c$
of~$\scrA$ we have
$f(c^\perp)=0$
iff $\ceil{f}\leq c$
iff $\cceil{\ceil{f}}\leq c$,
and so~$\Define{\cceil{f}}:=\cceil{\ceil{f}}$%
\index{*cceil@$\cceil{\,\cdot\,}$!$\cceil{f}$, central carrier}
is the least central effect
(and central projection) $p$
with~$f(p^\perp)=0$,
which we'll call the \Define{central carrier}%
\index{central carrier}
of~$f$.
\end{point}
\begin{point}{20}[prop:weakly-closed-ideal]{Proposition}%
Every two-sided ideal~$\scrD$ of a von Neumann
algebra~$\scrA$
that is closed under bounded directed suprema of self-adjoint 
elements --- for example when~$\scrA$ is ultrastrongly closed ---
is of the form~$c\scrA$
for some unique central projection~$c$ of~$\scrA$.
Moreover, $c$ is the greatest projection in~$\mathscr{D}$.
\begin{point}{30}{Proof}%
We'll obtain~$c$ as the supremum over all effects in~$\scrD$,
and to this end we'll show first that~$\scrD\cap [0,1]_\scrA$
is directed.
Since $\ceil{a}\cup \ceil{b} \equiv \ceil{\frac{1}{2}a+\frac{1}{2}b}$
(see~\sref{ceil-floor-basic})
is an upper bound for~$a,b\in\scrD\cap [0,1]_\scrA$
it suffices to show that~$\ceil{a}\in \scrD$
for all~$a\in \scrD\cap[0,1]_\scrA$,
which, in turn,
follows from
$\ceil{a}=\bigvee_n a^{\nicefrac{1}{2^n}}$,
see~\sref{vna-ceil}.

Hence~$\scrD\cap [0,1]_\scrA$ is directed,
and so we may define~$c:=\bigvee \scrD\cap[0,1]_\scrA$.
Since~$\scrD$ is a von Neumann subalgebra of~$\scrA$,
we'll have~$c\in\scrD\cap[0,1]_\scrA$,
and so~$c$ is the greatest element of~$\scrD\cap[0,1]_\scrA$.
In particular,
$c$ will be above~$\ceil{c}$ implying~$\ceil{c}=c$
and making~$c$ a projection---the greatest projection in~$\scrD$.

Given~$a\in\scrA$ we claim that~$a\in \scrD$
iff~$ca=a$.
Surely, if~$a=ca$,
then~$a=ca\in \scrD$,
because~$\scrD$ is a two-sided ideal of~$\scrA$.
Concerning the other direction,
note that given~$a\in \scrD$
the equality~$ac=a$ holds
when~$a$ is an effect by~\sref{projection-above-effect} (because~$a\leq c$),
and thus when~$a$ is self-adjoint too
(by scaling),
and hence for arbitrary~$a\in\scrD$
by  writing~$a\equiv \Real{a}+i\Imag{a}$
where~$\Real{a}$ and~$\Imag{a}$ are self-adjoint.

Note that this claim entails that~$\scrD \subseteq c\scrA$.
Since $\scrD$ is an ideal
we also have~$c\scrA\subseteq \scrD$,
and so~$\scrD= c\scrA$.
The claim also entails that~$c$ is central.
Indeed,
given~$a\in\scrA$
we have $ac\in \scrD$ 
(because~$\scrD$ is an ideal)
and so~$c(ac)=ac$ by the claim.
Since similarly~$(ca)c=ca$,
we get~$ac=ca$.

The only thing that remains to be shown is that~$c$
is unique.
To this end let~$c$ and~$c'$ be central projections 
with~$c\scrA = \mathscr{D}=c'\scrA$.
As~$c'\in\mathscr{D}=c \scrA$,
there is~$a\in \scrA$
with~$c' = ca$.
Then~$c' = c'(c')^* = caa^*c^*\leq 
cc^*\|aa^*\|=c\|a\|^2$,
and so~$c'\leq c$.
Since similarly $c\leq c'$, we get~$c=c'$.\qed
\end{point}
\end{point}
\begin{point}{40}[carrier-miu]{Corollary}%
The carrier $\ceil{f}$
of an nmiu-map $f\colon \scrA\to\scrB$
between von Neumann algebras
is central, so
$\ceil{f}=\cceil{f}$.
    Moreover, $\smash{\ker(f)=\cceil{f}^\perp\!\scrA}$.
\end{point}
\begin{point}{41}[nmiu-factors]{Exercise}%
Show using~\sref{carrier-miu} and~\sref{central-projections-sums}
 that an nmiu-map $f\colon \scrA\to\scrB$
factors as
\begin{equation*}
\xymatrix{
\scrA 
    \ar[rr]^f
    \ar[rd]_{g\colon a\mapsto \cceil{f}a}
	&
    &
    \scrB
    \\
&
    \cceil{f}\scrA \ar[ru]_{h\colon a\mapsto f(a)}
},
\end{equation*}
where the~$g$ an nmiu-surjection, and~$h$ is an nmiu-injection.
\begin{point}{42}[nmiu-image]
Use this, and~\sref{injective-nmiu-iso-on-image}, to show that~$f(\scrA)$
is a von Neumann subalgebra of~$\scrB$.
\end{point}
\end{point}
\begin{point}{50}[proto-gns-ceil]{Lemma}%
We have~$\cceil{\omega}=
\ceil{\varrho_\omega}$
for every np-functional $\omega\colon \scrA\to\C$
on a von Neumann algebra~$\scrA$,
where~$\varrho_\omega$
is as in~\sref{gns}.
\begin{point}{60}{Proof}%
Let~$e$ be a projection in~$\scrA$.
Note that $0=\|\varrho_\omega(e)(\eta_\omega(a))\|^2
\equiv \omega(a^*ea)$
iff~$\ceil{a^*ea}\leq \smash{\ceil{\omega}}^\perp$
iff~$\ceil{a\ceil{\omega}a^*}\leq e^\perp$
for all~$a\in\scrA$.
So since the~$\eta_\omega(a)$'s lie dense in~$\scrH_\omega$,
we have~$\varrho_\omega(e)=0$
iff $\varrho_\omega(e)(\eta_\omega(a))=0$ for all~$a\in\scrA$
iff $\bigcup_{a\in\scrA} \ceil{a\ceil{\omega}a^*}\leq e^\perp$.
Hence $\ceil{\varrho_\omega}=
\bigcup_{a\in\scrA}
\ceil{a\ceil{\omega}a^*} \equiv
\bigcup_{a\in\scrA}
\ceil{a^*\ceil{\omega}a}
=\cceil{\ceil{\omega}}
=\cceil{\omega}$
by~\sref{cceil-fundamental}.\qed
\end{point}
\end{point}
\begin{point}{70}[gns-ceil]{Proposition}%
Given a collection of np-functionals~$\Omega$
on a von Neumann algebra~$\scrA$
we have $\ceil{\varrho_\Omega}
=\bigcup_{\omega\in\Omega} \cceil{\omega}$
for~$\varrho_\Omega\colon \scrA\to\scrB(\scrH_\Omega)$
from~\sref{gns}.
\begin{point}{80}{Proof}%
Let~$e$ be a projection of~$\scrA$.
Since
$\varrho_\Omega(e)(x)
= \sum_{\omega\in\Omega} \varrho_\omega(x_\omega)$
by~\sref{gns}
for all~$x\in\scrH_\Omega\equiv\bigoplus_{\omega\in\Omega}\scrH_\omega$,
we have~$\varrho_\Omega(e)=0$
iff~$\varrho_\omega(e)=0$ for all~$\omega\in\Omega$
iff~$e\leq \smash{\ceil{\varrho_\omega}^\perp \equiv 
\smash{\cceil{\omega}}^\perp}$
iff~$e\leq \bigcap_{\omega\in\Omega}\smash{\cceil{\omega}}^\perp 
\equiv (\bigcup_{\omega\in\Omega} \cceil{\omega})^\perp$.
Hence~$\ceil{\varrho_\Omega}=\bigcup_{\omega\in\Omega}\cceil{\omega}$.\qed
\end{point}
\end{point}
\begin{point}{90}[vn-center-separating]{Corollary}%
For a collection~$\Omega$ of np-functionals
on a von Neumann algebra,
the following are equivalent.
\begin{enumerate}
\item
\label{vn-center-separating-1}
$\Omega$ is centre separating (see~\sref{separating}).
\item
\label{vn-center-separating-2}
A central projection~$z$ of~$\scrA$ is zero
when~$\omega(z)=0$ for all~$\omega\in\Omega$.
\item
\label{vn-center-separating-3}
The map $\varrho_\Omega\colon\scrA\to\scrB(\scrH_\Omega)$
from~\sref{gns} 
is injective.
\end{enumerate}
\spacingfix%
\begin{point}{100}{Proof}%
We've seen in~\sref{proto-gelfand-naimark}
that
\ref{vn-center-separating-1}$\iff$\ref{vn-center-separating-3},
and~\ref{vn-center-separating-1}$\Rightarrow$\ref{vn-center-separating-2}
is trivial,
which leaves us with 
\ref{vn-center-separating-2}$\Rightarrow$\ref{vn-center-separating-3}.
So assume that~$\forall \omega\in\Omega\,[\,\omega(z)=0\,]\implies z=0$ 
for every central projection~$z$
of~$\scrA$.
Then since~$\ceil{\varrho_\Omega}^\perp$
is a central projection
by~\sref{gns-ceil}
with
$\ceil{\varrho_\Omega}^\perp
=\smash{\bigl(\bigcup_{\omega\in\Omega} \smash{\cceil{\omega}\bigr)}}^\perp
=\bigcap_{\omega\in \Omega} \cceil{\omega}^\perp
\leq \smash{\cceil{\omega}}^\perp
\leq \smash{\ceil{\omega}}^\perp$
and thus
$\omega(\smash{\ceil{\varrho_\Omega}}^\perp)
\leq \omega(\ceil{\omega}^\perp)=0$
for all~$\omega\in\Omega$
we get~$\ceil{\varrho_\Omega}^\perp =0$,
and so~$\varrho_\Omega$ is injective
by~\sref{carrier-basic}.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{700}%
\begin{point}{10}%
With our new-found knowledge on central elements
we can complete the classification
of commutative von Neumann algebras
we started in~\sref{classification-cvn}.
\end{point}
\begin{point}{20}[central-projection-central-carrier]{Exercise}%
Show that every central projection~$c$
of a von Neumann algebra is of
the form~$c\equiv \sum_i \cceil{\omega_i}$
for some family of np-functionals $(\omega_i)_i$ on~$\scrA$.
(Hint: take
    $(\omega_i)_i$ to be a maximal set
    of np-functionals for which the $\cceil{\omega_i}$'s are orthogonal.)
\end{point}
\begin{point}{30}[cvn]{Theorem}%
\index{von Neumann algebra!commutative}
Every commutative von Neumann algebra
is nmiu-isomorphic
to a direct sum of the form  $\bigoplus_i L^\infty(X_i)$
where~$X_i$ are finite complete measure spaces.
\begin{point}{40}{Proof}%
By~\sref{central-projection-central-carrier}
we have $1\equiv \sum_i \cceil{\omega_i} $
for some np-functionals $\omega_i\colon \scrA\to\C$,
and so~$\scrA\cong \bigoplus_i \cceil{\omega_i}\!\scrA$
by~\sref{central-projections-sums}.
Since~$\scrA$ is commutative,
and so~$\cceil{\omega_i}=\ceil{\omega_i}$,
we see that restricting~$\omega_i$
gives a faithful functional on~$\cceil{\omega_i}\!\scrA$,
which is therefore by~\sref{cvn-faithful} nmiu-isomorphic to~$L^\infty(X_i)$
for some finite complete measure space~$X_i$.
From this the stated result follows.\qed
\end{point}
\end{point}
\end{parsec}

\section{Completeness}
\begin{parsec}{710}%
\begin{point}{10}%
We set to work on the ultrastrong and bounded ultraweak completeness
of von Neumann algebras (see~\sref{vn-complete}) and their precursors:
\begin{enumerate}
\item
A linear (not necessarily positive)
functional on a von Neumann algebra
is ultraweakly continuous iff it is ultrastrongly continuous
(see~\sref{luws}).
\item
A convex subset of a von Neumann algebra
is ultraweakly closed iff it is ultrastrongly closed
(see~\sref{ultraclosed}).
\item
\emph{(Kaplansky's density theorem)}\ 
The unit ball $(\scrA)_1$
of a $C^*$-subalgebra~$\scrA$
of a von Neumann algebra~$\scrB$
is ultrastrongly dense in~$(\bar{\scrA})_1$
where~$\bar{\scrA}$ is the ultrastrong (=ultraweak,
\sref{ultraclosed}) closure of~$\scrA$
(see~\sref{kaplansky}).
\item
Any von Neumann subalgebra~$\scrA$
of~$\scrB$ is ultraweakly and ultrastrongly
closed in~$\scrB$
(see~\sref{vnsac}).
\item
The von Neumann algebra~$\scrB(\scrH)$ 
of bounded operators on a Hilbert space~$\scrH$
is ultrastrongly 
(\sref{bh-us-complete})
and bounded ultraweakly complete
(\sref{bh-bounded-uw-complete}).
\end{enumerate}
\spacingfix%
\end{point}%
\end{parsec}%
\subsection{Closure of a Convex Subset}
\begin{parsec}{720}%
\begin{point}{10}%
We saw in~\sref{npuws}
that a \emph{positive} linear functional~$f$
on a von Neumann algebra 
is ultrastrongly continuous iff it is ultraweakly continuous.
In this section, we'll show that the same result holds
for an arbitrary linear functional~$f$.
Note that if~$f$ is ultraweakly continuous,
then~$f$ is automatically ultrastrongly continuous
(because ultrastrong convergence implies ultraweak convergence).
For the other direction,
we'll show that if~$f$ is ultrastrongly continuous,
then~$f$ can be written as a linear combination
$f\equiv \sum_{k=0}^3 i^k f_k$
of np-maps $f_0,\dotsc,f_3$,
and must therefore be ultraweakly continuous.
We'll need the following tool.
\end{point}
\begin{point}{20}[bstaromega]{Definition}%
Let~$\scrA$ be a von Neumann algebra.
Given an np-map $\omega\colon \scrA\to\C$,
and~$b\in \scrA$,
define~$\Define{b*\omega}\colon \scrA\to \C$%
\index{*astaromega@$a*\omega$}
	by
$(b*\omega)(a)=\omega(b^*ab)$ for all~$a\in \scrA$.
\end{point}
\begin{point}{30}[bstaromega-basic]{Exercise}%
Let~$\omega\colon \scrA\to \C$ be an np-map on a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Note that $b*\omega\colon \scrA\to\C$
is an np-map for all~$b\in \scrA$.

Show that $\left|\omega(a^*bc)\right| 
\,\leq\, \|\omega\|\,\|a\|_\omega\, \|b\|\, \|c\|_\omega$
for all~$a,b,c\in\scrA$.

Deduce that $\| b*\omega - b'*\omega\|
\,\leq\, \|\omega\| \,\|b-b'\|_\omega\, (\|b\|_\omega + \|b'\|_\omega)$
for all~$b,b'\in\scrA$.

\item
Let~$b_1,b_2,\dotsc$ be a sequence in~$\scrA$
which is Cauchy with respect to~$\|\,\cdot\,\|_\omega$.
Show that the sequence~$b_1*\omega,\,b_2*\omega,\,\dotsc$ 
is Cauchy (in the operator norm
on bounded linear functionals $\scrA\to\C$),
and converges to a bounded linear map~$f\colon \scrA\to\C$.
Show that~$f$ is an np-map.
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{40}{Exercise}%
Let~$f\colon \scrA\to \C$ be an ultrastrongly continuous linear
functional on a von Neumann algebra~$\scrA$.
Show that there are an np-map
$\omega\colon \scrA\to \C$
and $\delta>0$
with $\left|f(a)\right|\leq 1$
for all~$a\in\scrA$ with $\|a\|_\omega \leq \delta$.

(Keep this in mind when reading the following lemma.)
\end{point}
\begin{point}{50}[normal-functionals-lemma]{Lemma}%
Let~$\omega\colon \scrA\to\C$ be an np-map,
and let~$f\colon \scrA\to \C$ be a linear map.
The following are equivalent.
\begin{enumerate}
\item\label{normal-functionals-lemma-0}
$\left|f(a)\right|\leq B$ for all~$a\in \scrA$
with $\|a\|_\omega\leq \delta$, for some $\delta,B>0$;
\item\label{normal-functionals-lemma-1}
$\left|f(a)\right| \leq B \|a\|_\omega$ for all~$a\in\scrA$,
for some~$B>0$;
\item\label{normal-functionals-lemma-2}
$f(a)=[b,a]_\omega$ for all~$a\in\scrA$, 
for some~$b\in\scrH_\omega$
(where $\scrH_\omega$ is the Hilbert space completion of~$\scrA$
with respect to the inner-product
$[\,\cdot\,,\,\cdot\,]_\omega$).
\item\label{normal-functionals-lemma-3}
$f\equiv f_0+if_1-f_2-if_3$
where $f_0,\dotsc,f_3\colon \scrA\to \C$
are np-maps for which there is~$B>0$
such that~$f_k(a)\leq B \omega(a)$ for all~$a\in\pos{\scrA}$ 
and~$k$. 
\end{enumerate}%
\spacingfix%
\begin{point}{60}{Proof}%
We make a circle.
\begin{point}{70}{%
\ref{normal-functionals-lemma-3}$\Longrightarrow$%
\ref{normal-functionals-lemma-0}}%
For $a\in \scrA$ and~$k$, we have
$\left|f_k(a)\right|^2 \leq
f_k(1)\,f_k(a^*a) \leq f_k(1)B \,\omega(a^*a)$,
giving~$\left|f_k(a)\right| \leq (f_k(1)B)^{\nicefrac{1}{2}} \|a\|_\omega$,
and so~$\left|f(a)\right|\leq \tilde{B} \|a\|_\omega$,
where 
\begin{equation*}
	\textstyle
	\tilde{B} \,=\, B^{\nicefrac{1}{2}}\sum_{k=0}^3f_k(1)^{\nicefrac{1}{2}}.
\end{equation*}
Hence~$\left|f(a)\right|\leq \tilde{B}$
for all~$a\in\scrA$ with $\|a\|_\omega\leq 1$.
\end{point}
\begin{point}{80}{\ref{normal-functionals-lemma-0}$\Longrightarrow$%
\ref{normal-functionals-lemma-1}}%
Let~$a\in\scrA$, and~$\varepsilon>0$ be given.
Then for~$\tilde{a}:=\delta(\varepsilon+\|a\|_\omega)^{-1}\,a$,
we have $\|\tilde{a}\|_\omega\leq \delta$,
and so~$\left|f(\tilde{a})\right|
\equiv \delta(\varepsilon +\|a\|_\omega)^{-1} \,\left|f(a)\right|
\leq B$,
which entails $\left|f(a)\right|\leq 
B\delta^{-1}(\varepsilon+\|a\|_\omega)$.
Since~$\varepsilon>0$ was arbitrary, we get~$\left|f(a)\right|\leq
B\delta^{-1}\|a\|_\omega$.
\end{point}
\begin{point}{90}{%
\ref{normal-functionals-lemma-1}$\Longrightarrow$%
\ref{normal-functionals-lemma-2}}%
Since~$\left|f(a)\right|\leq B\|a\|_\omega$ for all~$a\in\scrA$,
the map~$f$ can be extended to a bounded linear map 
$\tilde{f}\colon \scrH_\omega\to \C$.
Then by Riesz' representation theorem, \sref{riesz-representation-theorem},
there is~$b\in \scrH_\omega$ with $\tilde{f}(x)=[b,x]_\omega$
for all~$x\in \scrH_\omega$.  
In particular,
$f(a)=[b,a]_\omega$ for all~$a\in \scrA$.
\end{point}
\begin{point}{100}{\ref{normal-functionals-lemma-2}$\Longrightarrow$%
\ref{normal-functionals-lemma-3}}%
We know that~$f(a)\equiv [b,a]_\omega$ for all~$a\in \scrA$,
for some~$b\in\scrH_\omega$.
Then, by definition of~$\scrH_\omega$,
there is a sequence~$b_1,b_2,\dotsc$ in~$\scrA$
which converges to~$b$ in~$\scrH_\omega$.
Then the maps $[b_n,\,\cdot\,]_\omega\colon \scrA\to \C$
approximate~$f=[b,\,\cdot\,]_\omega$
in the sense that 
$\left|f(a)-[b_n,a]_\omega\right|=\left|[b-b_n,a]_\omega\right|
\leq \|b-b_n\|_\omega \|a\|_\omega
	\leq \|b-b_n\|_\omega \|\omega\|^{\nicefrac{1}{2}} \|a\|$
for all~$a\in \scrA$.
In particular, $[b_1,\,\cdot\,]_\omega,\,[b_2,\,\cdot\,]_\omega,\,\dotsc$
converges to~$f$ (in the operator norm).
By ``polarisation'' (c.f.~\sref{mult-polarization}),
we have $[b_n,a]_\omega = \frac{1}{4}\sum_{k=0}^3 i^kf_{k,n}(a)$,
where $f_{k,n} := (i^kb_n+1)*\omega$ is an np-map.
Since~$(i^kb_n+1)_n$ is Cauchy with respect to~$\|\,\cdot\,\|_\omega$,
we see by~\sref{bstaromega-basic} that 
$(f_{k,n})_n$ converges to an np-map $f_k\colon \scrA\to\C$
(with respect to the operator norm).
It follows that~$f=\frac{1}{4}\sum_{k=0}^3 i^k f_k$.

It remains to be shown that there is~$B>0$ with $f_k(a)\leq B\omega(a)$
for all~$k$ and~$a\in\pos{\scrA}$.
Note that since $f_{k,n}(a) \leq \|i^kb_n+1\|_\omega \,\omega(a)
\leq (\|b_n\|_\omega+1) \,\omega(a)$,
for all~$n$, $k$, and~$a\in\pos{\scrA}$,
the number $B:=\lim_n \|b_n\|_\omega +1 $ will do.\qed
\end{point}
\end{point}
\end{point}
\begin{point}{110}[luws]{Corollary}%
For a linear map~$f\colon \scrA\to \C$
on a von Neumann algebra~$\scrA$ the following are equivalent.
\begin{enumerate}
\item
$f$ is ultrastrongly continuous;
\item
$f$ is ultraweakly continuous;
\item
$f\equiv f_0+if_1-f_2-if_3$
for some~np-maps $f_0,\dotsc,f_3\colon \scrA\to\C$;
\item
``$f$ is bounded on some $\|\,\cdot\,\|_\omega$-ball,''
that is,
\begin{equation*}
	\sup\{\ \left|f(a)\right|\colon a\in \scrA\colon 
		\|a\|_\omega\leq \delta\ \}\ <\ \infty
\end{equation*}
for some $\delta>0$ and  np-map $\omega\colon \scrA\to\C$;
\item
$\left|f(a)\right|\leq \|a\|_\omega$
for all~$a\in \scrA$, for some np-map $\omega\colon \scrA\to\C$.
\end{enumerate}
\spacingfix%
\end{point}%
\end{parsec}%
%
%	ultrastrong and ultraweak closure of a convex subset
%
\begin{parsec}{730}%
\begin{point}{10}%
We'll show that the ultrastrong and ultraweak closure
of a convex set agree. 
For this we need the following proto-Hahn--Banach separation theorem,
which concerns the following notion of openness.
\end{point}
\begin{point}{20}{Definition}%
A subset~$A$ of a real vector space~$V$ 
is called \Define{radially open}%
\index{radially open set}
if for all~$a\in A$ and~$v\in V$
there is $t\in (0,\infty)$
with $a+sv\in A$ for all~$s\in [0,t)$.
\end{point}
\begin{point}{30}{Exercise}%
Let~$V$ be a vector space.
\begin{enumerate}
\item
Show that the radially open subsets of~$V$ form a topology.
\item
Show that with respect to this topology,
scalar multiplication and translations $x\mapsto x+a$
by a fixed vector~$a\in V$ are continuous.
\item
Show that 
the subset of~$\R^2$ depicted below in blue
\begin{center}
\begin{tikzpicture}
    \fill[style={fill=lightblue,draw=darkblue,densely dotted,thick}, even odd rule]
    (-3.5cm,-2.0cm) rectangle (3.5cm,2.0cm)
    (-1.5cm,0) circle (1.5cm)
    (1.5cm,0) circle (1.5cm)
    (-1cm,0) circle (1cm)
    (1cm,0) circle (1cm)
    (0,0) node[circle,inner sep=0pt,minimum size=3pt,fill=darkblue]{};
\end{tikzpicture},
\end{center}
including the point in the middle
but not the dashed borders,
is radially open, but not open in the usual topology on~$\R^2$.
\item
Show that addition on~$\R^2$ is not jointly radially continuous.
\item
	Show that nevertheless $\{s\in \R \colon sx+(1-s) y\in A\}$
is open for every radially open~$A\subseteq V$, and $x,y\in V$.
\item
Show that $A+B$ is radially open when~$A,B\subseteq V$ are radially open.

Show that $\{\lambda a\colon a\in A,\lambda>0\}$ is radially open
when~$A$ is radially open.
\end{enumerate}%
\spacingfix%
\end{point}%
\begin{point}{40}[hahn-banach]{Theorem}%
\index{Hahn--Banach's Theorem}
For every radially open
convex subset~$K$ of a real vector space~$V$
with~$0\notin K$
there is a linear map $f\colon V\to\R$
with $f(x)>0$ for all~$x\in K$.
\begin{point}{50}{Proof}%
(Based on Theorem~1.1.2 of~\cite{kr}.)

By Zorn's Lemma we may assume without loss of generality that~$K$ is maximal
among radially open convex subsets of~$V$ that do not contain~$0$.

We also assume that~$K$ is non-empty,
because if~$K=\varnothing$, the result is trivial.

We will show in a moment that~$H:=\{x\in V\colon -x,x\notin K\}$
is a linear subspace and~$V/H$ is one-dimensional.
From this we see that there is a linear map $f\colon V\to\R$
with~$\ker(f)=H$.
Since~$f(K)$ is a convex subset which does not contain~$0$
(because $H\cap K=\varnothing$)
we either have $f(K)\subseteq (0,\infty)$
or $f(K)\subseteq(-\infty,0)$.
Thus, by replacing $f$ by $-f$ if necessary,
we see that there is a linear map $f\colon V\to \R$
with $f(x)>0$ for all~$x\in K$.
\begin{point}{60}{$H$ is a linear subspace}%
Note that~$x\in K,\,\lambda>0\implies \lambda x\in K$,
because the subset 
$\{\lambda x\colon x\in K,\lambda\in(0,\infty)\}\supseteq K$
is radially open, convex, doesn't contain~$0$,
and is thus~$K$ itself.
Furthermore,
$x,y\in K\implies x+y\in K$, because
$x+y=2(\frac{1}{2}x + \frac{1}{2}y)$, and~$K$ is convex.

Let~$\overline{K}$ be the set of all~$x\in V$
with $x+y\in K$ for all~$y\in K$.
Then it is not difficult to check that~$\overline{K}$ is a cone:
 $0\in\overline{K}$,
and
$x\in \overline{K},\lambda\geq 0\implies \lambda x\in \overline{K}$, and
$x,y\in\overline{K}\implies x+y\in \overline{K}$.

We claim that~$x\in \overline{K}$ iff $-x\notin K$.
Indeed, if~$x\in\overline{K}$, then $-x\notin K$, because otherwise
$-x\in K$ and so
$0=x+(-x)\in K$, which is absurd.
For the other direction, suppose that $-x\notin K$.
Then $x+y\in K$ for all~$y\in K$,
because
$\{\lambda x+y\colon y\in K,\lambda\geq0\}\supseteq K$
is radially open, convex, doesn't contain~$0$,
and is thus~$K$.

It follows that~$H=\overline{K}\cap -\overline{K}$.
Since~$\overline{K}$ is a cone, $-\overline{K}$ is a cone,
and thus~$H$ is a cone.  But then~$-H=H$ is a cone too,
and thus~$H$ is a linear subspace.
\end{point}
\begin{point}{70}{$V/H$ is one-dimensional}%
Note that~$H\neq V$, because~$K\cap H=\varnothing$
and~$K$ is (assumed to be) non-empty.
So to show that~$V/H$ is one-dimensional,
it suffices to show that
any~$x,y\in V$ 
 are linearly dependent in~$V/H$.
We may assume that~$x\in K$ and~$y\in -K$.
It suffices to find~$s\in [0,1]$ with $0=sx+s^\perp y$.
The trick is to consider the sets
 $S_0 = \{s\in [0,1]\colon sx+s^\perp y \in -K\}$
and~$S_1 = \{s\in [0,1]\colon sx+s^\perp y \in K\}$,
which are open (because~$K$ and~$-K$ are radially open),
non-empty (because $0\in S_0$ and~$1\in S_1$),
and therefore cannot cover~$[0,1]$
(because~$[0,1]$ is connected).
So there must be~$s\in (0,1)$ 
such that
$sx+s^\perp y $ 
is neither in~$K$
nor in~$-K$,
and thus $sx+s^\perp y \in H$ (by definition of~$H$).
Whence~$x$ and~$y$ are linearly dependent in~$V/H$
(since~$s\neq 0$).\qed
\end{point}
\end{point}
\end{point}
\begin{point}{80}[ultraclosed]{Exercise}%
\index{ultraweak and ultrastrong!convex $\sim$ly closed subset}
We will use~\sref{hahn-banach}
to prove that 
an ultrastrongly closed convex subset~$K$ of a 
von Neumann algebra~$\scrA$
is ultraweakly closed as well.

Let us first simplify the problem a bit.
If~$K$ is empty, the result is trivial,
so we may as well assume that $K\neq \varnothing$.
Note that we must show that no net in~$K$ converges ultraweakly
to any element~$a_0\in\scrA$ outside~$K$,
but by considering~$K-a_0$ instead of~$K$,
we see that it suffices to show that
no net in~$K$ converges ultraweakly to~$0$
under the assumption that~$0\notin K$.
To this end we'll find an ultraweakly continuous linear map
$g\colon \scrA\to \C$ and~$\delta>0$ 
with~$\Real{g(k)}\geq \delta$ for all~$k\in K$---if
a net $(k_\alpha)_\alpha$ in~$K$ were to converge ultraweakly to~$0$,
then~$\Real{g(k_\alpha)}$ would converge to~$0$ as well,
which is impossible.
\begin{enumerate}
\item
	Show that 
	there is an np-map~$\omega \colon\scrA\to\C$
	and~$\varepsilon>0$ 
	with $\|k\|_\omega \geq \varepsilon$ for all~$k\in K$.
	(Hint: use that~$K$ is ultrastrongly closed).
\item
	Show that~$B:= \{ b\in \scrA\colon \|b\|_\omega < \varepsilon\}$
	 is convex, radially open, $B\cap K=\varnothing$.

	Show that $B-K$ is convex, radially open, and $0\notin B-K$.
\item
	Use~\sref{hahn-banach} to show that
	 there is an $\R$-linear map $f\colon \scrA\to \R$
	with $f(b)<f(k)$ for all~$b\in B$ and~$k\in K$.
	Show that~$f$
	can be extended to a $\C$-linear map
	$g \colon \scrA\to \C$
	by $g(a)= f(a)-if(ia)$ for all~$a\in\scrA$.
\item
	Show that $\left| f(b)\right| \leq f(k)$ 
	and $\left|g(b)\right|\leq 2f(k)$
	for all~$b\in B$ and $k\in K$.\\
	(Hint: $b\in B\implies -b\in B$.)

	Conclude that~$g$ is ultraweakly continuous
	(using~\sref{luws} and $K\neq \varnothing$).
\item
	It remains to be shown that
	there is $\delta>0$ with $f(k)\equiv \Real{g(k)}\geq \delta$
	for all~$k\in K$.
	Show that in fact there is $b_0\in B$
	with $f(b_0) >0$,
	and  that $f(k)\geq f(b_0)>0 $ for all~$k\in K$.
\end{enumerate}
\spacingfix
\end{point}%
\end{parsec}%
\subsection{Kaplansky's Density Theorem}
\begin{parsec}{740}%
\begin{point}{10}[proto-kaplansky]{Proposition}%
Let~$\scrA$ be a von Neumann algebra,
and let~$f\colon \R\to\R$ be a continuous map 
with $f(t)=O(t)$,
that is,
there are~$n\in \N$ and~$b\in [0,\infty)$
such that $\left|f(t)\right|\leq b\left|t\right|$
for all~$t\in \R$ with~$\left|t\right| \geq n$.

Then the map~$a\mapsto f(a),\,\sa{\scrA}\to\sa{\scrA}$,
see~\sref{functional-calculus},
is ultrastrongly continuous.
\begin{point}{20}{Proof}%
(An adaptation of Lemma~44.2 from~\cite{conway2000}.)

Let~$S$ denote the set of all continuous $g\colon \R\to\R$
such that $a\mapsto g(a),\,\sa{\scrA}\to\sa{\scrA}$
is ultrastrongly continuous.
We must show that~$f\in S$.

Let us first make some general observations.
The identity map $t\mapsto t$ is in~$S$,
any constant function is in~$S$,
and~$S$ is closed under addition,
and scalar multiplication.
In particular, any affine transformation ($t\mapsto at+b$)
is in~$S$.
Moreover, we have~$g\circ h\in S$ when $g,h\in S$,
and also~$gh\in S$
provided that~$g$ is bounded.
Finally, $S$ is closed with respect to uniform convergence.

Now,
as $f(t)=f(t)\,\smash{\frac{1}{1+t^2}\,+\, f(t)\,\frac{t^2}{1+t^2}}$
 one can see from the remarks above
that it suffices
to show
that~$t\mapsto f(t)\,\smash{\frac{1}{1+t^2}}$ is in~$S$
--- here we use that $t\mapsto f(t) \,\smash{\frac{t}{1+t^2}}$ is bounded.
In other words,
we may assume without loss of generality,
that~$f$ vanishes at infinity, i.e.~$\lim_{t\to \infty}f(t)=0$.

Suppose for the moment
that there is $e\in S$, $e\neq 0$,
which vanishes at infinity.
Let~$a,b\in \R$.
Then $e_{a,b}\colon \R\to\R, t\mapsto e(at+b)$
--- an affine transformation followed by~$e$ ---
is also in~$S$,
vanishes at infinity,
and can be extended to a continuous real-valued
function on the one-point compactification $\R\cup \{ \infty\}$
of~$\R$
(by defining $e_{a,b}(\infty)=0$).
It is easy to see that the $C^*$-subalgebra
of~$C(\R\cup\{\infty\})$
generated by these extended~$e_{a,b}$'s 
separates the points of~$\R\cup\{\infty\}$,
and is thus~$C(\R\cup\{\infty\})$ itself
    by the Stone--Weierstra\ss{} theorem (see~\sref{stone-weierstrass}).
Since~$f$ vanishes at infinity,
$f$ can be extended to an element of $C(\R\cup\{\infty\})$,
 and can thus be obtained
(by taking real parts if necessary)
from the extended $e_{a,b}$'s and real constants 
via uniform limits, addition and (real scalar)
multiplication. 
Since~$S$ contains the $e_{a,b}$'s and constants
and is closed under these operations (acting on bounded functions),
we see that~$f\in S$.

To complete the proof,
we show that such~$e$ indeed exists.
Let $e,s\colon \R\to\R$ 
be given by $e(t)=ts(t)$ and $s(t)=\smash{\frac{1}{1+t^2}}$.
Clearly~$e$ and~$s$
are continuous
and
vanish at infinity.
To see that~$e$ is ultrastrongly continuous,
let $(b_\alpha)_\alpha$ be a net of self-adjoint elements of~$\scrA$
which converges ultrastrongly to $a\in\sa{\scrA}$,
and let~$\omega\colon \scrA\to \C$
be an npu-map. 
Unfolding the definitions
of~$e$ and~$s$ yields
the following equality.
\begin{equation*}
e(b_\alpha)-e(a) \ =\ s(b_\alpha)\,(b_\alpha-a)\,s(a)
\,-\, e(b_\alpha)\,(b_\alpha-a)\,e(a).
\end{equation*}
Since $\|s(b_\alpha)\|\leq 1$,
we have $\|s(b_\alpha)(b_\alpha-a)s(a)\|_\omega 
\leq  \,\|(b_\alpha-a)s(a)\|_\omega
\equiv \|b_\alpha-a\|_{s(a)*\omega}$.
Similarly, since~$\|e(b_\alpha)\|\leq 1$,
we get
\begin{alignat*}{3}
\|e(b_\alpha)-e(a)\|_\omega
\ \leq\ \|b_\alpha-a\|_{s(a)*\omega}\,+\,\|b_\alpha-a\|_{e(a)*\omega}.
\end{alignat*}
Thus~$e(b_\alpha)$ converges ultrastrongly to~$e(a)$,
and so~$e$ is ultrastrongly continuous.\qed
\end{point}
\end{point}

\begin{point}{30}[abs-us-cont]{Corollary}%
Given a von Neumann algebra~$\scrA$
the map $a\mapsto\left|a\right|\colon\,\Real{\scrA}\to\Real{\scrA}$
is ultrastrongly continuous.
\end{point}
\begin{point}{40}[kaplansky]{Kaplansky's Density Theorem}%
\index{Kaplansky's Density Theorem}
Let~$b$ be an element of a von Neumann algebra~$\scrB$
which is the ultrastrong limit of a net
of elements
from a $C^*$-subalgebra $\scrA$ of~$\scrB$.
Then
$b$ is the ultrastrong limit of a net~$(a_\alpha)_\alpha$
in~$\scrA$ with~$\|a_\alpha\|\leq\|b\|$ for all~$\alpha$.
Moreover,
\begin{enumerate}
\item
if~$b$ is self-adjoint,
then the~$a_\alpha$ can be chosen to be self-adjoint as well;
\item
if~$b$ is positive,
then the~$a_\alpha$ can be chosen to be positive as well, and
\item
if~$b$ is an effect,
then the~$a_\alpha$ can be chosen to be effects as well.
\end{enumerate}
\spacingfix%
\begin{point}{50}{Proof}%
Let~$(a_\alpha)_\alpha$
be a net in~$\scrA$ that converges ultrastrongly
to~$b$.

Assume for the moment that~$b$ is self-adjoint.
Then~$\Real{(a_\alpha)}$
converges ultraweakly (but perhaps not ultrastrongly)
to~$\Real{b}=b$
as~$\alpha\to\infty$,
and so~$b$ is in the ultraweak
closure of the convex set~$\Real{\scrA}$.
Since the ultraweak and ultrastrong closure
of convex subsets of~$\scrA$
coincide (by~\sref{ultraclosed}),
we see that~$b$ is also the ultrastrong limit
of some net $(a_\alpha')_\alpha$ in~$\Real{\scrA}$.
Since the map~$-\|b\|\vee(\,\cdot\,)\wedge \|b\|\colon
\Real{\scrB}\to\Real{\scrB}$
is ultrastrongly continuous by~\sref{proto-kaplansky}
we see that 
$a_\alpha'' := -\|b\|\vee a_\alpha'\wedge \|b\|$
gives a net $(a_\alpha'')_\alpha$
in~$[-\|b\|,\|b\|]_\scrA$
that
converges ultrastrongly
to~$b$.

If we assume in addition
that~$b$ is positive,
then~$a_\alpha''' := (a_\alpha'')_+$
gives a net~$(a_\alpha''')_\alpha$
in~$[0,\|b\|]_\scrA$
that converges ultrastrongly to $b_+=b$,
because the map $(\,\cdot\,)_+\colon \Real{\scrB}\to\Real{\scrB}$
is ultrastrongly continuous by~\sref{proto-kaplansky}.
Note that if~$b$ is an effect,
then so are the $a_\alpha'''$.

This takes care of all the special cases.
The general case
in which~$b$ is an arbitrary element of~$\scrB$ requires a trick:
since the element
$B:=\smash{\left(\begin{smallmatrix} 0 & b \\
b^* & 0 \end{smallmatrix}\right)}$
of the von Neumann algebra~$M_2(\scrB)$
is self-adjoint,
and the ultrastrong limit
of the net
$\smash{\bigl(\begin{smallmatrix} 0 & a_\alpha \\
a_\alpha^* & 0 \end{smallmatrix}\bigr)}$
from the  $C^*$-subalgebra $M_2(\scrA)$ of~$M_2(\scrB)$,
there is, as we've just seen, a net~$(A_\alpha)_\alpha$
in~$M_2(\scrA)$
that converges ultrastrongly to~$B$
with~$\|A_\alpha\|\leq \|B\|\equiv \|b\|$ for all~$\alpha$.
Since the upper-right entries
$ (A_\alpha)_{12}$ will then converge ultrastrongly 
to~$B_{12}\equiv b$ as~$\alpha\to\infty$,
and~$\|(A_\alpha)_{12}\|\leq \|A_\alpha\|\leq \|b\|$
for all~$\alpha$, we are done.\qed
\end{point}
\end{point}
\begin{point}{60}[dense-subalgebra]{Corollary}%
Given~$\varepsilon>0$  and an ultraweakly dense $*$-subalgebra~$\scrS$
of a von Neumann algebra~$\scrA$
each element~$a$ of~$\scrA$
is the ultrastrong limit of a net~$(s_\alpha)_\alpha$
from~$\scrS$
with $\|s_\alpha\|\leq \|a\|(1+\varepsilon)$
for all~$\alpha$.
\begin{point}{70}{Proof}%
As the norm closure~$\scrC$ of~$\scrS$ in~$\scrA$
is an ultraweakly
(and thus by~\sref{ultraclosed}
ultrastrongly) dense $C^*$-subalgebra of~$\scrA$,
the element $a$ of~$\scrA$ is by~\sref{kaplansky}
the ultrastrong limit
of net~$(c_\alpha)_{\alpha\in D}$
in~$\scrC$ 
with $\|c_\alpha\|\leq \|a\|$ for all~$\alpha$.
Each element~$c_\alpha$ 
is in its turn 
the norm (and thus ultrastrong)
limit of a sequence~$s_{\alpha1},\,s_{\alpha2},\,\dotsc$
in~$\scrS$,
and if we choose the~$s_{\alpha n}$
such that $\|c_\alpha - s_{\alpha n}\|\leq 2^{-n}$,
then~$s_{\alpha n}$
converge ultrastrongly to~$b$
as~$D\times \N\ni (\alpha,n)\to\infty$.
Finally, since~$\lim_n\|s_{\alpha n}\| = \|c_\alpha \|\leq \|c\| 
\leq (1+\varepsilon)\|c\|$
we have~$\|s_{\alpha n}\|\leq (1+\varepsilon)\|c\|$
for sufficiently large~$n$,
and thus for all~$n$
if we replace~$(s_{\alpha n})_n$ by the appropriate  subsequence.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Closedness of Subalgebras}
\begin{parsec}{750}%
\begin{point}{10}%
Recall that according to our definition (\sref{von-neumann-examples})
a von Neumann subalgebra~$\scrB$ 
of a von Neumann algebra~$\scrA$
is a $C^*$-subalgebra of~$\scrA$
which is closed under suprema
of bounded directed sets of self-adjoint elements.
We will show that such~$\scrB$ is ultrastrongly closed in~$\scrA$.
\end{point}
\begin{point}{20}[sequence-separation-lemma]{Lemma}%
Let~$\scrB$ be a von Neumann subalgebra
of a von Neumann algebra~$\scrA$.
Let~$\omega_0,\omega_1\colon \scrA\to\C$
be npu-maps,
which are separated
by a net $(b_\alpha)_\alpha$
of effects of~$\scrB$ 
in the sense that~$\lim_\alpha \omega_0(b_\alpha)=0$
and $\lim_\alpha \omega_1(b_\alpha^\perp)=0$.
Then~$\omega_0$ and~$\omega_1$ are separated by a 
projection~$q$ of~$\scrB$ 
in the sense that~$\omega_0(q)= 0 = \omega_1(q^\perp)$.
\begin{point}{30}{Proof}%
(Based on Lemma~45.3 and Theorem~45.6 of~\cite{conway2000}.)

Note that it suffices to find an effect~$a$ in~$\scrB$
with $\omega_0(a) = 0 = \omega_1(a^\perp)$,
because then~$\omega_0(\ceil{a}) = 0 = \omega_1(\ceil{a}^\perp)$
by~\sref{ceil-functionals-lemma}
and~$\ceil{a}\in\scrB$.

Note that we can find a subsequence~$(b_n)_n$ of~$(b_\alpha)_\alpha$
such that $\omega_0( b_n ) 
	\leq n^{-1}2^{-n}$
and $\omega_1(b_n^\perp)\leq n^{-1}$
for all~$n$.
For~$n < m$, define
\begin{equation*}
\textstyle
a_{nm}\ = \ (1+\sum_{k=n}^m kb_k)^{-1} \,\sum_{k=n}^m kb_k.
\end{equation*}
Since we have seen in~\sref{astara-pos-basic-consequences}
that the map~$d\mapsto (1+d)^{-1}d$ is order preserving
(on~$\pos{\scrB}$),
we have $0\leq a_{nm}\leq \frac{1}{2}$
and we get the formation
\begin{equation*}
\renewcommand{\labelstyle}{\textstyle}
\xymatrix{
a_{12}\ar@{}|-{\leq}[r] & 
a_{13}\ar@{}|-{\leq}[r] & 
a_{14}\ar@{}|-{\leq}[r]  & 
\dotsb & \ar@{}|-{\leq}[r]& a_1 \\
&
a_{23} \ar@{}|-{\leq}[r] \ar@{}[u]|-{\uleq} &
a_{24} \ar@{}|-{\leq}[r]  \ar@{}[u]|-{\uleq} &
\dotsb &\ar@{}|-{\leq}[r]& a_2  \ar@{}[u]|-{\uleq} \\
&
&
a_{34} \ar@{}|-{\leq}[r]  \ar@{}[u]|-{\uleq} & 
\dotsb & \ar@{}|-{\leq}[r] & a_3  \ar@{}[u]|-{\uleq} 
\\
&&&\ddots&&\vdots \ar@{}[u]|-{\uleq}& \\
&&&&&a\ar@{}[u]|-{\uleq}
},
\end{equation*}
where~$a_n:= \bigvee_{m\geq n} a_{nm}$
and~$a := \bigwedge_n a_n$.
We'll prove that~$\omega_0(a)=0=\omega_1(a^\perp)$.
\begin{point}{40}{$\omega_0(a)=0$}%
	Since~$\omega_0(b_n)\leq n^{-1}2^{-n}$ 
and $a_{nm}\leq \sum_{k=n}^m k b_k$,
we get~$\omega_0(a_{nm})\leq \sum_{k=n}^m k\omega_0(b_k) \leq 2^{1-n}$,
and so $\omega_0(a)=\bigwedge_n\bigvee_{m\geq n} \omega_0(a_{nm})
\leq \bigwedge_n 2^{1-n} = 0$.
\end{point}
\begin{point}{50}{$\omega_1(a^\perp )=0$}%
Let~$m> n$ be given.
Since~$\sum_{k=n}^m kb_k \geq mb_m$
and $d\mapsto (1+d)^{-1}d$
is monotone on~$\pos{\scrB}$
we get~$a_{nm} \geq (1+mb_m)^{-1} mb_m$,
and so~$a_{nm}^\perp \leq (1+mb_m)^{-1}$.

Observe that for a real number $t\in[0,1]$,
we have $tt^\perp \geq 0$,
and so $(1+mt)(1+mt^\perp) = 1+m+m^2tt^\perp \geq 1+m$.
This yields the inequality $(1+mt)^{-1}\leq (1+m)^{-1}(1+mt^\perp)$
for real numbers~$t\in[0,1]$.
The corresponding inequality for effects of a $C^*$-algebra
(obtained via Gelfand's representation theorem, \sref{gelfand})
gives us $\omega_1(a_{nm}^\perp)\leq \omega_1((1+mb_m)^{-1})
\leq (1+m)^{-1}(1+m\omega_1(b_m^\perp))\leq \frac{2}{1+m}$,
where we have used that~$\omega_1(b_m^\perp)\leq \frac{1}{m}$.
Hence~$\omega_1(a_n^\perp)=\bigwedge_{m\geq n} \omega_1(a_{nm}^\perp)
\leq \bigwedge_{m\geq n} \frac{2}{1+m}=0$ for all~$n$,
and so~$\omega_1(a^\perp)=\bigvee_n\omega_1(a_n^\perp)=0$.\qed
\end{point}
\end{point}
\end{point}
\begin{point}{60}[kadisons-lemma]{Lemma}%
Let~$\scrB$ be a von Neumann subalgebra
of a von Neumann algebra~$\scrA$.
Let~$p$ be a projection of~$\scrA$,
which is the ultrastrong limit of a net in~$\scrB$.

For all npu-maps $\omega_0,\omega_1\colon \scrA\to\C$
with~$\omega_0(p)=0= \omega_1(p^\perp)$
there is a projection~$q$ of~$\scrB$
with~$\omega_0(q)=0=\omega_1(q^\perp)$.
\begin{point}{70}{Proof}%
Let~$(b_\alpha)_\alpha$ be a net in~$\scrB$
which converges ultrastrongly to~$p$.
We may assume that all~$b_\alpha$
are effects
by Kaplansky's density theorem (\sref{kaplansky}).
% Since~$pp^\perp=0=p^\perp p$
%and multiplication by a fixed element is ultrastrongly 
%continuous (\sref{mult-us-cont}),
%we see that $(b_\alpha p^\perp)_\alpha$ and $(b_\alpha^\perp p)_\alpha$
%converge ultrastrongly to~$0$.
Note that~$(\omega_0(b_\alpha))_\alpha$ converges to~$\omega_0(p)\equiv 0$,
and $(\omega_1(b^\perp_\alpha))_\alpha$ converges 
to~$\omega_1(p^\perp)\equiv 0$.
Now apply~\sref{sequence-separation-lemma}.\qed
\end{point}
\end{point}
\begin{point}{80}[vnsac]{Theorem}%
\index{von Neumann subalgebra!is ultraweakly closed}
A von Neumann subalgebra~$\scrB$ of a von Neumann algebra~$\scrA$
is ultrastrongly and ultraweakly closed.
\begin{point}{90}{Proof}%
It suffices to show that~$\scrB$ is ultrastrongly closed,
because then, by~\sref{ultraclosed}, $\scrB$ will be ultraweakly closed
as well.

Let~$p$ be a projection of~$\scrA$ which is the ultrastrong limit
of a net from~$\scrB$. It suffices to show that~$p\in\scrB$,
because the ultrastrong closure of~$\scrB$
being a von Neumann subalgebra of~$\scrA$
is generated by its projections, see~\sref{projections-norm-dense}.
Note that given an np-map $\omega\colon \scrA\to\C$,
the carrier~$\ceil{\omega}$ of~$\omega$
need not be equal to the carrier
of~$\omega$ restricted to~$\scrB$,
which we'll therefore denote by~$\ceil{\omega}_\scrB$;
but we do have $\ceil{\omega}\leq \ceil{\omega}_\scrB$.
Then by~\sref{ultracyclic-basic}
\begin{equation}
\label{ultracyclic-proof}
\textstyle
\bigvee_{\omega_1}
\ceil{\omega_1}_\scrB \ \geq\ 
\bigvee_{\omega_1}
\ceil{\omega_1}\ =\ p\ =\ 
\bigwedge_{\omega_0} \ceil{\omega_0}^\perp
\ \geq\ \bigwedge_{\omega_0} \ceil{\omega_0}_{\scrB}^\perp,
\end{equation}
where~$\omega_0$ ranges over np-maps $\omega_0\colon \scrA\to\C$
with~$\omega_0(p)=0$,
 and $\omega_1$ ranges over
np-maps $\omega_1\colon \scrA\to\C$ with~$\omega_1(p^\perp)=0$.
Since for such~$\omega_0$ and~$\omega_1$
there is 
by~\sref{kadisons-lemma}
a projection~$q$ in~$\scrB$
with $\omega_0(q)=0=\omega_1(q^\perp)$,
we get 
$\ceil{\omega_1}_\scrB \leq q \leq 
\ceil{\omega_0}_\scrB^\perp$,
and so~$\bigvee_{\omega_1} \ceil{\omega_1}_\scrB
\leq 
\bigwedge_{\omega_0} \ceil{\omega_0}_\scrB^\perp$.
It follows that the inequalities in~\eqref{ultracyclic-proof}
are in fact equalities,
and so~$p=\bigvee_{\omega_1}\ceil{\omega_1}_\scrB \in \scrB$.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Completeness}
\begin{parsec}{760}%
\begin{point}{10}[bh-us-complete]{Proposition}%
The von Neumann algebra~$\scrB(\scrH)$
of bounded operators on a Hilbert space~$\scrH$
is ultrastrongly complete.
\begin{point}{20}{Proof}
Let~$(T_\alpha)_\alpha$ be an ultrastrongly Cauchy net
in~$\scrB(\scrH)$
(which must be shown to converge ultrastrongly to
some operator~$T$ in~$\scrB(\scrH)$).

Note that given~$x\in \scrH$,
the net~$(T_\alpha x)_\alpha$ in~$\scrH$
is norm Cauchy,
because $\|(T_\alpha-T_\beta) x\|
= \| T_\alpha-T_\beta \|_{\left<x,(\,\cdot\,)x\right>}$
vanishes for sufficiently large~$\alpha,\beta$,
and so we may define~$Tx :=\lim_\alpha T_\alpha x$,
giving a map~$T\colon \scrH\to\scrH$.

It is clear that~$T$ will be linear,
but the question is whether~$T$ is bounded,
and whether in that 
case~$(T_\alpha)_\alpha$ converges ultrastrongly to~$T$.

Suppose towards a contradiction that~$T$ is not bounded.
Then we can find~$x_1,x_2,\dotsc\in\scrH$
with $\|x_n\|^2\leq 2^{-n}$
and $\|Tx_n\|^2\geq 1$ for all~$n$.
Since~$\omega:=\sum_n \left<x_n,(\,\cdot\,)x_n\right>\colon 
\scrB(\scrH)\to\C$
is an np-map by~\sref{bh-functional-lemma}, 
it follows that~$\|T_\alpha\|_\omega^2\equiv \sum_{n=1}^\infty 
\|T_\alpha x_n\|^2$
converges to some positive number~$R$.
Since any partial sum $\sum_{n=1}^N \|T_\alpha x_n\|^2
\leq \|T_\alpha\|_\omega^2$
converges to~$\sum_{n=1}^N \|T x_n\|^2\geq N$,
we must conclude that~$R\geq N$,
for all natural numbers~$N$,
which is absurd.
Hence~$T$ is bounded.

It remains to be shown that~$(T_\alpha)_\alpha$
converges ultrastrongly to~$T$.
So let $\omega\colon \scrB(\scrH)\to\C$ be an arbitrary
np-map,
being of the form~$\omega\equiv \sum_n\left<x_n,(\,\cdot\,)x_n\right>$
for some $x_1,x_2,\dotsc\in\scrH$ with $\sum_n \|x_n\|^2 <\infty$
by~\sref{bh-np}.
We must show that~$\|T-T_\alpha\|_\omega
\equiv (\sum_n \|(T-T_\alpha)x_n\|^2)^{\nicefrac{1}{2}}$ 
converges to~$0$ as $\alpha\to 0$.

Let~$\varepsilon>0$ be given,
and pick~$\alpha_0$
such that $\|T_\alpha-T_\beta\|_\omega \leq 
\smash{\frac{1}{2\sqrt{2}}}\,\varepsilon$
for all~$\alpha,\beta\geq \alpha_0$
--- this is possible  because~$(T_\alpha)_\alpha$ is ultrastrongly Cauchy.
We claim that $\|T-T_\alpha\|_\omega \leq \varepsilon$
for any~$\alpha\geq \alpha_0$.
Since for such~$\alpha$
the sum
\begin{equation*}
	\sum_{n=1}^\infty \|(T-T_\alpha)x_n\|^2 
	\ = \ 
	\sum_{n=1}^{N-1} \|(T-T_\alpha)x_n\|^2
	\ +\ 
	\sum_{n=N}^\infty
	\|(T-T_\alpha)x_n\|^2
\end{equation*}
converges (to~$\|T-T_\alpha\|_\omega^2$),
we can find~$N$ such that the second term in the bound above
is below~$\frac{1}{2}\varepsilon^2$.
The first term will also be below~$\frac{1}{2}\varepsilon^2$,
because
\begin{equation*}
	\bigl(\sum_{n=1}^{N-1} \|(T - T_\alpha)x_n\|^2\,\bigr)^{\nicefrac{1}{2}}
	\ \leq\ 
\bigl(\,
\sum_{n=1}^{N-1} \|(T-T_{\beta})x_n\|^2
\,\bigr)^{\nicefrac{1}{2}}
\ +\ 
\bigl(\,
\sum_{n=1}^{N-1} \|(T_\beta-T_\alpha)x_n\|^2
\,\bigr)^{\nicefrac{1}{2}}
\end{equation*}
for any~$\beta$,
and in particular for~$\beta$
large enough that the first term on the right-hand side above
is below~$\smash{\frac{1}{2\sqrt{2}}}\,\varepsilon$.
If we choose $\beta\geq \alpha_0$
the second term will be below~$\smash{\frac{1}{2\sqrt{2}}}\,\varepsilon$ too,
and we get $\|T-T_\alpha\|_\omega^2 \leq \frac{1}{2}\varepsilon^2
+ (\smash{\frac{1}{2\sqrt{2}}\,\varepsilon 
+ \frac{1}{2\sqrt{2}}\,\varepsilon})^2
\equiv \varepsilon^2$ 
all in all.
(This reasoning is very similar to that in~\sref{hilb-sum}.)

Hence~$\scrB(\scrH)$ is ultrastrongly complete.\qed
\end{point}
\end{point}
\begin{point}{30}[bh-bounded-uw-complete]{Proposition}%
The von Neumann algebra~$\scrB(\scrH)$
of bounded operators on a Hilbert space~$\scrH$
is bounded ultraweakly complete.
\begin{point}{40}{Proof}%
Let~$(T_\alpha)_\alpha$ be a norm-bounded ultraweakly Cauchy net
in~$\scrB(\scrH)$.
We must show that~$(T_\alpha)_\alpha$
converges ultraweakly
to some bounded operator~$T$ on~$\scrH$.

Note that given $x,y\in\scrH$
the net $(\,\left<x,T_\alpha y\right>\,)_\alpha$
is Cauchy
(because $\left<x,(\,\cdot\,)y\right>
\equiv \frac{1}{4}\sum_{k=0}^3 i^k\left<i^kx+y,(\,\cdot\,)(i^kx+y)\right>$
is ultraweakly continuous),
and so we may define $[x,y] = \lim_\alpha \left<x,T_\alpha y\right>$.
The resulting `form'
$[\,\cdot\,,\,\cdot\,]\colon \scrH\times\scrH\to \C$
(see~\sref{chilb-form})
is bounded, 
because~$\left\|[x,y]\right\| \leq (\sup_\alpha \|T_\alpha\|)\|x\|\|y\|$
for all~$x,y\in\scrH$
and $\sup_\alpha\|T_\alpha\|<\infty$
since $(T_\alpha)_\alpha$
is norm bounded.
By~\sref{chilb-form-representation},
there is a unique bounded operator~$T$
with $\left<x,Ty\right>=[x,y]$
for all~$x,y\in\scrH$.

By definition of~$T$ it is clear 
that~$\lim_\alpha \left<x,(T-T_\alpha)x\right>=0$
for any~$x\in\scrH$,
but it is not yet clear that~$(T_\alpha)_\alpha$ converges ultraweakly to~$T$.
For this we must show that $\lim_\alpha \omega(T-T_\alpha)=0$
for any np-map~$\omega\colon \scrB(\scrH)\to \C$.
By~\sref{bh-np},
we know that such~$\omega$ is of the form
$\omega=\sum_n \left<x_n,(\,\cdot\,)x_n\right>$
for some $x_1,x_2,\dotsc\in\scrH$ with $\sum_n\|x_n\|^2<\infty$.
Now, given~$N$ and~$\alpha$ we easily obtain the 
following bound.
\begin{equation*}
	|\,\omega(T-T_\alpha)| \ \leq\  
	\sum_{n=1}^{N-1} \left|\left<x_n(T-T_\alpha),x_n\right>\right|
\ +\ \bigl(\,\|T\|+\sup_\alpha\|T_\alpha\|\,\bigr)\,\sum_{n=N}^\infty \|x_n\|^2 
\end{equation*}
Since the first term of this bound converges to~$0$ as~$\alpha\to\infty$,
we get, for all~$N$,
\begin{equation*}
	\limsup_\alpha |\,\omega(T-T_\alpha)| \ \leq\ 
	\bigl(\,\|T\|+\sup_\alpha\|T_\alpha\|\,\bigr)\,\sum_{n=N}^\infty \|x_n\|^2.
\end{equation*}
Since the tail $\sum_{n=N}^\infty\|x_n\|^2$
converges to~$0$ as~$N\to \infty$,
$\limsup_\alpha \left|\omega(T-T_\alpha)\right|=0$.
Hence $\omega(T)=\lim_\alpha \omega(T_\alpha)$,
and so~$(T_\alpha)_\alpha$ converges ultraweakly to~$T$.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{770}%
\begin{point}{10}[vn-complete]{Theorem}%
	\index{von Neumann algebra!is ultrastrongly complete}%
	\index{von Neumann algebra!is bounded ultraweakly complete}%
	\index{ultraweak and ultrastrong!completeness}
A von Neumann algebra~$\scrA$ is ultrastrongly complete
and bounded ultraweakly complete.
\begin{point}{20}{Proof}%
Let~$\Omega$ be the set of all np-functionals
on~$\scrA$.
Recall from~\sref{ngns-proof}
that $\varrho_\Omega$
gives an nmiu-isomorphism
onto the 
von Neumann algebra~$\scrR:=\varrho_\Omega(\scrA)$ of operators
on the Hilbert space~$\scrH_\Omega$.
Since~$\scrB(\scrH_\Omega)$ is ultrastrongly complete
(\sref{bh-us-complete}),
and~$\scrR$ is  ultrastrongly closed in~$\scrB(\scrH_\Omega)$
(see~\sref{vnsac}),
we see that $\scrR$
is complete with respect to the ultrastrong
topology of~$\scrB(\scrH_\Omega)$,
but since any np-functional~$\omega\colon \scrR\to\C$
is of the form~$\omega\equiv \left<x,(\,\cdot\,)x\right>$
for some~$x\in\scrH_\Omega$,
and therefore  the ultrastrong topology on~$\scrB(\scrH_\Omega)$
coincides on~$\scrR$ with the ultrastrong topology of~$\scrR$,
we see that~$\scrR$ (and therefore~$\scrA$)
is complete with respect to its own ultrastrong topology.
Since similarly~$\scrB(\scrH_\Omega)$
is bounded ultraweakly complete (\sref{bh-bounded-uw-complete}),
the ultraweak topology on~$\scrB(\scrH_\Omega)$
coincides on~$\scrR$ with the ultraweak topology on~$\scrR$,
and~$\scrR$ is ultraweakly closed
in~$\scrB(\scrH_\Omega)$
(by~\sref{vnsac}),
we see that~$\scrR$ is bounded ultraweakly complete.\qed
\end{point}
\end{point}
\begin{point}{30}[vn-ball-compact]{Theorem}%
The ball $(\scrA)_1$
of a von Neumann algebra~$\scrA$ is ultraweakly compact.
\begin{point}{40}{Proof}%
Writing~$\Omega$ for
the set of npu-maps $\omega\colon \scrA\to\C$,
the map~$\kappa\colon \scrA\to \C^\Omega$
given by~$\kappa(a)=(\omega(a))_\omega$ for all~$a\in\scrA$
is clearly a linear homeomorphism from~$\scrA$ with the  ultraweak topology 
onto~$\kappa(\scrA)\,\subseteq \C^\Omega$ endowed
with the product topology.
Since~$\kappa$ restricts
to an isomorphism of uniform spaces
$(\scrA)_1\to \kappa(\,(\scrA)_1\,)$,
and $(\scrA)_1$ is ultraweakly complete 
(being a norm-bounded ultraweakly closed
subset of the bounded ultraweakly complete space~$\scrA$,
see~\sref{vn-complete}),
we see that $\kappa(\,(\scrA)_1\,)$
is complete,
and thus closed in~$\C^\Omega$.
Now note that~$\kappa(\,(\scrA)_1\,)$ is a closed subset 
of the (by Tychonoff's theorem) compact
space~$((\C)_1)^\Omega$, 
because $\left|\omega(a)\right|\leq 1$ for all~$a\in(\scrA)_1$
and $\omega\in\Omega$.
But then~$\kappa(\,(\scrA)_1\,)$,
being a closed subset of a compact Hausdorff space,
is compact,
and so $(\scrA)_1$ (being homeomorphic to it) is compact too.\qed
\end{point}
\end{point}
\begin{point}{50}[vn-extension]{Proposition}%
Given an ultraweakly dense $*$-subalgebra~$\scrS$
of a von Neumann algebra~$\scrA$,
any ultraweakly continuous and bounded linear map~$f\colon \scrS\to\scrB$
can be extended uniquely
to an ultraweakly continuous map~$g\colon \scrA\to\scrB$.

Moreover, $g$ is bounded,
and in fact,  $\|g\|=\|f\|$.
\begin{point}{60}{Proof}%
As the uniqueness of~$g$ is rather obvious
we concern ourselves only with its existence.
Let~$a\in\scrA$ be given
in order to define~$g(a)$.
Let also~$\varepsilon>0$ be given.
Note that by~\sref{dense-subalgebra} 
there is a net~$(s_\alpha)_\alpha$
in~$\scrS$
that converges ultrastrongly (and so ultraweakly too)
to~$a$
with~$\|s_\alpha \|\leq(1+\varepsilon)\|a\|$
for all~$\alpha$.
Now,
since the net~$(s_\alpha)_\alpha$
is bounded an ultraweakly Cauchy,
and~$f$ is bounded and (uniformly) ultraweakly continuous,
the net
$(f(s_\alpha))_\alpha$
is bounded and ultraweakly Cauchy too,
and thus converges (by~\sref{vn-complete})
to some element
$\uwlim_\alpha f(s_\alpha)$
of~$\scrB$.
\begin{point}{70}%
Of course we'd like to define $g(a):=\uwlim_\alpha
f(s_\alpha)$,
but must first check
that $\uwlim_\alpha f(s_\alpha')
=\uwlim_\alpha f(s_\alpha)$
when~$(s_\alpha')_\alpha$ is a second net with the same properties
as~$(s_\alpha)_\alpha$.
Let us for simplicity's sake
assume that $(s_\alpha')_\alpha$ and~$(s_\alpha)_\alpha$
have the same index set
--- matters can always be arranged this way.
Then as the difference $s_\alpha-s_\alpha'$
converges ultraweakly to~$0$ in~$\scrA$ as~$\alpha\to\infty$,
$\uwlim_\alpha f(s_\alpha-s_\alpha')=0$,
implying that $\uwlim_\alpha f(s_\alpha)
= \uwlim_\alpha f(s_\alpha')$.
\end{point}
\begin{point}{80}%
In this way
we obtain a map $g \colon \scrA\to\scrB$
--- which is clearly linear.
The map~$g$ is also bounded,
because since~$\|s_\alpha\|\leq (1+\varepsilon)\|a\|$
for all~$\alpha$,
where $(s_\alpha)_\alpha$ and~$t$ are as before,
we have $\|f (s_\alpha)\|\leq (1+\varepsilon) \|f\|\|a\|$
for all~$\alpha$,
and so~$\|g(a)\|=\|\uwlim_\alpha f(s_\alpha)\|
\leq (1+\varepsilon) \|f \|\|a\|$.
More precisely, $\|g\|\leq (1+\varepsilon)\|f\|$,
and---as~$\varepsilon>0$ was arbitrary---in 
fact~$\|g\|\leq \|f\|$, and so~$\|g\|=\|f\|$.

That, finally, $g$ is ultraweakly continuous
follows by a standard but abstract argument from the fact
that $f$ is \emph{uniformly} ultraweakly continuous.
We'll give a concrete version of this argument here.
To begin, note that it suffices to show that~$\omega\circ g$
is ultraweakly continuous
at~$0$
where~$\omega\colon \scrB\to\C$
is an np-functional.
Let~$\varepsilon>0$ be given.
Since~$f$ 
is ultraweakly continuous,
and 
thus $\omega\circ f$ is too,
there is~$\delta>0$ and an np-functional~$\nu\colon \scrA\to\C$
such that $\left|\nu(s)\right|\leq \delta \implies 
\left|\omega(f(s))\right|\leq \varepsilon$
for all~$s\in\scrS$.
We claim that $\left|\nu(a)\right|\leq \delta/2 \implies
\left|\omega(g(a))\right|\leq 2\varepsilon$
for all~$a\in\scrA$,
which implies, of course,
that $\omega\circ g$ is ultraweakly continuous on~$0$.
So let~$a\in\scrA$ with $\left|\nu(a)\right|\leq \delta/2$
be given.
Pick (as before) a bounded net~$(s_\alpha)_\alpha$
in~$\scrS$
such that $f(s_\alpha)$
converges to~$a$ as~$\alpha\to\infty$, and observe that,
for all~$\alpha$,
\begin{equation*}
\left|\omega(g (a))\right|
\ \leq\ 
\left|\omega(g(a)-f(s_\alpha))\right|
\,+\,\left|\omega(f(s_\alpha))\right|.
\end{equation*}
The first term on the right-hand side above will 
vanish as~$\alpha\to\infty$ (since 
$g (a)=\uwlim_\alpha f (s_\alpha)$),
and will thus be smaller than~$\varepsilon$ 
for sufficiently large~$\alpha$.
Since~$\lim_\alpha \left|\nu(s_\alpha)\right|=\left|\nu(a)\right|
\leq \delta/2<\delta$
we see 
that for sufficiently large~$\alpha$
we'll have~$\left|\nu(s_\alpha)\right|\leq \delta$ 
and with it~$\left|\omega(f (s))\right|\leq \varepsilon$.
Combined,
we get $\left|\omega(g (a))\right|\leq 2\varepsilon$,
and so~$g$ is ultraweakly continuous.\qed
\end{point}
\end{point}
\end{point}
\end{parsec}
\section{Division}
\label{S:division}
\begin{parsec}{780}%
\begin{point}{10}%
Using the ultrastrong completeness of von Neumann algebras
(see~\sref{vn-complete})
we'll address
the question of division:
given elements~$a$ and~$b$ of a von Neumann algebra~$\scrA$,
when is there an element~$c\in\scrA$
with $a=cb$?
Surely, 
such~$c$ can not always exist,
because
its presence
implies
\begin{equation}
	\label{douglas-ineq}
	a^*a \ \leq \ B\, b^*b,
\end{equation}
where~$B=\|c\|^2$;
but this turns out to be the only restriction:
we'll see in~\sref{douglas} that if~\eqref{douglas-ineq}
holds for some~$B\in [0,\infty)$,
then~$a=cb$ for some
unique~$c\in\scrA$
with~$\ceill{c}\leq \ceilr{b}$,
which we'll denote by~$a/b$.

The main application of this division in our work
is a universal property
for the map $b\mapsto \sqrt{a}b\sqrt{a}\colon
\scrA\to\ceil{a}\!\scrA\!\ceil{a}$
where~$a$ is a positive element of a von Neumann algebra~$\scrA$.
Indeed,
we'll show that
for every np-map $f\colon \scrB\to \scrA$
with $f(1)\leq a$
there is a (unique) np-map $g\colon\scrB\to\ceil{a}\!\scrA\!\ceil{a}$
with~$f(b)=\sqrt{a}g(b)\sqrt{a}$ for all~$b\in\scrB$
---
by taking $g(b)=\sqrt{a}\backslash  (f(b) / \sqrt{a})$,
see~\sref{canonical-filter}.
This does not give a complete description
of the map~$b\mapsto \sqrt{a}b\sqrt{a}$,
though,
since it shares its universal property
with all the maps
$b\mapsto c^*bc,\,\scrA\to\ceil{a}\!\scrA\!\ceil{a}$
where~$c\in\scrA$ with $c^*c = a$,
but that
is a  challenge for the next chapter.

Returning to division again,
another
application
is the polar decomposition
of an element~$a$ of a von Neumann algebra~$\scrA$,
see~\sref{polar-decomposition},
which is simply
\begin{equation*}
	a \,=\, (a/ \sqrt{a^*a})\, \sqrt{a^*a}.
\end{equation*}

Before we get down to business,
let us indicate the difficulty
in defining~$a/b$
for~$a$ and~$b$ that obey~\eqref{douglas-ineq}.
Surely, if~$b$ is invertible,
then we could simply put $a/b:=ab^{-1}$;
and also if~$b$ is just \emph{pseudoinvertible}
in the sense that $b^{\sim 1 }b=\ceill{b}$
and $bb^{\sim 1}=\ceilr{b}$
for some~$b^{\sim 1}$
the formula $a/b:=ab^{\sim 1}$ would work.
But,
of course,
$b$ need not be pseudoinvertible.
The  ideal of~$b^{\sim 1}$
can however be approximated
in an appropriate sense by a formal series $\sum_n t_n$ 
(which we call an \emph{approximate pseudoinverse})
so that we can take
$a/b:= \sum_n a t_n$
(using ultrastrong completeness to see that
the series converges.)
\end{point}
\end{parsec}
\subsection{(Approximate) Pseudoinverses}
\begin{parsec}{790}%
\begin{point}{10}[dfn-pseudoinverse]{Definition}%
Let~$a$ be an element of a von Neumann algebra~$\scrA$.
We'll say that~$a$ is \Define{pseudoinvertible}%
\index{pseudoinverse}
if it has a \Define{pseudoinverse},
that is,
an element~$t$ of~$\scrA$
with 
$ta=\ceill{a}=\ceilr{t}$
and $at=\ceill{t}=\ceilr{a}$.
When such~$t$ exists,
it is unique (by~\sref{mult-cancellation}),
and we'll denote it by~\Define{$a^{\sim 1}$}.%
\index{*sim1@$a^{\sim 1}$, pseudoinverse of~$a$}
If~$a^{\sim1}=a^*$,
we say that~$a$ is a \Define{partial isometry}%
\index{partial isometry!in a von Neumann algebra}
(see~\sref{partial-isometry-equivalents}).
\end{point}
\begin{point}{20}[pseudoinverse-equivalents]{Lemma}%
For elements $a,t$ of a von Neumann algebra
the following are equivalent.
\begin{enumerate}
\item
\label{pseudoinverse-1}
$ta$ is a projection, and~$\ceill{t}=\ceilr{a}$.
\item
\label{pseudoinverse-2}
$ata=a$, and $\ceill{t}\leq \ceilr{a}$ and~$\ceilr{t}\leq \ceill{a}$.
\item
\label{pseudoinverse-3}
$at$ is a projection, and $\ceill{a}=\ceilr{t}$.
\item
\label{pseudoinverse-4}
$tat=t$, and~$\ceill{a}\leq \ceilr{t}$ and~$\ceilr{a}\leq \ceill{t}$.
\item
\label{pseudoinverse-5}
$t$ is a pseudoinverse of~$a$.
\item
\label{pseudoinverse-6}
$a$ is a pseudoinverse of~$t$.
\end{enumerate}
\spacingfix%
\begin{point}{30}{Proof}%
\grayed{(\ref{pseudoinverse-5}$\iff$%
\ref{pseudoinverse-6})}\ 
is clear.
For the remainder we  make two loops.
\grayed{(\ref{pseudoinverse-1}$\Longrightarrow$\ref{pseudoinverse-2})}\ 
We have $\ceill{t}\leq \ceilr{a}$ by assumption,
and $\ceilr{t}=\ceilr{t\ceill{t}}
=\ceilr{t\ceilr{a}}
=\ceilr{ta}=ta=\ceill{ta}\leq\ceill{a}$.
Further, $ata=a$
by~\sref{mult-cancellation},
because $tata=ta$ (since~$ta$ is a projection)
and~$\ceilr{ata}\leq \ceilr{a}\leq\ceill{t}$.
\grayed{(\ref{pseudoinverse-3}$\Longrightarrow$\ref{pseudoinverse-4})} 
follows along the same lines.
\grayed{(\ref{pseudoinverse-2}$
	\Longrightarrow$%
\ref{pseudoinverse-5})}\ 
We have $ta=\ceill{a}$ by~\sref{mult-cancellation},
because $ata=a=a\ceill{a}$,
	and $\ceilr{ta}\leq\ceilr{t}\leq\ceill{a}$.
Also, $at=\ceilr{a}$,
(because~$ata=a=\ceilr{a}a$,
and~$\ceill{at}\leq\ceill{t}\leq \ceilr{a}$).
Further, $\ceill{t}=\ceilr{a}$,
because 
	$\ceilr{a}=at=\ceill{at}\leq \ceill{t}\leq\ceilr{a}$;
and, similarly, $\ceill{a}=\ceilr{t}$.
\grayed{(\ref{pseudoinverse-4}$
	\Longrightarrow$%
\ref{pseudoinverse-5})}
is proven by the same principles, and
\grayed{(\ref{pseudoinverse-5}$
	\Longrightarrow$%
\ref{pseudoinverse-1},\ref{pseudoinverse-3})}
is rather obvious.\qed
\end{point}
\end{point}
\begin{point}{40}[partial-isometry-equivalents]{Exercise}%
Show that an element~$u$ of a von Neumann algebra
is a partial isometry iff
$u^*u$ is a projection
iff $uu^*u=u$
iff $uu^*$ is a projection
iff $u^*uu^*=u^*$
iff~$u^*$ is the pseudoinverse of~$u$.
(Hint: use~\sref{pseudoinverse-equivalents},
or give a direct proof.)
\end{point}
\begin{point}{50}[pseudoinverse-basic]{Exercise}%
Let~$a$ and~$b$ be a elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that~$a$ is pseudoinvertible
iff~$a^*$ is pseudoinvertible,
and, in that case, $(a^*)^{\sim1}=(a^{\sim1})^*$.
\item
Assuming that~$a$ and~$b$ are pseudoinvertible,
and~$\ceilr{b}=\ceill{a}$,
show that $ab$ is pseudoinvertible,
and~$(ab)^{\sim1}=b^{\sim1}a^{\sim1}$.
\item
Show that~$a$ is pseudoinvertible
iff~$a^*a$ is pseudoinvertible,
and, in that case, $a^{\sim 1} = (a^*a)^{\sim1}a^*$
and~$(a^*a)^{\sim1}=a^{\sim1}(a^{\sim1})^*$.
\end{enumerate}
\spacingfix
\end{point}%
\begin{point}{60}[pseudoinverse-basic-2]{Exercise}%
Let~$a$ be a positive element of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that~$a$ is pseudoinvertible iff~$a$
is invertible in~$\ceil{a}\!\scrA\!\ceil{a}$
iff $at=\ceil{a}$ for some~$t\in\scrA_+$.
Show, moreover, that $at=ta$ for such~$t$.
\item
Show that~$a$ is pseudoinvertible iff
there is~$\lambda>0$ with $\lambda \ceil{a}\leq a$.
\item
Assume that~$a$ is pseudoinvertible.

Show that~$\ceil{a^{\sim1}}=\ceil{a}$.

Show that if~$b\in \scrA$ commutes with~$a$,
then $b$ commutes with~$a^{\sim 1}$.

(In other words, $a^{\sim1}\in\{a\}^{\square\square}$.)
\item
Show that~$c^{\sim1}\leq b^{\sim1}$
when~$b\leq c$ are pseudoinvertible positive \emph{commuting}
elements of~$\scrA$.
(The statement is still true without
the requirement that~$b$ and~$c$ commute,
but also much harder to prove.)


\item
Show that $(0,0,1,\frac{1}{2}, \frac{1}{3},\dotsc)$
        is not pseudoinvertible in~$\ell^\infty(\N)$.
\end{enumerate}
\end{point}
\end{parsec}
\begin{parsec}{800}%
\begin{point}{10}{Remark}%
Note that the obvious candidate
for the pseudoinverse of~$(0,0,1,\frac{1}{2},\frac{1}{3},\dotsc)$
    from~$\ell^\infty(\N)$
being~$(0,0,1,2,3,\dotsc)$
is not bounded,
    and therefore not an element of~$\ell^\infty(\N)$.
We can nevertheless approximate~$(0,0,1,2,3,\dotsc)$
by the elements
\begin{equation*}
(0,0,1,0,0,\dotsc),\ 
(0,0,1,2,0,\dotsc),\  \dots 
\end{equation*}
    of~$\ell^\infty(\N)$
forming what we will call ``approximate pseudoinverse'' for 
$(0,0,1,\frac{1}{2},\frac{1}{3},\dotsc)$.
That this can also be done for an arbitrary element
of a von Neumann algebra
is what we'll see next.
\end{point}
\begin{point}{20}[approximate-pseudoinverse-def]{Definition}%
An \Define{approximate pseudoinverse}%
\index{approximate pseudoinverse}%
\index{pseudoinverse!approximate}
of an element~$a$ of a von Neumann algebra~$\scrA$
is a sequence~$t_1,t_2,\dotsc$
of elements of~$\scrA$
such that~$t_1a,\ t_2a,\ \dotsc, at_1,\ at_2,\ \dotsc$
are projections with $\sum_n t_na = \ceill{a}=\sum_n \ceilr{t_n}$
and~$\sum_n at_n =\ceilr{a}=\sum_n \ceill{t_n}$.
\end{point}
\begin{point}{30}[approximate-pseudoinverse-reduction]{Exercise}%
Let~$b$ be an element of a von Neumann algebra~$\scrA$,
and let~$t_1,t_2,\dotsc$
be an approximate pseudoinverse
of~$b^*b$.
Show that $t_1b^*,\ t_2b^*,\ \dotsc$
is an approximate pseudoinverse of~$b$.
\end{point}
\begin{point}{40}[approximate-pseudoinverse]{Theorem}%
Every element~$a$ of a von Neumann algebra~$\scrA$
has an approximate pseudoinverse.
\begin{point}{50}{Proof}%
By~\sref{approximate-pseudoinverse-reduction},
it suffices to consider the case that~$a$ is positive.
When~$a=0$ the sequence~$0,0,0,\dotsc$
clearly yields an approximate pseudoinverse for~$a$,
so let us disregard this case,
and assume that~$a$ is positive and non-zero.

Note that $a-1 \,\leq\, a-\frac{1}{2}\,\leq\, a - \frac{1}{3}\,\leq\, \dotsb$
converges in the norm to~$a\equiv a_+$,
and so does $(a-1)_+\,\leq\,(a-\frac{1}{2})_+\,\leq\,\dotsc$,
which converges also ultraweakly to~$\bigvee_n(a-\frac{1}{n})$,
so that~$a=\bigvee_n (a-\frac{1}{n})_+$,
and thus $\ceil{a}=\bigcup_n \ceil{(a-\frac{1}{n})_+}$
by~\sref{ceil-supremum}.

Writing $q_n=
\ceil{\smash{(a-\frac{1}{n})_+}}$
--- and picturing it as the places where~$a\geq \frac{1}{n}$ ---
we have $(a-\frac{1}{n})q_n = (a-\frac{1}{n})_+\geq 0$
(because~$b\ceil{b_+}=b_+$
for a positive element~$b$ of a von Neumann algebra,
by~\sref{ceil-pos-part}),
and so $\frac{1}{n}q_n \leq  aq_n$ for all~$n>0$.

Writing $e_{n}=q_{n+1}-q_n$
for all~$n$ (taking~$q_0:=0$)
--- and thinking of it as the places
where $\frac{1}{n+1}\leq a < \frac{1}{n}$ --- 
we get a sequence of (pairwise orthogonal) projections
$e_1,e_2,\dotsc$ in~$\{a\}^{\square\square}$
with $\sum_n e_n = \ceil{a}$.
By an easy computation
involving the facts that $\frac{1}{n+1}\leq \frac{1}{n}$
and~$aq_n\leq aq_{n+1}$,
we get $\frac{1}{n+1}e_n \leq ae_n \leq  \frac{1}{n}e_n$.

We claim that~$\ceil{ae_n}=\ceil{e_n}$ for any~$n$.
Indeed, on the one hand~$ae_n=e_nae_n\leq \|a\|e_n$
(as~$e_n\in\{a\}^{\square\square}$)
and so~$\ceil{ae_n}\leq \ceil{\|a\|e_n}=e_n$
(using here that $\|a\|\neq 0$),
while on the other hand, $\frac{1}{n+1}e_n\leq ae_n$
gives $e_n\equiv \ceil{\smash{\frac{1}{n+1}e_n}}\leq \ceil{ae_n}$.
In particular, $\frac{1}{n+1}\ceil{ae_n}=\frac{1}{n+1}e_n \leq ae_n$,
	so that~$ae_n$ is pseudoinvertible (by~\sref{pseudoinverse-basic-2}).

Writing~$t_n := (ae_n)^{\sim1}$,
we have~$\ceil{t_n}=e_n$
(since~$\ceil{ae_n}=e_n)$.
Then $t_na=t_n\ceil{t_n}a=t_ne_na=\ceil{ae_n}=e_n$,
and similarly, $at_n = e_n$,
so that $\sum_n at_n = \sum_n t_n a 
=\sum_n e_n =\ceil{a}
= \sum_n \ceil{t_n}$,
making $t_1,t_2,\dotsc$ an approximate pseudoinverse of~$a$.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Division}
\begin{parsec}{810}%
\begin{point}{10}[division]{Definition}%
Let~$b$ be an element of a von Neumann algebra~$\scrA$,
and let~$a$ be an element of~$\scrA b$
--- so~$a\equiv cb$ for some~$c\in\scrA$.
We denote by~\Define{$a/b$}%
\index{*slash@$a/b$!in a von Neumann algebra}
the (by~\sref{mult-cancellation}) unique
element~$c$ of~$\scrA\!\ceilr{b}$
with~$a=cb$,
and, dually,
given an element~$a$ of~$b\scrA$ 
we denote by~\Define{$b\backslash a$} 
the unique
element~$c$ of~$\ceill{b}\!\scrA$
with~$a=bc$.
\end{point}
\begin{point}{20}{Exercise}%
Let~$a$ and~$b$
be elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Show that $c/b$ is an element of~$\ceilr{c}\!\scrA\!\ceilr{b}$
for every element~$c$ of~$b\scrA$.
\item
Show that $(ab)/b = a\ceilr{b}$
and~$b\backslash (ba)=\ceill{b}a$.
\item
Let~$c$ be an element of $a\scrA b$.
Show that
$a \backslash c \,\in\, \scrA b$,
and
$c/b\,\in\,a\scrA$, and
\begin{equation*}
(a\backslash c)/b\ =\  a\backslash(c/b)
\quad =:\  \Define{a\backslash c/b}.
\end{equation*}
\index{*slashslash@$a\backslash c/b$!in a von Neumann algebra}
Show that~$a\backslash c/b$
is the unique element~$d$ of~$\ceill{a}\scrA\ceilr{b}$
with~$c=adb$. 
\item
Let~$c$ be an element of~$\scrA b$
and let~$d$ be an element of~$a\scrA$.

Show that~$dc\in a\scrA b$,
and~$a\backslash (dc) / b  = (a\backslash d)\,(c/b)$.
\item
Let~$c$ be an element of~$\scrA b$.
Show that~$c^* \,\in\, b^* \scrA$
and $b^*\backslash c^* = (c/b)^*$.
\end{enumerate}%
\spacingfix%
\end{point}%
\begin{point}{30}[proto-douglas]{Lemma}%
Given elements $a$ and~$b$ of a von Neumann algebra~$\scrA$
with~$a^*a \leq b^*b$
we have $a\,\in\, \scrA b$.
Moreover,
given an approximate pseudoinverse $t_1,t_2,\dotsc$
of~$b$,
the series $\sum_nat_n$ converges ultrastrongly to~$a/b$,%
\index{*slash@$a/b$!in a von Neumann algebra}
and uniformly so in~$a$.
\begin{point}{40}{Proof}%
To show that~$\sum_{n=0}^N at_n$
converges ultrastrongly as~$N\to \infty$
it suffices
to show that~$(\,\sum_{n=0}^N at_n\,)_N$
is ultrastrongly Cauchy
(because~$\scrA$ is ultrastrongly complete, by~\sref{vn-complete}).
To this end, note that
\begin{alignat*}{3}
\textstyle 
(\, \sum_{n=M}^N at_n\,)^*\ \,\sum_{n=M}^N\,at_n
\ &= \textstyle\ (\sum_{n=M}^Nt_n^*) \,a^*a\, (\sum_{n=M}^N t_n)
\\
\ &\leq\ \textstyle 
 (\sum_{n=M}^N t_n^*) \,b^*b\, (\sum_{n=M}^Nt_n)
\\
\ &= \ \textstyle 
\sum_{n,m=M}^N
t_n^*b^*bt_m 
\\
\ &=\ \textstyle 
\sum_{m=M}^N
bt_m,
\end{alignat*}
where we've used that
$bt_1,\ bt_2,\ \dotsc$
are pairwise orthogonal projections
--- but then the series~$\sum_{n=0}^\infty bt_m$
converges ultraweakly by~\sref{sum-of-orthogonal-projections}.
This, coupled with the
inequality above,
gives us that~$\sum_{n=0}^N at_n$
is ultrastrongly Cauchy,
and therefore converges ultrastrongly --- 
and even uniformly so in~$a$,
because~``$a$'' does not appear in
the expression
``$\sum_{m=M}^N bt_m$'' that gave the bound.

Define~$c:=\sum_{n=0}^\infty at_n$.
Since~$a^*a \leq b^*b$,
we have $\ceill{a}\leq \ceill{b}$,
and so~$a=a\ceill{b} = a\sum_n t_n b = \sum_n at_n b = cb$. 
So to get~$c=a/b$
we only need to prove that~$\ceill{c}\leq \ceilr{b}$,
that is, $c\ceilr{b}=c$.
To this end,
recall that~$\sum_n \ceill{t_n}=\ceilr{b}$,
so that~$\ceill{t_n}\leq \ceilr{b}$,
and~$t_n\ceilr{b}=t_n$,
which implies
that~$at_n\ceilr{b}=at_n$,
and so~$c\ceilr{b}=\sum_n at_n\ceilr{b}
= \sum_n at_n=c$.\qed
\end{point}
\end{point}
\begin{point}{50}[douglas]{Exercise}%
\index{Douglas' Lemma}
Let~$a$ and~$b$ be elements of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Let~$\lambda\geq 0$ be given,
and recall that $(\scrA)_\lambda 
= \{c\in\scrA\colon \|c\|\leq\lambda\}$.

Show that $a$ is in $(\scrA)_\lambda b$ iff $a^*a\leq \lambda^2 b^*b$,
and then~$\|a/b\|\leq \lambda$.

(Compare this with ``Douglas'~Lemma'' from~\cite{douglas}.)
\item
Show that $a \in \scrA\!\ceilr{b}$
need not entail that~$a\in \scrA b$.
\end{enumerate}
\spacingfix%
\end{point}%
\begin{point}{60}[sequential-douglas]{Exercise}%
Let~$b$ be an element of a von Neumann algebra~$\scrA$.
\begin{enumerate}
\item
Let~$a$ be a positive element of~$\scrA$,
and let~$\lambda\geq 0$.

Show that
 $a\in b^*(\scrA)_\lambda b$
iff~$a\leq \lambda b^*b$,
and then~$\|b^*\backslash a / b \| \leq\lambda$.
\item
Show that~$b^*\backslash a / b$ is positive
for every positive element~$a$ of $ b^* \scrA b$.

(Hint: prove that $(b^*\backslash \sqrt{a})\,(\sqrt{a}/b)
= b^*\backslash a/b$.)
\end{enumerate}%
\spacingfix%
\end{point}%
\begin{point}{70}[div-approx]{Exercise}%
Given elements~$b$ and~$c$ of a von Neumann algebra~$\scrA$,
an approximate pseudoinverse $t_1,t_2,\dotsc$
of~$b$,
and an approximate pseudoinverse of~$s_1,s_2,\dotsc$
of~$c$,
show that
$(\sum_{n=1}^N s_n) \,a\, (\sum_{m=1}^Nt_m)$,
converges ultrastrongly to~$c\backslash a /b$%
\index{*slashslash@$a\backslash c/b$!in a von Neumann algebra}
as~$N\to\infty$
(and uniformly so) for~$a\in c(\scrA)_1 b$.
\end{point}
\begin{point}{80}[sequential-quotient]{Exercise}%
Show that for positive elements~$a$ and~$b$ of a von Neumann
algebra~$\scrA$,
the following are equivalent.
\begin{enumerate}
\item
$a\leq \lambda b$ for some~$\lambda\geq 0$;
\item
$a=\sqrt{b}c\sqrt{b}$
for some positive~$c\in\scrA$.
\end{enumerate}
In that case, there is a unique~$c\in\scrA_+$
with $a=\sqrt{b}c\sqrt{b}$
and~$\ceil{c}\leq \ceil{b}$.
Moreover,
if~$t_1,t_2,\dotsc$
is an approximate pseudoinverse of~$\sqrt{b}$,
then~$\sum_{m,n} t_m a t_n$
converges ultraweakly to such~$c$.
\end{point}
\begin{point}{90}[div-usc]{Lemma}%
Given elements~$b$ and~$c$  of a von Neumann algebra~$\scrA$
the maps 
\begin{equation*}
	a\mapsto a/b\colon \  (\scrA)_1b \to \scrA
\qquad\text{and}\qquad
a\mapsto c\backslash a/b\colon\  c(\scrA)_1b\to \scrA
\end{equation*}
are ultrastrongly continuous
(where $(\scrA)_1$ is the unit ball).
\begin{point}{100}{Proof}%
By~\sref{proto-douglas}
the series~$\sum_n at_n$ converges ultraweakly to~$a/b$,
where~$t_1,t_2,\dotsc$
is an approximate pseudoinverse of~$b$,
and in fact uniformly so for~$a\in(\scrA)_1 b$
(because $a^*a\leq b^*b$ for such~$a$).
Since~$a\mapsto \sum_{n=1}^N at_n,\ (\scrA)_1b\to\scrA$
is ultrastrongly continuous (by~\sref{mult-uws-cont})
--- and the uniform limit of continuous functions is continuous ---
we see that~$a\mapsto a/b,
\ (\scrA)_1b\to\scrA$ is ultrastrongly continuous.
It follows that
$(\,\cdot\,)/b\colon\,c(\scrA)_1b\to c(\scrA)_1$
and~$c\backslash(\,\cdot\,)\colon\, c(\scrA)_1\to\scrA$
are ultrastrongly continuous;
as must be their composition $c\backslash\,\cdot\,/b\colon\,
c(\scrA)_1b\to\scrA$.\qed
\end{point}
\begin{point}{110}{Remark}%
The map $a\mapsto a/b$ might not give
an ultrastrongly
continuous map on the larger domain~$\scrA b$,
because, for example, 
upon applying $(\,\cdot\,)/(1,\frac{1}{2},\frac{1}{3},\dotsc)$
to the ultrastrongly Cauchy 
sequence  $(1,0,0,\dotsc),\ (1,1,0,\dotsc),\ \dotsc$
    in~$\ell^\infty(\N)$
we get the 
sequence $(1,0,0,\dotsc),\ (1,2,0,\dotsc),\ \dotsc$,
which is not ultrastrongly Cauchy.
\end{point}
\end{point}
\end{parsec}
\subsection{Polar Decomposition}
\begin{parsec}{820}%
\begin{point}{10}[polar-decomposition]{Proposition (Polar Decomposition)}%
\index{polar decomposition!of an element of a von Neumann algebra}%
Any element~$a$ of a von Neumann
algebra~$\scrA$
can be uniquely written as~$a=\Define{[a]}\sqrt{a^*a}$,%
    \index{*brackets@$[\,\cdot\,]$!$[a]$, partial isometry from the polar decomposition of~$a$}
where~$[a]$
is an element of~$\scrA\!\ceill{a}$.
Moreover,
\begin{enumerate}
\item
$[a]$ is partial isometry
with $[a]^*[a] = \ceil{a^*a} \equiv \ceill{a}$
and $[a][a]^*=\ceil{aa^*} \equiv \ceilr{a}$,
\item
and $[a^*]=[a]^*$, so that~$\sqrt{aa^*}[a]=a=[a]\sqrt{a^*a}$.
\end{enumerate}
\spacingfix%
\begin{point}{20}{Proof}%
Since $a^*a\leq \sqrt{a^*a}\sqrt{a^*a}$,
the existence and uniqueness
of an element~$[a]$ of~$\scrA$
with $a=[a]\sqrt{a^*a}$
and~$\ceill{\,[a]\,}\leq
\ceill{a}\equiv \ceilr{\,\sqrt{a^*a}\,}$
is provided by~\sref{douglas},
and we get~$\ceilr{\,[a]\,}\leq \ceilr{a}$
to boot!
Note that~$[a]^*[a]=\ceil{a^*a}$,
by~\sref{mult-cancellation},
because 
\begin{equation*}
	\sqrt{a^*a}\,[a]^*[a]\,\sqrt{a^*a}
\ =\ 
a^*a
\ =\ 
\sqrt{a^*a}\,\ceil{a^*a}\,\sqrt{a^*a},
\end{equation*}
and $\ceil{\,[a]^*[a]\,}\leq \ceill{a}=\ceil{\,\sqrt{a^*a}\,}$.
In particular, $[a]$ is a partial isometry
(by~\sref{partial-isometry-equivalents}).

Let us prove that $[a][a]^*=\ceilr{a}$.
Note that~$[a][a]^*$
is a projection (because $[a]$ is a partial isometry, 
by~\sref{partial-isometry-equivalents}).
We already know that $[a][a]^* = \ceilr{\,[a]\,}\leq \ceilr{a}$.
Concerning the other direction,
$aa^*=[a]\sqrt{a^*a}\,\sqrt{a^*a}[a]^*=[a]\,a^*a\,[a]^*$,
so that
$\ceilr{a}=\ceil{aa^*}
= \ceil{\,[a]a^*a[a]^*\,}
\leq \ceil{\,\|a\|^2[a][a]^*\,}
	=\ceil{[a][a]^*}
\leq [a][a]^*$.

To prove that~$a=\sqrt{aa^*}[a]$,
we'll first show that~$\sqrt{aa^*} = [a] \sqrt{a^*a} [a]^*$.
Indeed, since~$[a]^*[a]=\ceil{\,\sqrt{a^*a}\,}$,
we have
$[a]\sqrt{a^*a}[a]^*[a]\sqrt{a^*a}[a]^*
= [a] \sqrt{a^*a} \,\sqrt{a^*a} [a]^* 
= aa^*$ --- now take the square root.
It follows that~$\sqrt{aa^*}[a]
= [a]\sqrt{a^*a}[a]^*[a]
= [a]\sqrt{a^*a}=a$.
Finally, upon applying~$(\,\cdot\,)^*$,
we see that
$a^*=[a]^*\sqrt{aa^*}$,
and thus~$[a^*]=[a]^*$,
by uniqueness of~$[a^*]$,
because $\ceill{\,[a]^*\,}=\ceilr{\,[a]\,}=  \ceilr{a}
=\ceill{a^*}$.\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{830}%
\begin{point}{10}%
Recall from~\sref{cceil-fundamental}
that the least central projection~$\cceil{e}$
above a projection~$e$ of a von Neumann algebra~$\scrA$
is given by~$\cceil{e}=\bigcup_{a\in \scrA}\ceil{a^* e a}$.
Using the polar decomposition
we can give a more economical
description of~$\cceil{e}$,
see~\sref{cceil-sum}.
\end{point}
\begin{point}{20}[vmleq]{Proposition}%
Given projections $e'$ and~$e$
of a von Neumann algebra~$\scrA$,
the following are equivalent.
\begin{enumerate}
\item
\label{vmleq-1}
$e'= \ceil{a^*e a}$ for some~$a\in\scrA$;
\item
\label{vmleq-2}
$e' = \ceill{a}$ and~$\ceilr{a}\leq e$
for some~$a\in\scrA$;
\item
\label{vmleq-3}
$e' = u^*u$ and~$uu^*\leq e$
for some partial isometry~$u$.
\end{enumerate}
In that case
we write~$\Define{e'\vmleq e}$%
\index{((vmleq@$\vmleq$, Murray--von Neumann preorder}
(and say~$e'$ is \Define{Murray--von Neumann below}~$e$).%
\index{Murray--von Neumann preorder}
\begin{point}{30}{Proof}%
That~\ref{vmleq-3}
implies~\ref{vmleq-2} is clear.
(\ref{vmleq-2}$\Rightarrow$\ref{vmleq-1})\ 
Since~$\ceilr{a}\leq e$,
we have $ea=a$,
and so~$\ceil{a^*ea}=\ceil{a^*a}=\ceill{a}=e'$.
(\ref{vmleq-1}$\Rightarrow$\ref{vmleq-3})\ 
By the polar decomposition (see~\sref{polar-decomposition})
we get a partial isometry~$u:=[ea]$
for which $u^*u = [ea]^*[ea]=\ceil{(ea)^*ea}=e'$
and~$uu^*=\ceil{eaa^*e}\leq e$.\qed
\end{point}
\end{point}
\begin{point}{40}[mvn-preorders]{Exercise}%
Show that~$\vmleq$  preorders
the projections of a von Neumann algebra.
\end{point}
\begin{point}{50}[cceil-sum]{Lemma}%
\index{*cceil@$\cceil{\,\cdot\,}$!$\cceil{a}$, central support}%
Given a projection~$e$
of a von Neumann algebra~$\scrA$
there is a family
$(e_i)_i$ of non-zero projections with $\cceil{e}=\sum_i e_i$,
and $e_i\vmleq e$ for all~$i$.
\begin{point}{60}{Proof}%
Let~$(e_i)_i$
be a maximal set of non-zero pairwise orthogonal projections
in~$\scrA$ with
$e_i\vmleq e$ for all~$i$.
Our goal is to show that $\sum_i e_i \equiv \bigcup_i e_i=\cceil{e}$.

Let~$u_i$ be a partial isometry
with $u_i^*u_i=e_i$ and $u_iu_i^* \leq e$.
Since $e_i=u_i^* u_i = u_i^* u_i u_i^* u_i
\leq u_i^* e u_i 
\leq \bigcup_{a\in \scrA} \ceil{a^* e a}=\cceil{e}$,
we have
$\bigcup_i e_i \leq \cceil{e}$.

Suppose that~$\bigcup_i e_i < \cceil{e}$
(towards a contradiction).
Then since $p:=\cceil{e}-\bigcup_i e_i $ 
is a non-zero projection,
and~$p=p\cceil{e} p
=\bigcup_{a\in\scrA} \ceil{p\ceil{a^*ea}p}
= \bigcup_{a\in\scrA} \ceil{(eap)^*eap}$,
there must be~$a\in\scrA$ with $(eap)^*eap\neq 0$.
The polar decomposition (see~\sref{polar-decomposition})
of~$eap$
gives us a partial isometry $u:=[eap]$
with $uu^* = \ceil{eap(eap)^*}=\ceil{eapa^*e}\leq e$
and $u^*u= \ceil{(eap)^*eap}\leq p$,
so that $u^*u$ is a non-zero projection,
orthogonal to all~$e_i$ with $u^*u \vmleq e$.
In other words,
$e$ could have been added to~$(e_i)_i$,
contradicting its maximality.
Hence $\bigcup_i e_i = \cceil{e}$.
\qed
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{840}%
\begin{point}{10}%
Using~\sref{vmleq} we can classify
all finite-dimensional $C^*$-algebras.
\end{point}
\begin{point}{20}[fdcstar]{Theorem}%
\index{Cstar-algebra@$C^*$-algebra!finite dimensional}%
\index{von Neumann algebra!finite dimensional}%
Any finite-dimensional $C^*$-algebra~$\scrA$
is
a direct sum
of full matrix algebras,
that is,
$\scrA\cong \bigoplus_m M_{N_m}$
for some  $N_1,\dotsc,N_M\in\N$.
\begin{point}{30}{Proof}%
Let~$e_1,\dotsc,e_N$ be a basis for~$\scrA$.
We'll first show that~$\scrA$ is a von Neumann algebra,
and for this we'll 
need the fact that the unit ball $(\scrA)_1$
is compact with respect to the \emph{norm} on~$\scrA$.
For this it suffices
to show that~$\|\,\cdot\,\|$
is equivalent to the norm~$\|\,\cdot\,\|'$ on~$\scrA$
given by~$\|a\|'=\sum_n\left|z_n\right|$
for all $a\equiv \sum_n z_n e_n$
where~$z_1,\dotsc,z_N\in\C$,
(because the unit $\|\,\cdot\,\|'$-ball is clearly compact
being homeomorphic to the unit ball of~$\C^N$.)
Since for such~$a\equiv \sum_n z_n e_n$
we have
\begin{equation*}
	\textstyle
\|a\|\,\leq\, \sum_n\left|z_n\right| \left\|e_n\right\|
\,\leq\,\sum_n\left|z_n\right| \,\sup_n\left\|e_n\right\|
	\,=\, \|a\|'\,\sup_n\left\|e_n\right\|
\end{equation*}
we see that~$a\mapsto a\colon \scrA\to\scrA$
is continuous from~$\|\,\cdot\,\|'$
to~$\|\,\cdot\,\|$.
For the converse
it suffices to show that
$f_m\colon\, a\equiv \sum_n z_n \mapsto z_m,\, 
\scrA\to\C$
is bounded with respect to~$\|\,\cdot\,\|$,
because then
\begin{equation*}
	\textstyle
	\|a\|'\,\equiv\, \|\sum_n f_n (a)e_n\|'
	\,\leq\, \sum_n\left|f_n(a)\right| 
	\,\leq\, (\sum_n \|f_n\|)\,\|a\|.
\end{equation*}
In fact,
we'll show that any linear functional on~$\scrA$
is bounded.
Since the bounded linear functionals
form a linear subspace~$\scrA^*$
of $N$-dimensional vector space of all linear functionals 
on~$\scrA$
it suffices to show that~$\scrA^*$ has dimension~$N$.
So let~$f_1,\dotsc,f_M$ be a basis for~$\scrA^*$;
we must show that~$N\leq M$.
Since the states of~$\scrA$
(see~\sref{states-order-separating})
and thus all linear functionals on~$\scrA$
form a separating collection,
the functionals $f_1,\dotsc,f_N$
form a separating set too;
since therefore
\begin{equation*}
a\mapsto (f_1(a),\,\dotsc,\,f_M(a))\colon\,
\scrA\to\C^M
\end{equation*}
is a linear injection
from the~$N$-dimensional
space~$\scrA$ to the $M$-dimensional space~$\C^M$
we get~$N\leq M$.
Whence all linear functionals on~$\scrA$
are bounded, the norms $\|\,\cdot\,\|$ and~$\|\,\cdot\,\|'$
are equivalent,
and $(\scrA)_1$
is norm compact.
\begin{point}{40}[suprema-in-fdvna]{$\scrA$ is a von Neumann algebra}%
First we need to show that every bounded directed
set~$D$ of self-adjoint elements
of~$\scrA$ has a supremum (in $\Real{\scrA}$).
We may assume without loss of generality that~$\|d\|\leq 1$
for all~$d\in D$, and so~$D\subseteq (\scrA)_1$.
Since~$(\scrA)_1$
is norm compact
there is a cofinal subset~$D'$ of~$D$
that norm converges to some~$a\in\scrA$,
and thus~$D$ norm converges to~$a$ itself.
It's easily seen that~$a$ is the supremum of~$D$.
Indeed, given $d_0\in D$
we have~$d_0\leq d$ for all~$d\geq d_0$,
and so~$d_0\leq \lim_{d\geq d_0} d=a$.
Hence~$a$ is an upper bound for~$D$;
and if~$b$ is an upper bound for~$D$,
then~$d\leq b$ for all~$d\in D$, and so $a=\lim_d d \leq  b$.

Since in this finite-dimensional setting~$\bigvee D$
is apparently the norm limit of~$(d)_{d\in D}$,
any positive functional $f$ on~$\scrA$
will map~$\bigvee D$ to the limit of
$(f(d))_{d\in D}$,
which is~$\bigvee_{d\in D} f(d)$,
and so~$f(\bigvee D)=\bigvee_{d\in D} f(d)$.
Whence every positive functional on~$\scrA$
is normal; and since the positive functionals on~$\scrA$
form a separating collection,
$\scrA$ is a von Neumann algebra.
\end{point}
\begin{point}{50}{Reduction to a factor}%
Since pairwise orthogonal non-zero projections
are easily seen to be linearly independent,
and~$\scrA$ is finite dimensional,
every orthogonal set of projections in~$\scrA$ is finite.
In particular,
any descending sequence of non-zero projections must eventually become
constant.
It follows that below every (central) projection~$p$ in~$\scrA$
there is a minimal (central) projection,
and even that~$p$ is the finite sum of minimal (central) projections.
In particular,
the unit~$1$ of~$\scrA$ can be written
as $1=\sum_n z_n$ where~$z_1,\dotsc,z_M$ are minimal central projections
of~$\scrA$.
By~\sref{central-projections-sums}
we know that~$z_m\scrA$ is a von Neumann algebra for each~$m$,
and that~$\scrA$ is nmiu-isomorphic
to the direct sum $\bigoplus_m z_m \scrA$
of these von Neumann algebras
via~$a\mapsto (z_ma)_m$.
Since~$z_m$ is a minimal central projection,
the von Neumann algebra~$z_n \scrA$
has no non-trivial central projections.
\end{point}
\begin{point}{60}{When~$\scrA$ is a factor}%
Let~$e$ be a minimal
projection of~$\scrA$
(which exists by the previous discussion).
Since~$e\neq 0$,
and~$\scrA$ has no non-trivial central projections,
we have~$\cceil{e}=1$.
By~\sref{cceil-sum}
we have $1\equiv \cceil{e}=\sum_k e_k$
for some non-zero projections $e_1,\dotsc,e_K$
in~$\scrA$
with~$e_k\vmleq e$.
So there are partial isometries
$u_1,\dotsc,u_K\in\scrA$
with $u_k^* u_k = e_k$
and~$u_ku_k^*\leq e$ for all~$k$.
In fact,
since~$e$ is minimal,
we have~$u_ku_k^* = e$.
Thinking of~$u_k$
as~$\ketbra{0}{k}$
define~$u_{k\ell } = u_k ^* u_\ell$;
we'll show that
$\varrho\colon A\mapsto \sum_{k\ell} A_{k\ell}  u_{ k \ell}
\colon M_K\to\scrA$
is an miu-isomorphism.
It's easy to see that~$\varrho$
is linear, involution preserving and unital.
To see that~$\varrho$ is multiplicative,
first note that $u_j u_k^*$ equals~$e$ when~$j=k$
and is zero otherwise.
It follows
that~$u_{ij} u_{k\ell}$
equals $u_{i\ell}$
when~$k=j$ and is zero otherwise.
Whence
\begin{equation*}
	\textstyle
\varrho(A)\varrho(B)
\ =\  
	\sum_{ijk\ell}
	A_{ij}u_{ij} B_{k\ell}u_{k\ell}
\ = \ 
	\sum_{i\ell} ( \sum_k A_{ik} B_{k\ell}) u_{i\ell}
	\ = \ \varrho( AB)
\end{equation*}
for all matrices $A,B\in M_K$,
and so~$\varrho$ is multiplicative.

It remains to be shown that~$\varrho$ is a bijection.
To see that~$\varrho$ is injective,
first note that~$\varrho$
is normal,
because using the fact that~$\varrho$ is positive
and thus bounded,
we can show that~$\varrho$ preserves suprema of bounded directed
sets in much the same way we showed
that all np-functionals on~$\scrA$ are bounded.
We can thus speak of the central carrier~$\cceil{\varrho}$
of~$\varrho$,
and thus to show that~$\varrho$ is injective
it suffices to show that~$\cceil{\varrho}=1$.
Since~$M_K$ is a factor
(see \sref{central-examples})
the only alternative
is~$\cceil{\varrho}=0$
i.e.~$\varrho=0$,
which is clearly absurd
unless~$\scrA=\{0\}$
in which case
we'd already be done.
Hence~$\varrho$ is injective.

To see that~$\varrho$ is surjective
let~$a\in\scrA$ with $a\neq 0$ be given.
Since~$a\equiv \sum_{k,\ell} e_k a e_\ell
= \sum_{k,\ell}u_{k1} u_{1k}au_{\ell 1} u_{1\ell}$,
and~$u_{k1}$ and~$u_{1\ell}$ are in the range of~$\varrho$
it suffices
to show that $u_{1k}a u_{\ell 1}$
is in the range of~$\varrho$
for all~$k$ and~$\ell$.
In other words,
we may assume without loss of generality
that~$e a e = a$,
where~$e$ is the minimal projection in~$\scrA$ we started with.
Since~$e(\Real{a})_+e= (\Real{a})_+$, and so on,
we may assume that~$a$ is positive.
By scaling,
we may also assume that~$\|a\|\leq \nicefrac{1}{3}$.
Since $\ceil{\|a\|e -a}\leq e$,
and~$e$ is minimal,
we either have~$\ceil{\|a\|e-a}=e$
or~$\ceil{\|a\|e-a}=0$.

The former case is impossible:
indeed,
if $e=\ceil{\|a\|e-a}\equiv \bigvee_n (\|a\|e-a)^{\nicefrac{1}{2^n}}$
(see~\sref{vna-ceil}),
then~$(\|a\|e-a)^{\nicefrac{1}{2^n}}$
norm converges to~$\ceil{\|a\|e-a}=e$
(cf.~\sref{suprema-in-fdvna}),
and so $\|\|a\|e-a\|^{\nicefrac{1}{2^n}}$
converges to $\|e\|=1$.
Then~$\|\|a\|e-a\|=1$,
while~$\|\|a\|e-a\|\leq \|a\|\|e\|+\|a\|\leq  \frac{2}{3}$,
which is absurd.

Hence~$\ceil{\|a\|e-a}=0$,
and so~$a=\|a\|e$.
In particular, $a$ is in the range of~$\varrho$.
Whence~$\varrho$ is surjective,
and thus an miu-isomorphism $M_N\to\scrA$.\qed
\end{point}
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{841}%
\begin{point}{10}[cstar-no-pu-equalisers-example]{Example}%
Using the description of all finite-dimensional $C^*$-algebras
    from~\sref{fdcstar}
we can prove the  claim made at the start of this thesis,
in~\sref{cstar-no-pu-equalisers},
that in~$\Cstar{pu}$ there's no equaliser
for the maps $f,g\colon \C^4\to \C$
given  by
\begin{equation*}
\textstyle
f(a,b,c,d)\,=\, \frac{1}{2}(a+b),
\quad \text{and}\quad
g(a,b,c,d)\,=\, \frac{1}{2}(c+d).
\end{equation*}
Indeed, suppose towards a contradiction
that $f$ and~$g$ do have an
equaliser $e\colon \scrE\to\C^4$ in~$\Cstar{pu}$,
and let~$\scrS$
denote the set-theoretic equaliser:
\begin{alignat*}{3}
    \scrS &:=\ \{\,(a,b,c,d)\in\C^4\colon\, f(a,b,c,d)=g(a,b,c,d)\,\}\\
    &=\ \{\,(a,b,c,d)\in\C^4\colon\,a+b\,=\,c+d\,\}.
\end{alignat*}
Note that the elements~$s\in \scrS$
with $0\leq s\leq 1$
form a convex subset of~$\C^4$ that is isomorphic
to an octahedron---this will be essential later.

We claim that the range of~$e\colon \scrE\to\C^4$
is simply the set-theoretic equaliser, $e(\scrE)=\scrS$.
Indeed, surely, $e(\scrE) \subseteq \scrS$.
For the other direction,
let~$v\in \scrS$ be given; we must find~$a\in\scrE$ with~$e(a)=v$.
Since~$e$ is involution preserving,
and so~$\Real{v},\Imag{v}\in\scrS$,
we may assume without loss of generality that~$v$ is self-adjoint.
Since~$v+\|v\|\geq 0$, and~$e$ is unital, 
    we may assume that~$v$ is positive too.
By scaling~$v$ if necessary,
we may assume also that~$0\leq v\leq 1$.
Now, to use the universal property of~$e\colon \scrE\to\C^4$
consider the unique pu-map $p\colon \C^2\to\C^4$
    given by~$p(1,0)=v$.
Since~$v\in \scrS$ we have $f\circ p = g\circ p$,
and so there is a unique $q\colon \C^2\to\scrE$
with $p = e\circ q$.  Then~$v=p(1,0)=e(q(1,0))$,
    and so~$e(\scrE)=\scrS$.

The next thing to note is that~$e$
is injective,
and for this it suffices to show
that~$e$ is injective on $[0,1]_\scrE$.
So let~$a,b\in[0,1]_\scrE$ with~$e(a)=e(b)$ be given;
we must show that~$e(a)=0$.
Let~$p,q\colon \C^2\to\C^4$ be the unique
pu-maps given by~$p(1,0)=a$ and~$q(1,0)=b$,
and note that~$e\circ p = e\circ q$.
Since equalisers are mono, we get~$p=q$, and so~$a=b$.

Thus~$e\colon \scrE\to \C^4$
gives a linear isomorphism from~$\scrE$
onto the 3-dimensional linear subspace~$\scrS$ of~$\scrA$,
so~$\scrE$ is 3-dimensional too.
By the classification of finite-dimensional
$C^*$-algebras, \sref{fdcstar}, 
$\scrE$ must be miu-isomorphic to~$\C^3$.

The map $e\colon \scrE\to\C^4$
is not only injective,
but in fact bipositive (see~\sref{cstar-isometry}).
Indeed,  if $e(a)\leq 0$ for some $a\in[0,1]_\scrE$
we can, as before,
find~$q\colon \C^2 \to \scrE$
with $e(q(1,0))=e(a)$,
and so~$a=q(1,0)\geq 0$.
It follows that~$e$ gives a linear order isomorphism
between~$\scrE$ and the subspace~$\scrS$ of~$\C^4$,
and so $[0,1]_\scrE$ is as convex space
isomorphic to~$\scrS\cap[0,1]_{\C^4}$.
This is problematic,
because on the one
hand
the convex space $[0,1]_\scrE$ being a cube
(because
$\scrE$ is miu-isomorphic to~$\C^3$)
has eight extreme points,
while on the other 
hand~$\scrS\cap[0,1]_{\C^4}$ being
an octahedron
has six extreme points: a contradiction.
\end{point}
\end{parsec}
\subsection{Hereditarily Atomic Von Neumann Algebras}
\begin{parsec}{842}
\begin{point}{10}%
We've seen in~\sref{fdcstar}
that every finite-dimensional von Neumann algebra
is the product of finitely many full matrix algebras.
For our purposes this class is too small,
not admitting interpretations of infinite-dimensional
datatypes,
so we've focused on all von Neumann algebras instead.
There is,
however, a rather modest but very promising subclass
of von Neumann algebras
that does sate our desire for the infinite:
following Kornell
we'll call a von Neumann algebra that is the 
    product of a possibly infinite set
of full matrix algebras
\emph{hereditarily atomic}, see~\sref{def:hereditarily-atomic}.
In his recent paper~\cite{kornell2018quantum}
Kornell develops the position
that these hereditarily atomic von Neumann 
algebras are the ``correct'' quantum generalisation
of sets, and---which is especially relevant to our work---observes
that the category of hereditarily atomic von Neumann 
algebras and the nmiu-maps between
them endowed with the regular 
tensor is monoidal coclosed (see~\cite{kornell2018quantum}, Theorem 9.1.)
This will allow us to build a model of the quantum lambda calculus
not only using all von Neumann algebras,
but also just from the hereditarily atomic ones.

Hereditarily atomic von Neumann algebras
have garnered attention for a completely different reason too:
Selinger observed in Example~2.7 of~\cite{selinger2004towards} 
that the effects of~$M_N$
(and thus of every hereditarily atomic von Neumann algebra)
form a continuous dcpo.
Furber and Weaver have proven recently that the converse also holds:
that every von Neumann algebra~$\scrA$
for which $[0,1]_\scrA$ as dcpo is continuous,
is hereditarily atomic,
see Theorem III.15 of~\cite{furbercontinuous}.
\end{point}
    \begin{point}{20}[def:hereditarily-atomic]{Definition}%
A von Neumann algebra is called \Define{hereditarily atomic}%
\index{von Neumann algebra!hereditarily atomic}%
\index{hereditarily atomic!von Neumann algebra}
if it is nmiu-isomorphic
to a direct sum
$\bigoplus_{i\in I} M_{N_i}$
of possibly infinitely many $M_{N_i}$'s.

We denote by~$\Define{\haW{miu}}$ and  $\Define{\haW{cpsu}}$%
    \index{haWmiu@$\haW{miu},\,\haW{cpsu},\,\dotsc$}
the full subcategories of $\W{miu}$ and $\W{cpsu}$, respectively,
of hereditarily atomic von Neumann algebras.
\end{point}
\begin{point}{30}{Proposition}%
A von Neumann subalgebra~$\scrB$ of a hereditarily atomic
von Neumann algebra~$\scrA$ is itself hereditarily atomic.
\begin{point}{40}{Proof}%
Since~$\scrA$ is hereditarily atomic, 
we may assume without loss of generality
that~$\scrA \equiv \bigoplus_{i \in I} M_{N_i}$
for some family of natural numbers $(N_i)_{i\in I}$.

Note that to show that~$\scrB$ is hereditarily atomic,
it suffices to find a orthogonal family of central
projections $(c_j)_{j\in J}$ in~$\scrB$
with $\sum_j c_j=1$ 
such that  each $c_j\scrB$ is finite-dimensional.
Indeed, then each~$c_j\scrB$ is hereditarily atomic,
and so will be~$\scrB\cong \bigoplus_{j\in J} c_j\scrB$
(see~\sref{central-projections-sums}).

It's even enough to find a family of central projections
$(d_k)_{k\in K}$ in~$\scrB$,
not necessarily orthogonal, but
with $\bigcup_{k\in K} d_k =1$
and each $d_k\scrB$  finite-dimensional.
Indeed, any maximal orthogonal 
family $(c_j)_{j\in J}$
of non-zero central projections in~$\scrB$
for which each~$c_j$ is below some~$d_k$
will have the properties
that $\sum_{j\in J} c_j =1$
and~$c_j\scrB$ be finite-dimensional for every~$j$.

Define $d_j := \ceil{\pi_j\circ e}$
to be the carrier (see~\sref{carrier})
of the inclusion $e\colon \scrB\to\scrA$
followed by the $j$-th projection
$\pi_j\colon \scrA\equiv\bigoplus_{i\in I}M_{N_i}\to M_{N_j}$.
Since $\pi_j\circ e$ is an nmiu-map,
    $d_j$ is a central projection by~\sref{carrier-miu}.
Since there are fewer projection in~$\scrB$ than in~$\scrA$,
we have $\ceil{\pi_j}\leq \ceil{\pi_j\circ e}\equiv d_j$.
Now, since clearly $\sum_{i\in I}\ceil{\pi_i}=1$,
this implies that $\bigcup_{i\in I} d_i =1$.

Let~$i\in I$ be given.
It remains to be shown that~$d_i\scrB$ is finite-dimensional.
To see this, simply note that the restriction
of $\pi_i\circ e$ to a map $d_i\scrB \to M_{N_i}$
    is an injection (by~\sref{carrier-miu})
    into the finite-dimensional space~$M_{N_i}$,
    and so~$d_i\scrB$ is finite-dimensional too.\qed
\end{point}
\end{point}
\begin{point}{50}[ha-equalisers]{Corollary}%
Given nmiu-maps
$f,g\colon \scrA\to\scrB$
between hereditarily atomic
von Neumann algebras~$\scrA$ and~$\scrB$,
the von Neumann subalgebra
\begin{equation*}
    \scrE \ :=\  \{\,a\in\scrA\colon\, f(a)=g(a)\,\}
\end{equation*}
of~$\scrA$
is hereditarily atomic,
and the inclusion~$e\colon \scrE\to\scrA$
is an equaliser of~$f$ and~$g$ both in~$\haW{miu}$
and~$\haW{cpsu}$.
\end{point}
\begin{point}{60}{Remark}%
It follows that~$\haW{miu}$
is the least full subcategory of~$\W{miu}$
closed under limits
that contains all finite-dimensional von Neumann algebras.
\end{point}
\end{parsec}
\section{Normal Functionals}
\begin{parsec}{850}%
\begin{point}{10}%
For our study of the category of von Neumann algebras
we need two more technical results
concerning the normal functionals
on a von Neumann algebra.

The first one,
that a net $(b_\alpha)_\alpha$
in a von Neumann algebra~$\scrA$ is (norm) bounded
provided that $(\omega(b_\alpha))_\alpha$
is bounded for each np-functionals $\omega\colon \scrA\to\C$
(see~\sref{ultraweakly-bounded-implies-bounded}),
ultimately
follows from a type of polar decomposition for 
ultraweakly linear functionals (see~\sref{polar-decomposition-of-functional}).

The second one,
that the ultraweak topology of a von Neumann subalgebra
coincides with the ultraweak topology of the surrounding space
(see~\sref{functional-permanence}),
is proven using the double commutant theorem (\sref{double-commutant})
and requires a lot of hard work.
\end{point}
\end{parsec}
\subsection{Ultraweak Boundedness}
\begin{parsec}{860}%
\begin{point}{10}%
To get a better handle on the normal positive functionals
on a von Neumann algebra,
we first analyse  the not-necessarily-positive normal functionals
in greater detail.
\end{point}
\begin{point}{20}[positive-functional-criterion]{Lemma}%
\index{functional!positive}
A linear map $f\colon \scrA\to \C$
on a $C^*$-algebra~$\scrA$
is positive iff $\|f\|\leq f(1)$.
\begin{point}{30}{Proof}%
(Based on Theorem 4.3.2 of~\cite{kr}.)

If~$f(1)=0$, then~$f=0$ in both cases 
(viz.~$f$ is positive, and~$\|f\|\leq f(1)$),
so
we may assume that~$f(1)\neq 0$.
The problem is easily reduced farther to the case 
that~$f(1)=1$
by replacing~$f$ by~$f(1)^{-1}f$
(noting that~$f(1)\geq 0$ in both cases),
so we'll assume that~$f(1)=1$.
\begin{point}{40}{$f$ positive $\implies$ $\|f\|\leq 1$}%
This follows
immediately from~\sref{cp-russo-dye} and~\sref{cp-commutative},
but here's a concrete proof:
Let~$a\in \scrA$ be given.
Pick~$\lambda\in \C$ with $\left|\lambda\right|=1$
and~$\lambda f(a)\geq 0$.
Then $\left|f(a)\right|=f(\lambda a) 
= \Real{f(\lambda a)}
= f(\Real{(\lambda a)})
\leq f(\|a\|)=\|a\|$,
because $\Real{(\lambda a)}
\leq \|\Real{(\lambda a)}\|
\leq \|\lambda a\|=\|a\|$,
and $f$ is positive.
Hence~$\|f\|\leq 1$.
\end{point}
\begin{point}{50}{$\|f\|\leq 1$ $\implies$ $f$ is positive}%
Let~$a\in [0,1]_\scrA$ be given.
To prove that~$f$ is positive, it suffices to show that $f(a)\geq 0$.
Since $(\Real{f(a)})^\perp
=\Real{(f(a)^\perp)}
\leq \left|f(a)^\perp \right|
=\left|f(a^\perp)\right|\leq 1$,
and therefore $\Real{f(a)}\geq 0$,
we just need to show that~$\Imag{f(a)}=0$.

The trick is to consider $b_n := (a - \Real{f(a)})+ni\Imag{f(a)}$.
Indeed, since $(n+1)^2(\Imag{f(a)})^2
= \left|f(b_n)\right|^2 \leq \|b_n\|^2 = 
\|b_n^*b_n\| \leq \|a-\Real{f(a)}\|^2 + n^2(\Imag{f(a)})^2$,
one sees that $(2n+1)(\Imag{f(a)})^2\leq \|a-\Real{f(a)}\|^2$
for all~$n$,
which is impossible unless~$(\Imag{f(a)})^2=0$,
that is, $\Imag{f(a)}=0$.\qed
\end{point}
\end{point}
\end{point}
\begin{point}{60}[vn-ball-extreme-point]{Lemma}%
\index{unit ball!of a $C^*$-algebra!extreme points}%
An extreme point~$u$ of the unit ball~$(\scrA)_1$
of a $C^*$-algebra~$\scrA$
is a partial isometry with $(uu^*)^\perp\scrA(u^*u)^\perp = \{0\}$.
\begin{point}{70}{Remark}%
The converse (viz.~every such partial isometry
is extreme in~$(\scrA)_1$)
also holds, but we won't need it.
\end{point}
\begin{point}{80}{Proof}%
(Based on Theorem~7.3.1 of~\cite{kr}.)

To show~$u$ is a partial isometry
it suffices to prove that~$u^*u$ is a projection.
Suppose towards a contradiction that~$u^*u$ is not a projection.
Then $u^*u$,
represented
as continuous function (on~$\spec(u^*u)$ cf.~\sref{functional-calculus}),
takes neither the value~$0$ nor~$1$ on a neighbourhood
of some point,
and so by considering a
positive continuous function,
which is sufficiently small but non-zero on this neighbourhood
and zero elsewhere, 
we can find a non-zero element~$a$ 
of the (commutative) $C^*$-subalgebra generated by~$u^*u$
with $0\leq a\leq u^*u$
and $\|u^*u (1\pm a)^2\|\leq 1$,
so that~$\|u(1\pm a)\|\leq 1$.
Since~$u$ is extreme in~$(\scrA)_1$,
and~$u=\frac{1}{2}u(1+a)\,+\,\frac{1}{2}u(1-a)$,
we get~$ua=0$,
and so $0\leq a^2\leq \sqrt{a}u^*u\sqrt{a}=u^*ua=0$,
which contradicts $a\neq 0$.

Let~$a\in (uu^*)^\perp \scrA (u^*u)^\perp$
be given; we must show that $a=0$.
Assume (without loss of generality)
that~$\|a\|\leq 1$.
We'll show that $\|u\pm a\|\leq 1$,
because,
since~$u$ is extreme in~$(\scrA)_1$,
$u\equiv \frac{1}{2}(u+a)+\frac{1}{2}(u-a)$
implies that~$u=u+a$, and so $a=0$.
Note that $a^*a \leq (u^*u)^\perp$ (because $a(u^*u)^\perp=a$)
and $u^*a = 0$ (because $(uu^*)^\perp a=a$).
Thus $(u\pm a)^*(u\pm a)
=u^*u \pm u^* a \pm a^* u + a^*a
= u^*u + a^*a \leq u^*u + (u^*u)^\perp = 1$,
so $\|u\pm a\|\leq 1$. \qed
\end{point}
\end{point}
\begin{point}{90}[polar-decomposition-of-functional]%
	{Theorem (Polar decomposition of functionals)}%
\index{polar decomposition!of a functional}
Every functional $f\colon \scrA\to \C$ on a von Neumann algebra~$\scrA$
which is ultraweakly continuous on
the unit ball~$(\scrA)_1$
is of the form $f\equiv f(uu^*(\,\cdot\,)) = f((\,\cdot\,)u^*u)$
for some partial isometry~$u$ on~$\scrA$
such that $f(u(\,\cdot\,))$
and $f((\,\cdot\,)u)\colon \scrA\to\C$
are positive.
\begin{point}{100}{Proof}%
(Based on Theorem~7.3.2 of~\cite{kr}.) 
\begin{point}{110}%
We'll first show that~$f$ takes the value~$\|f\|$
at some extreme point~$u$ of~$(\scrA)_1$.
To begin, since~$(\scrA)_1$ is ultraweakly compact (\sref{vn-ball-compact}),
and~$f$ is ultraweakly continuous
the subset $\{\,f(a)\colon\,a\in(\scrA)_1\,\}$
of~$\R$ is compact,
and therefore has a largest element, 
which must be~$\|f\|$.
Thus the convex
set~$F:=\{\,a\in(\scrA)_1\colon\, f(a)=\|f\|\,\}$
is non-empty.
Since~$F$ is ultraweakly compact (being an ultraweakly closed
subset of the ultraweakly compact~$(\scrA)_1$),
$F$ has at least one extreme point
by the Krein--Milman Theorem
(see e.g.~Theorem~V7.4 of~\cite{conway2013}), say~$u$.
Note that~$F$ is a face of~$(\scrA)_1$:
if~$\frac{1}{2}a+\frac{1}{2}b\in F$ for some~$a,b\in(\scrA)_1$,
then $\frac{1}{2}f(a)+\frac{1}{2}f(b) = \|f\|$,
so~$f(a)=f(b)=\|f\|$
(since~$\|f\|$ is extreme in $(\C)_{\|f\|}$)
and thus~$a,b\in F$.
It follows that~$u$ is not only extreme in~$F$, but also in~$(\scrA)_1$,
so that~$u$ is an partial isometry with $(uu^*)^\perp\scrA(u^*u)^\perp=\{0\}$
by~\sref{vn-ball-extreme-point}.

Note that $f(u(\,\cdot\,))$
is positive by~\sref{positive-functional-criterion}, because
$\|f(u(\,\cdot\,))\||\leq\|f\|\|u\|\leq\|f\|=f(u)=f(u(1))$.
By a similar argument~$f((\,\cdot\,)u)$
is positive.

Let~$a\in\scrA$ be given.
It remains to be shown that $f(a)=f(uu^*a)=f(au^*u)$.
First note that  $u(u^*u)^\perp = 0$ (since~$u$ is an isometry)
and so $f(u(u^*u)^\perp)=0$,
that is,  $u^*u\geq \ceil{f(u(\,\cdot\,))}$.
This entails that $f(ubu^*u)=f(ub)$ for all~$b\in\scrA$
by~\sref{carrier-fundamental}, and in particular $f(uu^*au^*u)=f(uu^*a)$.

Now, since~$(uu^*)^\perp\scrA(u^*u)^\perp = \{0\}$,
we have $uu^* a u^*u + a = uu^*a + au^*u$,
and thus $f(a)+f(uu^*a)=f(a)+f(uu^*au^*u)=f(uu^*a)+f(au^*u)$,
which yields $f(a)=f(au^*u)$.
By a similar reasoning we get $f(uu^*a)=f(a)$.\qed
\end{point}
\end{point}
\end{point}
\begin{point}{120}[uwcont-on-ball]{Corollary}%
\index{functional!ultraweakly continuous}
A functional $f\colon \scrA\to\C$
on a von Neumann algebra~$\scrA$
is ultraweakly continuous
when it is ultraweakly continuous
on the unit ball~$(\scrA)_1$.
\begin{point}{130}{Proof}%
By~\sref{polar-decomposition-of-functional}
there is a partial isometry~$u$
such that $f(uu^*(\,\cdot\,))=f$
and~$f(u(\,\cdot\,))$ is positive.
Recall from~\sref{p-uwcont} that such a positive functional~$f(u(\,\cdot\,))$
is normal when it is ultraweakly continuous
on~$[0,1]_{\scrA}$;
which it is, 
because $a\mapsto ua$ is ultraweakly continuous (see \sref{mult-uws-cont}),
maps~$[0,1]_{\scrA}$ into~$(\scrA)_1$,
and $f$ is ultraweakly continuous on~$(\scrA)_1$.
But then~$f\equiv f(uu^*(\,\cdot\,))$
being the composition of the ultraweakly continuous maps
$f(u(\,\cdot\,))$ and $a\mapsto u^*a$ 
is ultraweakly continuous on~$\scrA$ too.\qed
\end{point}
\end{point}
\begin{point}{140}[functional-norm]{Lemma}%
Let~$f\colon \scrA\to\C$
be a normal functional
on a von Neumann algebra~$\scrA$,
and let~$u$ be a partial isometry in~$\scrA$
such that~$f(u(\,\cdot\,))$ is positive,
and $f=f(uu^*(\,\cdot\,))$.
Then~$\|f\|=f(u)$.\qed
\begin{point}{150}{Proof}%
Since~$f(u(\,\cdot\,))$ is positive,
we have $\|f(u(\,\cdot\,))\|=f(u)$
by~\sref{cp-russo-dye};
hence $\|f\|=\|f(uu^*(\,\cdot\,))\|
\leq \|f(u(\,\cdot\,))\|\|u^*\|
\equiv f(u) \leq \|f\|$,
and thus~$\|f\|=f(u)$.
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{870}%
\begin{point}{10}{Definition}%
Given a von Neumann algebra~$\scrA$,
the vector space of ultraweakly continuous 
linear maps $f\colon \scrA\to \C$
endowed with the operator norm
is denoted by~$\Define{\scrA_*}$,%
\index{*understar@$\scrA_*$, predual of~$\scrA$}
and called the \Define{predual}%
\index{predual}
of~$\scrA$.
\begin{point}{20}{Remark}%
The reason
that the space~$\scrA_*$ is called the \emph{predual}
of~$\scrA$
is the non-trivial fact due to Sakai~\cite{sakai} (which we 
don't need and therefore won't prove),
that the obvious 
map $\scrA\to(\scrA_*)^*$,
where $(\scrA_*)^*$ is the \emph{dual} of~$\scrA_*$ --- the
vector space of bounded linear maps $\scrA_*\to\C$
endowed with the operator norm ---,
is a surjective isometry,
and so $\scrA$ ``is'' the dual of~$\scrA_*$,
(albeit only as normed space,
because~$(\scrA_*)^*$ doesn't come equipped with a multiplication.)

We will need this:
\end{point}
\end{point}
\begin{point}{30}[predual-complete]{Proposition}%
The predual~$\scrA_*$ of a von Neumann algebra~$\scrA$
is complete (with respect to the operator norm).
\begin{point}{40}{Proof}%
Let $f_1,f_2,\dotsc$ be a sequence in~$\scrA_*$
which is Cauchy with respect to the operator norm.
We already know (from~\sref{operator-norm-complete})
that $f_1,f_2,\dotsc$ converges to a bounded linear 
functional~$f\colon \scrA\to\C$;
so we only need to prove that~$f$ is ultraweakly continuous
to see that~$\scrA_*$ is complete,
and for this,
we only need to show 
(by~\sref{uwcont-on-ball})
that~$f$
is ultraweakly continuous
on the unit ball~$(\scrA)_1$ of~$\scrA$.
So let~$(b_\alpha)_\alpha$ be 
a net in~$(\scrA)_1$
which converges ultraweakly to~$0$;
we must show that~$\lim_\alpha f(b_\alpha)=0$.
Now, note that for every~$n$ and~$\alpha$
we have the bound
\begin{equation*}
	\left|f(b_\alpha)\right|
	\ \leq\ \left|(f-f_n)(b_\alpha)\right|
	\,+\,\left|f_n(b_\alpha)\right|
	\ \leq\ 
	\|f-f_n\|\,+\,\left|f_n(b_\alpha)\right|.
\end{equation*}
From this,
and $\lim_n\|f-f_n\|=0$,
and $\lim_\alpha f_n(b_\alpha)=0$
for all~$n$,
one easily deduces that~$\lim_\alpha f(b_\alpha)=0$.
Thus~$f$ is ultraweakly continuous,
and so~$\scrA_*$ is complete.\qed
\end{point}
\end{point}
\begin{point}{50}%
Note
that for a self-adjoint
element~$a$ of a von Neumann algebra~$\scrA$
we have $\|a\|=\sup_\omega \left|\omega(a)\right|$
where~$\omega$ ranges
over the npsu-functionals,
but that the same identity does not need to hold
for arbitrary (not necessarily self-adjoint) $a\in \scrA$.
The following lemma shows
that this restriction to self-adjoint elements
can be lifted 
by letting~$\omega$
range over all of~$\scrA_*$.
\end{point}
\begin{point}{60}[norm-predual]{Lemma}%
We have $\|a\|=\sup_{f\in(\scrA_*)_1}\left|f(a)\right|$
for every element~$a$ of a von Neumann algebra~$\scrA$.
\begin{point}{70}{Proof}%
It's clear that $\sup_{f\in(\scrA_*)_1}\left|f(a)\right|\leq \|a\|$.

For the other direction,
write $a\equiv [a] \sqrt{a^*a}$ (see~\sref{polar-decomposition})
and note that $\|a\|=\|\sqrt{a^*a}\|=\sup_{\omega\in \Omega} 
\left|\omega (\,\sqrt{a^*a}\,)\right|$,
where $\Omega$ is the set of  npu-maps $\scrA\to \C$
(which is order separating).
Let~$\omega\in \Omega$ be given.
Since~$[a]^*a=\sqrt{a^*a}$ 
we have $\omega(\,\sqrt{a^*a}\,)=\omega([a]^*a)=f(a)$,
where $f:=\omega([a]^*(\,\cdot\,))\in (\scrA_*)_1$,
and so $\|a\|=\sup_{\omega\in\Omega} 
\omega(\,\sqrt{a^*a}\,) \leq \sup_{f\in (\scrA_*)_1}
\left|f(a)\right|$.\qed
\end{point}
\end{point}
\begin{point}{80}[ultraweakly-bounded-implies-bounded]{Theorem}%
A net  $(b_\alpha)_\alpha$
 in a von Neumann algebra~$\scrA$
is norm bounded
(that is,~$\sup_\alpha \|b_\alpha\|<\infty$)
provided it is \Define{ultraweakly bounded}, i.e.,%
\index{ultraweakly bounded net}
$\sup_\alpha \left|\omega(b_\alpha)\right|<\infty$
	for every np(u)-map $\omega\colon \scrA\to \C$.
\begin{point}{90}{Proof}%
Note that $f\mapsto f(b_\alpha)$
gives a linear map $(\,\cdot\,)(b_\alpha)\colon \scrA_*\to\C$
with $\|(\,\cdot\,)(b_\alpha)\|=\|b_\alpha\|$ 
by~\sref{norm-predual}
for each~$\alpha$.
So to prove that~$(b_\alpha)_\alpha$
is norm bounded, viz.~%
$\sup_\alpha \|b_\alpha\|\equiv \sup_\alpha \|(\,\cdot\,)(b_\alpha)\|<\infty$,
it suffices to show
(by the principle of uniform boundedness, \sref{pub},
using that~$\scrA_*$ is complete, \sref{predual-complete}),
that $\sup_\alpha \left|f(b_\alpha)\right|<\infty$ for all~$f\in\scrA_*$.

Since such~$f\in\scrA_*$
can be written as $f\equiv \sum_{k=0}^3 i^k \omega_k$
where $\omega_k\colon \scrA\to\C$ are np-maps
(by~\sref{normal-functionals-lemma}),
we see that $\sup_\alpha\left|f(b_\alpha)\right|
\leq \sum_{k=0}^3\sup_\alpha \left|\omega_k(b_\alpha)\right|
<\infty$, because~$(b_\alpha)_\alpha$
is ultraweakly bounded.
Thus~$(b_\alpha)_\alpha$
is norm bounded.\qed
\end{point}
\end{point}
\end{parsec}
\subsection{Ultraweak Permanence}
\begin{parsec}{880}%
\begin{point}{10}%
We turn to 
a subtle, and surprisingly difficult matter:
it is not immediately clear
that the ultraweak topology on a von Neumann
subalgebra~$\scrA$ of a von Neumann algebra~$\scrB$,
coincides (on~$\scrA$) with the ultraweak topology on~$\scrB$.
While it is easily seen that the former is finer
(that is, a net in~$\scrA$ which converges ultraweakly in~$\scrA$,
converges ultraweakly in~$\scrB$ too, because any np-map 
$\omega\colon \scrB\to\C$ is also an np-map restricted to~$\scrA$),
it is not obvious that an np-map $\omega\colon \scrA\to\C$
can be extended to an np-map on~$\scrB$
--- but it can, as we'll see~\sref{functional-permanence}.
We'll call this independence of the ultraweak topology
from the surrounding space
\emph{ultraweak permanence}
being not unlike the independence
of the spectrum of an operator from the surrounding space
known as spectral permanence (\sref{spectral-permanence}).


It is tempting to think that the extension of an np-map~$\omega\colon \scrA
\to\C$
on a von Neumann
subalgebra~$\scrA$ of a von Neumann algebra~$\scrB$
to~$\scrB$ is simply a matter of applying Hahn--Banach to~$\omega$,
but this approach presents two problems:
it yields a normal but not necessarily positive extension
of~$\omega$;
and it not clear that~$\omega$ is ultraweakly continuous
on~$\scrA$ (that is, whether Hahn--Banach applies).

Instead of applying general techniques we feel forced
to delve deeper
into the particular structure 
provided to us by von Neumann algebras
(namely the commutant, \sref{commutant})
to show that any np-map
$\omega\colon \scrA\to\C$
on a von Neumann algebra~$\scrA$
of bounded operators on a Hilbert space~$\scrH$
can be extended to an np-map on~$\scrB(\scrH)$,
and in fact, is of the form
$\omega\equiv \sum_n \left<x_n,(\,\cdot\,)x_n\right>$
for some $x_1,x_2,\dotsc \in\scrH$, see~\sref{normal-functional}.
\end{point}
\begin{point}{20}[commutant-ceil]{Proposition}%
Let~$S$ be a subset of a von Neumann algebra~$\scrA$
that is closed under multiplication, involution, and contains~$1$.
Let~$e$ be a projection in~$\scrA$.
Then $\Define{\ceil{e}_{S^\square}}= 
\bigcup_{a\in S} \ceil{a^* e a}$%
\index{*ceils@$\ceil{e}_S$}
is the least projection in~$S^\square$
above~$e$.

(Compare this with the paragraph ``Subspaces'' of \S2.6 of~\cite{kr}.)
\begin{point}{30}{Proof}%
Let us first show that~$p:= \ceil{e}_{S^\square}$
is in~$S^\square$.
Let $b\in S$ be given;
we must show that $pb=bp$.
We may may assume without loss of generality that~$\|b\|\leq 1$.
Since~$b^*(\,\cdot\,)b\colon \scrA\to\scrA$
is normal and completely positive,
and $p=\bigcup_{a\in S} \ceil{a^*ea}$,
we have $b^*pb\leq \ceil{b^*pb} = 
\bigcup_{a\in S} \ceil{ b^* \ceil{a^* e a} b }
= \bigcup_{a\in S} \ceil{(ab)^* \,e\, ab} \leq p$
by~\sref{ncp-union} and~\sref{ncp-ceil}.
Applying $p^\perp(\,\cdot\,)p^\perp$,
we get $p^\perp b^*pb p^\perp 
\leq p^\perp p p^\perp = 0$,
so that $pbp^\perp=0$,
and thus $pbp=pb$.
Since similarly $pb^* =pb^*p$,
we get  $bp=pbp=pb$
(upon applying~$(\,\cdot\,)^*$) and so~$p\in S^\square$.

Note that~$e\leq \ceil{1^* e 1}\leq p$, because $1\in S$.
It remains to be shown that~$p$ is the least projection in~$S^\square$
above~$e$, so let~$q$ be a projection in~$S^\square$ above~$e$.
Since for~$a\in S$,
we have~$aq^\perp a^*=  q^\perp aa^* q^\perp 
\leq \|a\|^2q^\perp \leq \|a\|^2e^\perp$,
and so $a^*ea\leq \|a\|^2q$ 
we get~$\ceil{a^*ea}\leq q$
for all~$a\in S$,
and thus~$p=\bigcup_{a\in S}\ceil{a^*ea} \leq q$.\qed
\end{point}
\end{point}
\begin{point}{40}[carrier-vector-state]{Exercise}%
Show that given a vector~$x$ of Hilbert space~$\scrH$,
and a collection~$S$ of bounded operators on~$\scrH$
that is closed under addition, (scalar) multiplication,
involution, and contains the identity operator,
the following coincide.
\begin{enumerate}
\item
$\ceil{\,\ketbra{x}{x}\,}_{S^\square}$,
the least projection in~$S^\square$
above $\ceil{\,\ketbra{x}{x}\,}$;
\item
$\ceil{\,\left<x,(\,\cdot\,)x\right>|S^\square\,}$,
the carrier of the vector functional on~$S^\square$
given by~$x$;
\item
$\bigcup_{a\in S} \ceil{\,\ketbra{ax}{ax}\,}$; and 
\item
the projection on~$\overline{S x}$.
\end{enumerate}
Conclude that $\overline{S^{\square\square}x}
=\overline{S x}$.
(Hint: $S^{\square\square\square}=S^\square$.)
\begin{point}{50}[proto-double-commutant]%
Now consider
(instead of~$x$)
an np-map $\omega\colon \scrB(\scrH)\to \C$,
which we know must be of the form
$\omega\equiv \sum_n \left<x_n,(\,\cdot\,)x_n\right>$
(by~\sref{bh-np})
and is therefore given by 
an element $x'\equiv (x_1,x_2,\dotsc)$ of the $\N$-fold
product~$\scrH':=\bigoplus_n\scrH$ of~$\scrH$.
\begin{enumerate}
\item
Show that  $\omega(t)=\left<x',\varrho'(t)x'\right>$,
where $\varrho'\colon \scrB(\scrH)\to\scrB(\scrH')$
is the nmiu-map given by 
$\varrho'(t)y=(ty_n)_n$
for all~$t\in\scrB(\scrH)$ and~$y\in\scrH'$.

Prove that $\varrho'(t)=\sum_n P_n^* t P_n$,
where $P_n:=\pi_n\colon \scrH'\equiv \bigoplus_n\scrH\to\scrH$
is the $n$-th projection.
\item

Let~$t\in S^{\square\square}$ be given
(with~$S$ as above).
Show that $\varrho'(t)\in \varrho'(S)^{\square\square}$.

(Hint: first show 
	$P_n aP_m^*\in S^\square$ for all~$m$, $n$, and
		$a\in \varrho'(S)^\square$.)

Conclude that  $\varrho'(t)x'\,\in\,\overline{\varrho'(S)^{\square\square}x'}
\equiv \overline{\varrho'(S)x'}$.

Whence for every~$\varepsilon>0$
one can find~$a\in S$ with $\|t-a\|_\omega \leq \varepsilon$.

\item
Deduce that $S^{\square\square}$
is contained in the ultrastrong closure of~$S$.
\end{enumerate}
\spacingfix
\end{point}%
\end{point}%
\begin{point}{60}[double-commutant]{Double Commutant Theorem}%
\index{Double Commutant Theorem}%
\index{Bicommutant Theorem}
For a collection~$S$ of bounded operators
on a Hilbert space~$\scrH$
that is closed under addition, (scalar) multiplication,
involution, and contains the identity operator
the following are the same.
\begin{enumerate}
\item
$S^{\square\square}$, the ``double commutant'' of~$S$
in~$\scrB(\scrH)$;
\item
$\mathrm{us}\text{-}\mathrm{cl}(S)$,
the ultrastrong closure of~$S$ in~$\scrB(\scrH)$;
\item
$\mathrm{uw}\text{-}\mathrm{cl}(S)$,
the ultraweak closure of~$S$ in~$\scrB(\scrH)$;
\item
$W^*(S)$,
the least von Neumann subalgebra of~$\scrB(\scrH)$
that contains~$S$.
\end{enumerate}
\begin{point}{70}{Proof}%
(Based on Theorem~5.3.1 of~\cite{kr}.) 

Note that: $\mathrm{us}\text{-}\mathrm{cl}(S)
\subseteq  \mathrm{uw}\text{-}\mathrm{cl}(S)$,
because ultrastrong convergence implies ultraweak convergence;
and
$\mathrm{uw}\text{-}\mathrm{cl}(S)
\subseteq W^*(S)$,
because~$W^*(S)$ 
is ultraweakly closed in~$\scrB(\scrH)$ by~\sref{vnsac};
and
$W^*(S)\subseteq S^{\square\square}$,
because 
$S^{\square\square}$ is a von Neumann subalgebra
of~$\scrB(\scrH)$ by~\sref{commutant-basic};
and, finally, $S^{\square\square}\subseteq \mathrm{us}\text{-}\mathrm{cl}(S)$
by~\sref{proto-double-commutant}.\qed
\end{point}
\end{point}
\begin{point}{80}[centre-commutant]{Exercise}
Show that central elements of
a von Neumann algebra~$\scrA$
of bounded operators on a Hilbert space~$\scrH$
coincide with the central elements of the commutant~$\scrA^\square$,
that is, $Z(\scrA)=Z(\scrA^\square)$.
(Hint: $\scrA^{\square\square}=\scrA$ by~\sref{double-commutant}.)
\begin{point}{90}[commutant-cceil]%
Deduce that~$\cceil{f|\scrA}=\cceil{f|\scrA^\square}$
for every np-map~$f\colon \scrB(\scrH)\to\scrB$ 
into a von Neumann algebra~$\scrB$.
\end{point}
\end{point}
\end{parsec}%
\begin{parsec}{890}%
\begin{point}{10}[gns-mapping-property]{Lemma}%
Let~$\omega\colon \scrA\to\C$
be an np-map on a von Neumann algebra~$\scrA$,
which is represented by nmiu-maps
$\varrho\colon \scrA\to\scrB(\scrH)$
and $\pi\colon \scrA\to\scrB(\scrK)$
on Hilbert spaces~$\scrH$ and~$\scrK$.
If $\left<x,\varrho(\,\cdot\,)x\right>
=\omega=\left<y,\pi(\,\cdot\,)y\right>$
for some  $x\in\scrH$ and~$y\in\scrK$,
then there is a bounded operator $U\colon \scrK\to\scrH$
for which~$UU^*$ is the projection
on~$\overline{\varrho(\scrA)x}$,
$U^*U$ is the projection
on~$\overline{\pi(\scrA)y}$,
and~$U\pi(a)=\varrho(a)U$
for all~$a\in\scrA$.
\begin{point}{20}{Proof}%
(Compare this with Proposition 4.5.3 of~\cite{kr}.)

Since $\|\varrho(a)x\|^2
= \left<x,\varrho(a^*a)x\right>
=\omega(a^*a)=\left<y,\pi(a^*a)y\right>
= \|\pi(a)y\|^2$ for all~$a\in\scrA$,
there is a unique bounded operator $V\colon \overline{\pi(\scrA)y}
\to \overline{\varrho(\scrA)x}$
with $V\pi(a)y = \varrho(a)x$ for all~$a\in\scrA$.
A moment's thought reveals
	that $V$ is a unitary (and so~$V^*V=1$ and $VV^*=1$.)
Now, define $U:=EVF^*$
where $E\colon \overline{\varrho(\scrA)x}\to\scrH$
and $F\colon \overline{\pi(\scrA)y}\to\scrK$
are the inclusions
(and so~$E^*E=1$ and~$F^*F=1$).
Then $UU^*= EVF^*FV^*E^*=EVV^*E^*=EE^*$
is the projection onto~$\overline{\varrho(\scrA)x}$,
and $UU^*=FF^*$
is the projection onto~$\overline{\pi(\scrA)y}$.

Let~$a\in\scrA$ be given.
It remains to be shown that
$U\pi(a)=\varrho(a)U$.
To this end,
observe that
$V F^* \pi(a) F = E^* \varrho(a) E V$
(because 
these two bounded linear maps
are easily seen to
agree on the dense subset $\pi(\scrA)y$
of $\overline{\pi(\scrA)y}$);
and $\varrho(a)E = EE^*\varrho(a)E$
(because $\varrho(a)$ maps $\varrho(\scrA)x$ into~$\varrho(\scrA)x$);
and similarly $\varrho(a^*)F=FF^*\varrho(a^*) F$,
so that $F^*\varrho(a) = F^* \varrho(a) FF^*$
(upon application of the~$(\,\cdot\,)^*$).
By these observations,  $U\pi(a)=
EVF^*\pi(a)=EVF^*\pi(a) FF^*
= EE^*\varrho(a)EVF^*
= \varrho(a)EVF^*
= \varrho(a)U$.\qed
\end{point}
\end{point}
\begin{point}{30}[summing-partial-isometries]{Exercise}%
It is not too difficult 
to see that the (ultraweak) sum~$\sum_i u_i$
of a collection $(u_i)_i$ 
of partial isometries from some von Neumann algebra
is again a partial isometry, 
provided that the initial projections $u_i^*u_i$
are pairwise orthogonal,
and the final projections~$u_iu_i^*$ are pairwise orthogonal.
In this exercise, you'll establish a similar result,
but for partial isometries between two different Hilbert spaces,
and avoiding the use of an analogue of 
the ultraweak topology for such operators.
\begin{point}{40}%
Let~$\scrH$ and~$\scrK$ be Hilbert spaces,
and 
let $U_i\colon \scrH\to\scrK$
be a bounded operator
for every element~$i$ from some set~$I$.
Assume that the operators~$U_i^*U_i$
are pairwise orthogonal projections in~$\scrB(\scrK)$,
and that~$U_iU_i^*$ are pairwise orthogonal projections in~$\scrB(\scrH)$.
\begin{enumerate}
\item
Let~$x\in\scrH$ and~$y\in\scrK$ be given.

Show that
$\left|\left<x,U_iy\right>\right|
\leq \|U_i^*x\| \|U_i y \|$
for each~$i$
(perhaps by first proving that  $U_i = U_i U_i^* U_i$).

Show that~$\sum_i \|U_i y\|^2 \leq \|y\|^2$
and $\sum_i \|U_i^* x\|^2\leq \|x\|^2$,
and deduce from this
that $\sum_i \left|\left<x,U_i y\right>\right| \leq \|x\|\|y\|$.

Now use~\sref{chilb-form-representation}
to show that there is a bounded operator~$U\colon \scrK\to\scrH$
with $\left<x,Uy\right>
= \sum_i \left<x,U_iy\right>$
for all~$x\in\scrH$ and~$y\in \scrK$.
\item
Show that~$U_i^*U_j = 0$ when~$i\neq j$.
Deduce from this that~$U^*U = \sum_i U_i^* U_i$.

Prove that $UU^* = \sum_i U_iU_i^*$.
\end{enumerate}
\spacingfix%
\end{point}%
\end{point}%
\begin{point}{50}[sigma-weak-lemma-2]{Lemma}%
Let~$\Omega$ be a collection of np-maps $\omega\colon \scrA\to\C$
on a von Neumann algebra~$\scrA$ 
whose central carriers,  $\cceil{\omega}$, are pairwise orthogonal to one another,
and let~$\scrH$ and~$\scrK$ be Hilbert spaces
on which~$\scrA$ is represented such
that each~$\omega\in\Omega$ 
is given by vectors $x_\omega\in\scrH$ and $y_\omega\in\scrK$,
that is,
$\left<x_\omega,\varrho(\,\cdot\,)x_\omega\right>
=\omega = \left<y_\omega,\pi(\,\cdot\,)y_\omega\right>$,
where $\varrho\colon \scrA\to\scrB(\scrH)$
and $\pi\colon \scrA\to\scrB(\scrK)$
are nmiu-maps.

Then there is a bounded operator $U\colon \scrK\to\scrH$
which intertwines~$\pi$ and~$\varrho$
in the sense that $U \pi(a)=\varrho(a) U$
for all~$a\in \scrA$
such that~$U^*U$
is a projection in
$\pi(\scrA)^\square$
with
$\cceil{U^*U}_{\pi(\scrA)^\square}=\pi(\sum_\omega \cceil{\omega})$,
and 
$UU^*$
is projection in
$\varrho(\scrA)^\square$
with
$\cceil{UU^*}_{\varrho(\scrA)^\square}=\varrho(\sum_\omega \cceil{\omega})$.
\begin{point}{60}{Proof}%
Given~$\omega\in\Omega$,
let $\sigma_\omega\colon \varrho(\scrA)\to \C$
and $\sigma_\omega'\colon \varrho(\scrA)^\square\to\C$
denote the restrictions
of the vector functional $\left<x_\omega,(\,\cdot\,)x_\omega\right>
\colon \scrB(\scrH)\to\C$,
and let  $\tau_\omega\colon \pi(\scrA)\to \C$
and $\tau_\omega'\colon \pi(\scrA)^\square\to\C$
be similar restrictions
of $\left<y_\omega,(\,\cdot\,)y_\omega\right>$.
We already know (by~\sref{gns-mapping-property}
and~\sref{carrier-vector-state})
that
there is
a bounded operator $U_\omega\colon \scrK\to\scrH$
with $U_\omega^*U_\omega = \ceil{\tau_\omega'}$,
$U_\omega U_\omega^* = \ceil{\sigma_\omega'}$,
and $U_\omega \pi(a) = \varrho(a) U_\omega$
for all~$a\in\scrA$.

We'll combine these $U_\omega$s into one operator~$U$
using~\sref{summing-partial-isometries}, but for this we must
verify that the projections $U_\omega U_\omega^*=\ceil{\sigma_\omega'}$
are pairwise orthogonal,
and that the projections $U_\omega^* U_\omega$
are pairwise orthogonal too.
To this end note that
$\cceil{\sigma_\omega}=\cceil{\sigma_\omega'}$
by~\sref{commutant-cceil}.
Thus, since the projections~$\cceil{\omega}$
are orthogonal to one another,
and $\ceil{\sigma_\omega'}\leq \cceil{\sigma_\omega'}
= \cceil{\sigma_\omega} =\varrho(\cceil{\omega})$,
we see that the projections~$U_\omega U^*_\omega \equiv 
\ceil{\sigma_\omega'}$
are indeed pairwise orthogonal.
Since for a similar reason
the projections $U^*_\omega U_\omega
\equiv \ceil{\tau_\omega'}$ are pairwise orthogonal too,
there is by~\sref{summing-partial-isometries}
a bounded operator $U\colon \scrK\to\scrH$
with 
$U^*U = \sum_\omega U_\omega^* U_\omega$,
$UU^* = \sum_\omega U_\omega U_\omega^*$,
and $\left<x,Uy\right>=\sum_\omega \left<x,U_\omega y\right>$
for all~$x\in\scrH$ and~$y\in \scrK$.

Let us check that~$U$ has the desired properties.
To begin, since the projections
$\cceil{U_\omega U^*_\omega}=\cceil{\sigma_\omega'}=\varrho(\cceil{\omega})$
are pairwise orthogonal,
we have $\cceil{U U^*}=\sum_\omega \cceil{U_\omega U^*_\omega}
=  \varrho(\sum_\omega \cceil{\omega})$
by~\sref{cceil-basic} and
\sref{sum-of-orthogonal-projections}.
Similarly, $\cceil{U^*U}= \pi(\sum_\omega \cceil{\omega})$.

Finally,
given~$a\in\scrA$
we have $U\pi(a)=\varrho(a)U$,
because $\left<x,U\pi(a)y\right>
= \sum_\omega \left<x,U_\omega \pi(a)y\right>
= \sum_\omega \left<x,\varrho(a) U_\omega y\right>
= \sum_\omega \left<\varrho(a)^* x, U_\omega y\right>
= \left<\varrho(a)^* x, U y\right>
= \left<x, \varrho(a) U y\right>$
for all~$x\in\scrH$ and~$y\in\scrK$.\qed
\end{point}
\end{point}
\begin{point}{70}[sigma-weak-lemma]{Corollary}%
Let~$\scrA$ be a von Neumann 
of bounded operators on some Hilbert space~$\scrH$,
and let~$\varrho\colon \scrA\to\scrB(\scrH)$
denote the inclusion.
Let~$\Omega$ be the collection of all np-maps $\scrA\to\C$,
and let $\varrho_\Omega\colon \scrA\to\scrB(\scrH_\Omega)$
be as in~\sref{gelfand-naimark-representation}.

There is a bounded operator $U\colon \scrH_\Omega\to\scrH$
such that $U^*U$ is a projection
in~$\varrho_\Omega(\scrA)^\square$
with 
$\cceil{U^*U}_{\varrho_\Omega(\scrA)^\square}=1$
and
$U\varrho_\Omega(a)= \varrho(a) U$
for all~$a\in\scrA$.
\begin{point}{80}{Proof}%
Let $\{x_i\}_i$ be a maximal set of vectors
in~$\scrH$ 
such that the 
central carriers~$\cceil{\omega_i}$
of the corresponding vector functionals
$\omega_i :=\left<x_i,\varrho(\,\cdot\,)x_i\right>$
on~$\scrA$
are pairwise orthogonal;
so that we'll 
have $\sum_i \cceil{\omega_i}=1$.
Now, the point of~$\scrH_\Omega$ 
is that there are vectors $y_i\in\scrH_\Omega$
with $\omega_i=\left<y_i,\varrho_\Omega(\,\cdot\,)y_i\right>$
for each~$i$.
Now apply~\sref{sigma-weak-lemma-2}
to get a map~$U\colon \scrH_\Omega\to \scrH$
with the desired properties.\qed
\end{point}
\end{point}
\begin{point}{90}[normal-functional]{Theorem}%
\index{functional!positive!normal}%
\index{normal!positive functional}%
Every np-map $\omega\colon \scrA\to\C$
on a von Neumann subalgebra~$\scrA$
of~$\scrB(\scrH)$,
where~$\scrH$ is some Hilbert space,
is of the 
form~$\omega \equiv \sum_n \left<x_n,(\,\cdot\,)x_n\right>$
for some $x_1,x_2,\dotsc \in\scrH$
(with $\sum_n\|x_n\|^2<\infty$).
\begin{point}{100}{Proof}%
(Based on Theorem~7.1.8 of~\cite{kr}.)

Let~$\varrho\colon \scrA\to\scrB(\scrH)$
denote the inclusion,
and let~$U\colon \scrH_\Omega\to\scrH$
be as in~\sref{sigma-weak-lemma}.
Since~$\omega\in\Omega$,
there is~$y\in\scrH_\Omega$
with $\omega = \left<y,\varrho_\Omega(\,\cdot\,)y\right>$.
We're going to `transfer'~$y$ from~$\scrH_\Omega$ to~$\scrH$
using the following device.
Since~$1=\cceil{U^*U}_{\varrho_\Omega(\scrA)^\square}$,
we can 
(by~\sref{cceil-sum})
find partial isometries $(v_i)_i$ in
$\varrho_\Omega(\scrA)^\square$
with $1=\sum_i v_i^*v_i$
and $v_iv_i^*\leq U^*U$
for all~$i$.
Then for every~$a\in\scrA$,
\begin{alignat*}{3}
	\textstyle
\omega(a)\  &=\
	\textstyle
	\left<\,y, \,\varrho_\Omega(a)y\,\right> 
	\\
&= 
	\textstyle
	\ \sum_i \left<\,y,\,  v_i^*v_i\, \varrho_\Omega(a) y \,\right>
	&&\qquad 
	\textstyle
	\text{since $1=\sum_i v_i^*v_i$}
	\\
&= 
	\textstyle
	\ \sum_i \left<\,y,\,  v_i^* U^*Uv_i \,\varrho_\Omega(a)y\, \right>
	&&\qquad\text{since $v_iv_i^*\leq U^*U$}
	\\
	&= 
	\textstyle
	\ \sum_i \left<\,Uv_i y,\, U \varrho_\Omega(a)v_i y\, \right>
	&&\qquad\text{since $v_i \in \varrho(\scrA)^\square$}
	\\
	&= 
	\textstyle
	\ \sum_i \left<\,Uv_i y,\, \varrho(a) \, Uv_i y\, \right>
	&&\qquad\text{since $U\varrho_\Omega(a)=\varrho(a) U$}.
\end{alignat*}
In particular, $\omega(1)=\sum_i \|Uv_i y\|^2$,
so at most countably many $Uv_iy$'s are non-zero;
and denoting those by~$x_1,x_2,\dotsc$,
we get $\omega = \sum_n \left<x_n,(\,\cdot\,)x_n\right>$.\qed
\end{point}
\end{point}
\begin{point}{110}[functional-permanence]{Corollary}%
Let~$\scrA$ be a von Neumann subalgebra
of a von Neumann algebra~$\scrB$.
\begin{enumerate}
\item
For every np-map $\omega\colon \scrA\to\C$
there is an np-map $\xi\colon \scrB\to\C$
with $\xi|\scrA=\omega$.
\item%
\index{ultraweak and ultrastrong!permanence}
\Define{Ultraweak permanence:}\ 
the restriction of the ultraweak topology on~$\scrB$
to~$\scrA$ coincides with the ultraweak topology on~$\scrA$.
\item
\Define{Ultrastrong permanence:}\ 
the restriction of the ultrastrong topology on~$\scrB$
to~$\scrA$ coincides with the ultrastrong topology on~$\scrA$.
\end{enumerate}%
\spacingfix%
\end{point}%
\begin{point}{120}[functional-extension]{Exercise}%
Let $\varrho\colon \scrA\to\scrB$
be an injective nmiu-map.

Show 
using~\sref{injective-nmiu-iso-on-image}
that any np-functional
$\omega\colon \scrA\to\C$
can be extended along~$\varrho$,
that is,
there is an np-functional
$\omega'\colon \scrB\to\C$
with $\varrho\circ \omega' = \omega$.
\end{point}
\end{parsec}
\begin{parsec}{900}%
\begin{point}{10}%
We end the chapter 
with another corollary to~\sref{normal-functional}:
 that  the np-functionals
on a von Neumann algebra
are generated (in a certain sense)
by any centre separating collection
of functionals. This fact plays
an important role
in the next chapter
for our definition of the tensor product
of von Neumann algebras
(on which the product functionals are to be centre separating,
\sref{tensor}).
\end{point}
\begin{point}{20}[vn-center-separating-fundamental]{Proposition}%
\index{centre separating collection!of np-functionals}
Given a centre separating collection~$\Omega$ of np-functionals
on a von Neumann algebra~$\scrA$,
and an ultrastrongly dense subset~$S$ of~$\scrA$
\begin{enumerate}
\item
	\label{vn-center-separating-fundamental-1}
$\Omega':= \{\,\omega(s^*(\,\cdot\,)s)\colon\,
\omega\in\Omega,\,s\in S\,\}$
is order separating, and
\item
	\label{vn-center-separating-fundamental-2}
$\Omega'':=\{\,\sum_n\omega_n\colon\, \omega_1,\dotsc,\omega_N\in\Omega'\,\}$ is operator norm dense in $(\scrA_*)_+$.
\end{enumerate}
\spacingfix%
\begin{point}{30}[vn-center-separating-fundamental-i]{Proof}%
We tackle~\ref{vn-center-separating-fundamental-1}
first. We already know from~\sref{proto-gelfand-naimark}
that the collection $\Xi:=\{\, \omega(a^*(\,\cdot\,)a)\colon\, 
\omega\in\Omega,\, a\in\scrA\,\}$,
which contains~$\Omega'$, is order separating;
so to prove that~$\Omega'$ is itself order separating
it suffices by~\sref{order-separating-dense-subset} to show that~$\Omega'$
is norm dense in~$\Xi$.
This is indeed the case
since given~$a\in\scrA$
and~$\omega\in\Omega$,
and a net~$(s_\alpha)_\alpha$ in~$S$
that converges ultrastrongly to~$a$,
the functionals~$s_\alpha \ast\omega
\equiv \omega(s_\alpha^*(\,\cdot\,)s_\alpha)$
converge in norm to~$a\ast \omega$
as $\alpha\to\infty$
by~\sref{bstaromega-basic}.%
\begin{point}{40}{Concerning~\ref{vn-center-separating-fundamental-2}}%
Let~$f\colon \scrA\to\C$ be an np-map;
we must show that~$f$ is in 
the norm closure~$\overline{\Omega''}$ of~$\Omega''$.
Note that since~$\Omega$ is centre separating,
the map $\varrho_\Omega\colon \scrA\to\scrB(\scrH_\Omega)$
from~\sref{proto-gelfand-naimark}
is injective,
and in fact restricts
to an nmiu-isomorphism
from~$\scrA$ onto $\varrho_\Omega(\scrA)$
(cf.~\sref{ngns}).
So by~\sref{normal-functional}
$f$ is of the form $f\equiv 
\sum_n \left<x_n,\varrho_\Omega(\,\cdot\,)x_n\right>$
for some $x_1,x_2,\dotsc \in\scrH_\Omega$
with $\sum_n \|x_n\|^2<\infty$,
so that the partial sums
$\sum_{n=1}^N \left<x_n,\varrho_\Omega(\,\cdot\,)x_n\right>$
converge with respect to the operator norm to~$f$
(by~\sref{vector-functional-convergence}).
Thus to show that~$f$ is in~$\overline{\Omega''}$
it suffices to show that each~$\left<x_n,\varrho_\Omega(\,\cdot\,)x_n\right>$
is in~$\overline{\Omega''}$
(since~$\overline{\Omega''}$ is clearly closed
under finite sums and norm limits).
In effect
we may assume 
without loss of generality
that~$f\equiv \left<x,\varrho_\Omega(\,\cdot\,)x\right>$
for some~$x\in \scrH_\Omega$.
We reduce the problem some more.
By definition 
of $\scrH_\omega\equiv \bigoplus_{\omega\in\Omega}\scrH_\omega$
and~$\varrho_\Omega$,
we have $f=\left<x,\varrho_\Omega(\,\cdot\,)x\right>
= \sum_{\omega\in \Omega} 
\left<x_\omega,\varrho_\omega(\,\cdot\,)x_\omega\right>$;
and so we may, by the same token, assume without loss of generality
that $f=\left<x,\varrho_\omega(\,\cdot\,)x\right>$
for some~$\omega\in \Omega$
and~$x\in \scrH_\omega$.
Since such~$x$ (by definition of~$\scrH_\omega$, 
\sref{gns})
is the norm limit of
a sequence $\eta_\omega(a_1),\,\eta_\omega(a_2),\,
\dotsb$,
where~$a_1,a_2,\dotsc\in\scrA$,
the np-maps $a_n\ast \omega\equiv 
\left<\eta_\omega(a_n),\varrho_\omega(\,\cdot\,)\eta_\omega(a_n)\right>$
converge to~$\left<x,\varrho_\omega(\,\cdot\,) x\right>=f$
in the operator norm as $n\to\infty$ by~\sref{vector-functional-convergence};
and so we may assume without loss of generality
that~$f=a\ast \omega$ for some~$a\in\scrA$ and~$\omega\in \Omega$.
Since~$S$ is ultrastrongly dense in~$\scrA$
we can find a net~$(s_\alpha)_\alpha$
in~$S$ that converges ultrastrongly to~$a$.
As the np-functionals~$s_\alpha \ast \omega$
in $\Omega'\subseteq \Omega''$
will then
operator-norm converge
to~$f= a\ast \omega$
as $\alpha\to\infty$
by~\sref{bstaromega-basic},
we conclude that~$f\in \overline{\Omega''}$.\qed
\end{point}
\end{point}
\end{point}
\end{parsec}
\begin{parsec}{910}
\begin{point}{10}
With this chapter
ends perhaps the most hairy part of this thesis:
we've developed the theory of von Neumann algebras
starting from Kadison's characterisation (see~\sref{vna})
to the point that we have a sufficiently firm hold on the normal functionals
(see e.g.~\sref{polar-decomposition-of-functional}, \sref{normal-functional}),
the ultraweak and ultrastrong topologies 
(e.g.~\sref{kaplansky}, \sref{functional-permanence}, 
	\sref{vn-center-separating-fundamental}),
the projections (\sref{vna-ceil}, \sref{ceill}, 
\sref{projections-norm-dense}), 
and the division structure 
(\sref{douglas}, \sref{polar-decomposition})
on a von Neumann algebra.
In the next chapter we reap the benefits of our labour
when we study an assortment of structures
in the category~$\W{cpsu}$ of von Neumann algebras
and ncpsu-maps.
\end{point}
\end{parsec}

